MASTER_SYSTEM_DOCS

## GUARDIAN_APPROVALS|/guardian-approvals|caregiver-only
TABS:posts(discussion_posts.approval_status=pending_approval+linked_bestieâ†’approve[approved+is_moderated=true]|reject[rejected]|del)|comments(discussion_comments.approval_status=pending_approval+linkedâ†’approve|reject)|vendors(VendorLinkRequests:vendor_bestie_requests.status=pending+linkedâ†’approve[status=approved]|reject[rejected])|messages(BestieSponsorMessages:sponsor_messages.status=pending_approval+linkedâ†’approve-as-is[status=approved]|edit-approve[subject/text/img-crop-recrop/vid-upload+from_guardian=true+saveâ†’app-assets/sponsor-messages/]|reject[reason])
FLAGS:caregiver_bestie_links(require_post_approval|require_comment_approval|require_message_approval[def:true]|require_vendor_asset_approval)
BADGE:useGuardianApprovalsCountâ†’SUM(pending:posts+comments+vendor_links+messages)â†’realtime-subscriptionsÃ—4
RLS:is_guardian_of(guardian_id,bestie_id)â†’UPDATE(discussion_posts|discussion_comments|vendor_bestie_requests|sponsor_messages)
FILES:GuardianApprovals.tsx|VendorLinkRequests.tsx|BestieSponsorMessages.tsx|useGuardianApprovalsCount.ts
ISSUES:emptyâ†’check-links|count-no-updateâ†’verify-realtime-cleanup|cant-approveâ†’check-is_guardian_of-func

## VIDEO_SYSTEM
COMPS:VideoPlayer(HTML5+auto-hide-controls+dynamic-aspect-from-meta+max-w-md[vert]|max-w-2xl[land]+NO-object-fit[critical:bars/crop])|YouTubeEmbed(iframe+parse-all-YT-URL+def:16:9)|YouTubeChannel(promo-section+custom-YT-logo+config[badge+heading+desc+URL]+card-gradient-bg)
DB:videos(id|title|video_url[uploads]|youtube_url[embeds]|video_type|thumbnail_url|description|category|is_active|display_order)|about_sections.youtube_channel(content.badge_text|heading|description|channel_url|button_text)|storage:videos-bucket[100MB]+RLS[public-SELECT-active+admins-ALL]
ADMIN:VideoManagerâ†’Admin-Videosâ†’upload/embed+thumbnails+meta+toggle-vis+reorder[drag-drop]+del|YouTube-Channelâ†’Admin-Aboutâ†’Edit-youtube_channel-sectionâ†’config[URL+button-text+desc]
INTEGRATIONS:discussion_posts(video_id[link-table]|youtube_url[direct])|app_settings.sponsor_page_content.featured_video_id|videos-page[gallery+fullscreen-dialog]|about-page(youtube-channel-section[about_sections]+doc-watch-btns[YT/Vimeo/Dailymotionâ†’about_sections.content.doc_*_url])
RULES:VideoPlayer:YES[dynamic-aspectRatio-inline+w-full-h-full+grad-overlays]NO[object-fit+fixed-aspect]|YouTubeEmbed:YES[flex-URL-parse+AspectRatio-wrap+iframe-security]|YouTubeChannel:YES[red-YT-logo-SVG[rounded-rect+white-triangle]+btn-new-tab]NO[Lucide-YouTube-icon]
ISSUES:black-bars/cropâ†’rm-object-fit|wrong-sizeâ†’dynamic-style|YT-logo-wrongâ†’custom-SVG-red-bg-white-tri
FILES:VideoPlayer.tsx|YouTubeEmbed.tsx|VideoManager.tsx|YouTubeChannel.tsx|About.tsx[doc-section]

## VISIBILITY_TOGGLE_STANDARD
PURPOSE:btn-componentâ†’toggle-DB-UI-state[active/visible|inactive/hidden]
VISUAL:ACTIVE[bg-green-100+hover:bg-green-200+border-green-300+Eye-icon-text-green-700]|INACTIVE[bg-red-100+hover:bg-red-200+border-red-300+EyeOff-icon-text-red-700]
PATTERN:Button[variant=outline+size=icon+onClick=toggleFunction(id,state)+title=state?Deactivate:Activate+className=state?green-classes:red-classes]+icon=state?Eye[w-4-h-4-text-green-700]:EyeOff[w-4-h-4-text-red-700]
FILES:vendor/ProductList.tsx[product-vis]|admin/CommunityOrderManager.tsx[section-vis]|admin/FamilyOrganizationsManager.tsx[org-active]|admin/FeaturedItemManager.tsx[featured-active]|admin/FooterLinksManager.tsx[footer-sections-links]|admin/HomepageOrderManager.tsx[homepage-sections]|admin/NavigationBarManager.tsx[nav-links]|EventManagement.tsx[event-vis]
STANDARD:green=active/visible|red=inactive/hidden[consistent-across-all]

## BACK_BUTTON_PLACEMENT
SPACING:main[pt-4-with-navbar|pt-6-no-navbar]|btn[mb-6-standard|mb-4-dense]
STYLE:Button[variant=outline+size=sm]+ArrowLeft[mr-2-h-4-w-4]+"Back-to-[Destination]"[required-descriptive-text]
LAYOUT-STANDARD:main.flex-1.pt-4>container.mx-auto.px-4>Button.mb-6+Card
LAYOUT-BANNER:banner-div[h-32-bg-gradient]>container.mx-auto.px-4.h-full.flex.items-center>Button|container.mx-auto.px-4>relative-Card[-mt-8-mb-6-overlaps-banner]
MISTAKES:NO[mb-12+too-much|inconsistent-spacing|btn-inside-cards|different-variants|icon-only-missing-text]
A11Y:descriptive-text-required[not-just-icon]+min-44x44px-touch+color-contrast+semantic-button-with-onClick

## NAVIGATION_BAR
VISIBILITY:user+profile+roleâ‰ vendorâ†’shows|hidden-for[non-auth+vendors]|visible-for[bestie+caregiver+supporter+admin+owner]
SCROLL:shows[within-150px-top|scrolling-UP]|hides[past-150px+scrolling-DOWN]|CSS[translate-y-0-opacity-100-visible|-translate-y-full-opacity-0-hidden]
PAGE-SPACING:CRITICAL-all-pages-MUST-pt-24[96px-min-clearance-80px]|standard[pt-24]|with-banner[banner-overlap-content-below-pt-24]
LINKS:navigation_links(id|label|href|display_order|is_active=true)â†’internal[Link-to-href]|external[a-href-target-blank-rel-noopener]
STYLE:hover-burnt-orange+animated-underline+font-Roca
DIMENSIONS:height~112px[header-64px+nav-48px]|z-50|backdrop-blur
REALTIME:subscribes-navigation_linksâ†’auto-refresh
USER-BADGE:right-side+User-icon+capitalized-role
POSITION:absolute-top-full-overlays-content[not-push-down]|full-width-left-0-right-0|z-50|backdrop-blur
VENDOR-EXCLUSION:profile.roleâ‰ vendorâ†’prevents-display|vendors-use-/vendor-dashboard[separate-tabs:Products+Orders+Earnings+Settings]

## NOTIFICATION_BADGES
LOCATIONS:UnifiedHeader-Approvals-btn[caregivers-only:pending-posts+comments+vendor-linksâ†’useGuardianApprovalsCountâ†’red-top-right]|UnifiedHeader-Admin-btn[admins-only:moderationCount+pendingVendorsCountâ†’red-top-right]|Admin-Vendors-tab[pendingVendorsCountâ†’red-next-label]|Admin-Moderation-tab[useModerationCountâ†’red-next-label]|Guardian-Approvals-tabs[Posts:pendingPosts.length|Comments:pendingComments.length|Vendor-Links:pendingVendorLinksâ†’all-red/destructive]
INVENTORY-BADGES:Admin-Vendor-Mgmt[red-when-inventoryâ‰¤10]|Marketplace-Product-Cards[Out-of-Stock-when-inventory=0]|Vendor-Product-List[Out-of-Stock-when-inventory=0]
FEATURES:red-destructive-variant+realtime-subscriptions+auto-updates

## BESTIE_LINKING_SYSTEM
FRIEND-CODE:3-emojis[20-emoji-set=8000-combos]|storage:profiles.friend_code[TEXT-3-chars]|regen-doesnt-break-links[UUID-based]|emojis:ğŸŒŸğŸŒˆğŸ”¥ğŸŒŠğŸŒ¸ğŸ•ğŸ¸ğŸš€ğŸ†âš¡ğŸ¨ğŸ­ğŸªğŸ°ğŸŒµğŸ¦‹ğŸ‰ğŸ¯ğŸºğŸ–ï¸
GUARDIAN-BESTIE:table:caregiver_bestie_links(caregiver_id|bestie_id|relationship|approval-flags+timestamps)|flow:guardian-enters-3-emojiâ†’search-profiles_public[friend_code+role=bestie]â†’creates-link-with-approval-settings[posts+comments+featured-posts]|guardian-can:view-unlink-besties+toggle-approval-reqs+manage-featured-posts-sponsorships|RLS:caregivers-CRUD-own-links+besties-view-links
VENDOR-BESTIE:table:vendor_bestie_requests(vendor_id|bestie_id|status[pending/approved/rejected]|reviewed_by|message)|flow:vendor-submits-request[3-emoji+msg]â†’guardian-approves-rejects[/guardian-approvals]â†’approved-vendors-feature-ONE-bestie[vendors.featured_bestie_id]|vendor-can:view-pending-approved-links+feature-unfeature-bestie[shows-profile+marketplace]|guardian-can:approve-reject-requests|RLS:vendors-see-requests+guardians-approve-linked-besties
SPONSOR-BESTIE:table:sponsorships(sponsor_id|bestie_id|amount|frequency|status|stripe_subscription_id)|table:sponsorship_shares[share-view-access-other-besties]|flow:supporter-sponsors[/sponsor-bestie-via-Stripe]â†’webhook-creates-sponsorships[status:active]â†’supporter-shares-access[sponsorship_shares]|supporter-can:view-manage-subs[/guardian-links]+cancel-modify[Stripe-portal]+share-view-access|RLS:sponsors-besties-view-own+shared-users-via-can_view_sponsorship()
BEHAVIORS:friend-code-change:existing-links-preserved[UUID-based]+only-affects-NEW-links[like-changing-phone-old-contacts-still-have-you]|frontend-pattern:3-Select-components-map-FRIEND_CODE_EMOJIS[emoji+name]|components:GuardianLinks.tsx|VendorBestieLinkRequest.tsx|VendorLinkRequests.tsx|VendorLinkedBesties.tsx
USE-CASES:guardian-links-child[enter-codeâ†’set-relationshipâ†’toggle-approvals]|vendor-features-bestie[requestâ†’guardian-approvesâ†’vendor-features]|supporter-sponsors[browse-/sponsor-bestieâ†’payâ†’share-access]|bestie-regenerates-code[old-links-stay+new-code-future-connections]
SECURITY:is_guardian_of(_guardian_id,_bestie_id)
NOT-IMPLEMENTED:bestie-initiated-linking|link-expiration|email-notifications|rate-limiting|multi-guardian-support|vendor-unlink|friend-code-history|approval-notifications

## EVENTS_SYSTEM
TYPES:single[is_recurring:false+only-event_date]|recurring-multi[is_recurring:true+event_dates-entriesâ†’separate-card-per-date]|recurring-template[is_recurring:true+no-event_datesâ†’shows-primary-date-only]
DISPLAY:upcoming[dateâ‰¥now+chronological+each-date=card]|past[date<now+expires_after_date=false+reverse-chron+grayscale+Past-Event-badge]|expiration[expires_after_date=trueâ†’past-dates-hidden]|role-filter:client-side-filter-visible_to_roles
CARD-COMPS:image[AspectRatio-wrapper+parse-string-9:16â†’decimal-9/16]|dates[primary-large-box+all-dates-list-if-multi+current-highlighted]|TTS[reads-title+desc+date+location]|location[clickable-LocationLinkâ†’Google-Maps]|audio[inline-AudioPlayer-if-audio_url]
DETAIL-DIALOG:click-cardâ†’EventDetailDialog[full-details+all-dates+recurrence-info+audio+location]
LINKED-EVENTS:URL:/events?eventId=xxx[from-discussion-posts-via-event_id]â†’auto-opens-dialog+bypasses-expiration-for-linked
MODERATION:image:moderate-image-edge-func-on-uploadâ†’stores-moderation_status+moderation_severity+moderation_reason
ADMIN:/event-managementâ†’create-edit[title+desc+date-time+recurrence+image-crop-aspect+audio+visibility-roles+expiration-toggle]|add-multi-dates[edit-eventâ†’Add-Dateâ†’creates-event_dates-entry]
DB:events(title|description|image_url|audio_url|location|event_date|aspect_ratio[def:9:16]|is_recurring|recurrence_type|expires_after_date|visible_to_roles[]|is_active)|event_dates(event_id|event_date)|event_attendees(event_id|user_id|status[future])
RLS:SELECT[all-auth-client-filter]|INSERT[auth-users]|UPDATE-DELETE[author-or-admin]|event_dates[creator-only]
ISSUES:not-showingâ†’check-is_active+visible_to_roles+user-role|wrong-aspectâ†’parse-string-to-decimal|past-visibleâ†’check-expires_after_date|recurring-shows-onceâ†’add-event_dates
FILES:EventsPage.tsx|EventManagement.tsx|EventDetailDialog.tsx|moderate-image/index.ts

## SPONSORSHIP_SYSTEM
GUEST-CHECKOUT:no-account-requiredâ†’stored-with-sponsor_email[no-sponsor_id]|trigger:link_guest_sponsorships()-on-signupâ†’auto-links-when-email-matches|RLS:logged-users-view-by-email-match|msg:"sponsorship-auto-link-when-create-account-with-email"
FUNDING-PROGRESS:only-if-monthly_goal>0|calc:SUM-active-monthly-sponsorships|fully-funded:is_fully_funded-OR-funding_percentageâ‰¥100
MESSAGE-APPROVAL:controlled-per-link:require_message_approval|guardian-edit-before-approve[add-images+modify-text]|status:pending_approvalâ†’approvedâ†’sent[auto-on-sponsor-view]|besties-see:Approved-Delivered-after-guardian-approval
SPONSOR-BESTIE-VS-ACTUAL:sponsor_besties.idâ†’listing-ID[used-in-sponsorships]|sponsor_besties.bestie_idâ†’optional-link-to-user|allows:generic-sponsorships-without-user-accounts
IMAGE-HANDLING:upload-to-app-assets|guardian-crop-with-aspect-ratio|display-supports-audio+image-together
DB:sponsor_besties(id|bestie_id[nullable-link-user]|bestie_name|image_url|voice_note_url|video_url|text_sections[jsonb:[{header,text}]]|aspect_ratio[def:9:16]|monthly_goal|is_active|is_fully_funded|available_for_sponsorship|start_date|end_date)|sponsorships(id|sponsor_id|bestie_id|sponsor_bestie_id|amount|frequency[one-time/monthly]|status[active/cancelled/paused]|stripe_subscription_id|stripe_customer_id|stripe_mode[test/live]|sponsor_email[nullable-guest]|receipt_sent|receipt_sent_at|receipt_number|started_at|ended_at)|sponsor_messages(id|bestie_id|sent_by|subject|message|audio_url|image_url|video_url|status[pending_approval/approved/sent/rejected]|from_guardian|is_read|rejection_reason|approved_by|approved_at|sent_at|moderation_status|moderation_reason)|caregiver_bestie_links(allow_sponsor_messages|require_message_approval[both-def:true]|show_sponsor_link_on_guardian|show_sponsor_link_on_bestie)|sponsor_page_sections(section_key[unique:header/featured_video/sponsor_carousel/selection_form/impact_info]|section_name|is_visible|display_order|content[jsonb])|receipt_settings(organization_name|organization_address|tax_id[EIN]|from_email|reply_to_email|website_url|receipt_footer_text)|year_end_summary_settings(email_subject|email_intro_text|tax_notice_text|is_enabled)|year_end_summary_sent(user_id|user_email|user_name|tax_year|total_amount|sent_at|resend_email_id|status)
VIEWS:sponsor_bestie_funding_progress[sponsor_bestie_id|bestie_name|current_monthly_pledges|monthly_goal|funding_percentage|remaining_needed]|sponsorship_year_end_summary[sponsor_email|sponsor_name|tax_year|total_amount|total_donations|donations[jsonb-array]]
EDGE-FUNCS:create-sponsorship-checkout[no-authâ†’supports-guest|get-create-stripe-customer-by-email|create-price|checkout-session[subscription-monthly|payment-one-time]|store-bestie_id-metadataâ†’return-url]|verify-sponsorship-payment[session_idâ†’verify-stripe|get-email-from-session|find-user-by-email|check-existing-by-stripe_subscription_id|insert-sponsorships[if-user:sponsor_id=user.id+sponsor_email=NULL|if-guest:sponsor_id=NULL+sponsor_email=email]â†’return-msg[guest:"auto-link-when-create-account"]]|manage-sponsorship[auth-tokenâ†’get-stripe-customer-by-email|create-billing-portalâ†’return-url-redirect-stripe-portalâ†’webhooks-handle-status-updates]|update-sponsorship[sponsorship_id+new_amountâ†’auth+verify-owns-sponsorship[active-monthly-only]|validate-amount[$10-$500]|find-stripe-sub-by-email+bestie_id|update-stripe-price|update-DB-amountâ†’return-success]|send-sponsorship-receipt[sponsorship_idâ†’fetch-details+settings|get-org-logo-app-settings|gen-receipt-HTML[number:RCPT-YYYYMMDD-XXXXX+sponsor+org+amount+date+bestie+EIN+disclaimer]|send-Resend-API|update-sponsorships[receipt_sent=true+receipt_sent_at+receipt_number]â†’return]|generate-missing-receipts[admin-onlyâ†’query-receipt_sent=false|loop-call-send-sponsorship-receipt|log-eachâ†’return-summary[total+successes+failures]]|generate-year-end-summary[taxYear?+sendEmail?â†’auth|query-view-email+year|if-no-data+!sendEmail:gen-mock|fetch-settings+logo|build-HTML[header-logo-year+total-box+itemized-table[date+bestie+amount+receipt#]+tax-box[EIN+notice]+footer]|if-sendEmail:send-Resend+log-year_end_summary_sentâ†’return-HTML+metadata[isMockData-flag]]
WEBHOOKS:stripe-webhook[ACTIVE-dual-test+live]|events:customer.subscription.deleted[activeâ†’cancelled+set-ended_at]|customer.subscription.updated[3-states:cancel_at_period_end=trueâ†’stay-active-set-ended_at-to-cancel_at|status=activeâ†’active-clear-ended_at|otherâ†’cancelled-set-ended_at-now]â†’checks-metadata-bestie_id|checkout.session.completed[create-update-sponsorship|extract-amount-centsâ†’dollars|set-frequency-by-interval|status:active+started_at:now|store-stripe_mode]
STATUS-FLOW-PROGRESS:statuses[active-counts-funding|cancelled-excluded|paused-future]|view-recalc:SUM(amount)-WHERE-status=active+frequency=monthly|progress:(current/goal)*100|fully-funded:percentageâ‰¥100-OR-is_fully_funded=true|ending-amount-scheduled-cancels:sponsorships-with-ended_at-set-still-in-periodâ†’progress-bar-2-segments[stable-green+ending-yellow]|UI-update:user-cancels-portalâ†’webhook-updates-statusâ†’view-recalcs-excludes-cancelledâ†’frontend-queriesâ†’bar-updates-auto
REALTIME:useGuardianApprovalsCount[subscribes:discussion_posts+discussion_comments+sponsor_messages+caregiver_bestie_linksâ†’updates-badge-immediately]|useSponsorUnreadCount[subscribes:sponsor_messages+sponsorshipsâ†’updates-when-read-sent]|SponsorMessageInbox[subscribes:sponsor_messages-filtered-bestie_idâ†’updates-new-status-changes]
COMPS-DISPLAY:SponsorBestieDisplay.tsx[carousel+TTS+audio+funding-progress]|FundingProgressBar.tsx[visual-indicator]
COMPS-FORM:BestieSponsorMessenger.tsx[bestie-composition]|GuardianSponsorMessenger.tsx[guardian-future]
COMPS-GUARDIAN:BestieSponsorMessages.tsx[approval-interface+edit-dialog]|VendorAssetRequests.tsx[asset-approval-pattern]
COMPS-SPONSOR:SponsorMessageInbox.tsx[accordion-list+read-status]|DonationHistory.tsx[table+receipt-downloads]
COMPS-ADMIN:SponsorBestieManager.tsx[CRUD-listings]|SponsorPageOrderManager.tsx[section-ordering]|SponsorBestiePageManager.tsx[header-editor]|SponsorshipTransactionsManager.tsx[transaction-view-mgmt]|ReceiptSettingsManager.tsx[org-receipt-config]|YearEndSummarySettings.tsx[year-end-email-config]|YearEndSummarySentHistory.tsx[sent-history]|StripeModeSwitcher.tsx[test-live-toggle]
PAGES:/sponsor-bestie[public-page]|/sponsorship-success[post-payment]|/guardian-links[my-besties-sponsors+guardians]|/bestie-messages[bestie-center]|/guardian-approvals[guardian-hub]
TRIGGERS:link_guest_sponsorships()[ON-INSERT-auth.users-after-signupâ†’get-emailâ†’find-sponsorships[sponsor_email-match+sponsor_id-NULL]â†’update[set-sponsor_id=new-user+clear-sponsor_email]]|SECURITY-DEFINER-search_path=public
SECURITY-FUNCS:has_admin_access(_user_id)|is_guardian_of(_guardian_id,_bestie_id)|get_user_role(_user_id)|can_view_sponsorship(_sponsorship_id,_user_id)
STORAGE:app-assets-public[sponsor-besties/{id}/|sponsor-messages/{id}/+images-videos|logos/]|featured-bestie-audio-public[voice-notes|audio-recordings]
ISSUES:badge-no-updateâ†’check-realtime-cleanup|msg-no-imgâ†’display-logic-prioritizes-audio[FIXED:show-both]|aspect-btns-dont-workâ†’missing-onAspectRatioKeyChange|bestie-cant-sendâ†’allow_sponsor_messages=false|funding-not-calcâ†’no-monthly_goal|stripe-checkout-failsâ†’check-STRIPE_SECRET_KEY_TEST-LIVE|progress-no-update-after-cancelâ†’webhook-not-processing|cancelled-still-countsâ†’status-not-updated|portal-btn-no-workâ†’no-stripe-customer|receipt-not-sendingâ†’from-email-not-verified-Resend|receipt-sends-not-receivedâ†’SPF-DKIM-DNS|receipt-#-dupesâ†’system-clock-issue[uses-timestamp+random]|year-end-no-dataâ†’no-completed-donations-for-year|preview-failsâ†’receipt-settings-not-configured|mock-in-previewâ†’no-real-donations[expected]|email-logo-missingâ†’logo-URL-not-in-app-settings|EIN-validation-failsâ†’wrong-format[use-XX-XXXXXXX]|transactions-wrong-modeâ†’mode-not-stored-creation[check-stripe_mode]|test-payments-not-visibleâ†’viewing-live-only[toggle-switcher]|guest-not-linkingâ†’email-mismatch-or-trigger-failure|cant-view-after-signupâ†’email-mismatch|cant-update-amountâ†’not-monthly-or-not-active|update-amount-failsâ†’out-of-range[$10-$500]|shared-not-visibleâ†’friend-code-mismatch
NOT-IMPLEMENTED:guardian-initiated-msgs|sponsor-replies-2-way|analytics-dashboard[donation-trends-retention]|bulk-msg-all-sponsors|scheduled-msgs|msg-templates|sponsor-tiers-benefits|impact-reporting-monthly|auto-thank-emails|donor-recognition-levels[Bronze-Silver-Gold]|monthly-leaderboard-opt-in|sponsor-portal-self-service|multi-bestie-packages|recurring-reminders|gift-sponsorships

## VENDOR_BESTIE_SYSTEM
OVERVIEW:vendors-display-guardian-approved-featured-bestie-content[images+videos+voice-notes]-on-vendor-profile-with-guardian-approval-workflow|NOTE:vendor=status[vendors-table]+not-role[users-can-be-caregivers-besties-supporters-AND-vendors-simultaneously]
DB:featured_besties|vendor_bestie_requests|vendor_bestie_assets|caregiver_bestie_links

## ABOUT_PAGE_SYSTEM
ROUTE:/about|SECTIONS:Our-Story[badge+heading-gradient+story-para1+para2+decorative-orbs]|Documentary[title+desc+YT-Vimeo-Dailymotion-links+image+Film-icon-hover-scale+Button-outline-asChild-anchor-no-gradient]|BDE[logo-256px+desc1-2+address-city+status+btn-solid-brown-NO-GRADIENT+image]
ADMIN:Adminâ†’Aboutâ†’Edit-Best-Day-Story|EDITABLE:all-text-URLs-images-button-link-types[internal-page-vs-custom-URL]
DB:homepage_sections[section_key:about+content-JSONB]|SHARED:homepage-About-section+full-About-page
DESIGN:Documentary-btns[outline-white-bg-border-hover-accent]|BDE-btn[solid-brown-custom-HSL-NO-gradient-matches-section-palette]|images[object-cover+gradient-overlays]|BDE-colors[bg-hsl(27-41%-88%)+text-hsl(13-33%-36%)]
ISSUES:YT-link-blockedâ†’use-anchor-asChild|BDE-logo-too-largeâ†’w-64-max|btn-has-gradientâ†’use-variant-ghost-custom-bg|colors-not-themingâ†’use-HSL-check-index.css

## ADMIN_DASHBOARD
ROUTE:/admin|ACCESS:admin-owner-only[from-user_roles]|REDIRECT:non-adminsâ†’/community
STATS:Total-Users[profiles]+Events[events]+Posts[discussion_posts]+Featured-Besties[featured_besties]
TABS:Analytics[AnalyticsDashboard]|Users[UserManagement-view-edit-roles-perms-create-test-del-pwd-reset]|Events[redirect:/admin/events]|Albums[redirect:/admin/albums]|Videos[VideoManager]|Besties[sub-tabs:Featured+Sponsors+Page-Order+Content+Receipts+Transactions+Year-End-Settings+History]|Partners[PartnersManager]|Donations[SupportPageManager-webhook-complete-UI-pending]|Featured-Item[FeaturedItemManager-parallel-loading-optimized]|Vendors[VendorManagement-badge-pendingVendorsCount-sub-tabs:Vendors+Products+Orders]|Format-Pages[sub-tabs:Homepage+Community+About+Footer+Quick-Links+Navigation+Locations]|Moderation[badge:moderationCount+messageModerationCount-sub-tabs:Content+Messages+Policies]|Contact[badge:contactFormCount-ContactFormManager]|Help-Center[HelpCenterManager-sub-tabs:Tours+Guides+FAQs]|Product-Updates[ProductUpdateBroadcaster]|Notifications[EmailTemplatePreview]|Settings[sub-tabs:App-Settings+Avatars+Impersonation]
IMPERSONATION:useRoleImpersonation-hookâ†’localStorageâ†’affects-badges-visibility-perms
BADGES:useModerationCount+usePendingVendorsCount+useMessageModerationCount+useContactFormCount

## AUTH_SYSTEM
ROUTE:/auth|SIGNUP:email-pwd-display_name-role[supporter-bestie-caregiver]+avatar-optional+terms-checkboxâ†’supabase.auth.signUp-with-metadataâ†’TRIGGER:on_auth_user_createdâ†’handle_new_user()[inserts-profiles+user_roles]â†’call-record-terms-acceptance-edge-func[stores-IP-user-agent]â†’redirect-by-role-vendor-status
LOGIN:email-pwdâ†’supabase.auth.signInWithPassword()â†’check-vendorâ†’redirect:/vendor-dashboard-or-/communityâ†’TermsAcceptanceGuard-enforces-acceptance
PWD-RESET:Forgot-Passwordâ†’enter-emailâ†’supabase.auth.resetPasswordForEmail()â†’email-sentâ†’click-linkâ†’/auth-with-reset-tokenâ†’enter-new-pwd
ROLES:supporter[default-vendors-are-supporters-with-vendor-status]|bestie[can-be-sponsored]|caregiver[guardian-can-also-be-vendor]|moderator[can-moderate]|admin[full-admin]|owner[super-admin]
ASSIGNMENT:signup-user-selects[supporter-bestie-caregiver]|post-signup-admin-assigns-via-User-Management|vendor-status-applied-via-/vendor-auth[checked-via-vendors-table]|stored-in-user_roles-table[NEVER-in-profiles]
AVATAR:AvatarPicker-during-signupâ†’avatar_number-in-profiles[1-12]â†’AvatarDisplay-loads-from-src/assets/avatars/composite-{number}.png
TERMS:TermsAcceptanceGuard-wraps-App.tsxâ†’queries-terms_acceptance-for-user+versionâ†’TermsAcceptanceDialog-non-dismissible-modalâ†’trigger-on-version-change-or-first-loginâ†’versions:CURRENT_TERMS_VERSION-1.0+CURRENT_PRIVACY_VERSION-1.0[in-useTermsCheck.ts]
VENDOR-CHECK:after-loginâ†’query-vendors-table-by-user_idâ†’has-vendor-recordâ†’/vendor-dashboard|othersâ†’/community
SECURITY:handle_new_user()[SECURITY-DEFINER-SET-search_path-publicâ†’inserts-profile+role-with-elevated-privs-bypasses-RLS]|has_role(_user_id,_role)[SECURITY-DEFINER-checks-user_roles-prevents-privilege-escalation]
AUTO-CONFIRM:enabled-via-Adminâ†’Auth-Configâ†’skips-email-verification[non-production-testing]
RLS:profiles[users-see-own+guardians-see-linked-besties+admins-see-all]|user_roles[uses-has_admin_access()-admins-only-modify]

## BUTTON_STYLING_STANDARDS
VARIANTS:default[complex-gradient-bg-gradient-warm-primary-CTAs-hero]|outline[border-bg-on-hover-secondary-actions]|secondary[solid-bg-no-gradient-supporting-actions]|ghost[transparent-hover-bg-only-tertiary-actions]
GRADIENT-USE:âœ…primary-brand-actions[Join-Donate-Sponsor-Hero-CTAs]|brand-color-scheme[orange-mustard-matches-palette]|high-priority-conversions[payment-checkout-signup]|âœ—custom-color-schemes[non-brand-colors-eg-brown-BDE]|secondary-tertiary-actions[cancel-back-view-more]|outline-ghost-variants[never-by-design]
CUSTOM-COLOR-PATTERN:variant-ghost+className-bg-[hsl(13,33%,36%)]+hover:bg-[hsl(13,33%,36%)]/90+text-whiteâ†’solid-bg-removes-gradient-allows-custom-bg-via-className
GRADIENT-DEF:--gradient-warm[5-radial-gradients-over-burnt-orange-hsl(24-85%-56%)-liquid-appearance]|location:src/index.css
DECISION-TREE:primary-CTA?â†’brand-colors?[YESâ†’variant-default-gradient|NOâ†’variant-ghost-custom-bg]|NOâ†’secondary?[variant-secondary-solid]|tertiary?[variant-outline-or-ghost]
SIZES:sm[h-9-px-3]|default[h-10-px-4]|lg[h-11-px-8-Hero-CTAs]|icon[h-10-w-10-square]
A11Y:gradients[WCAG-AA-white-text]|custom-colors[contrastâ‰¥4.5:1]|focus-states[ring-offset-2+keyboard-nav+screen-reader-labels]

## COFFEE_SHOP_SYSTEM
ROUTE:/coffee-shop|DB:app_settings-key-coffee_shop_content[JSONB]
ADMIN:Adminâ†’Coffee-Shop-Website-tabâ†’EDITABLE:hero[heading+subheading+image-upload-crop-16:9â†’app-assets/coffee-shop/+compressed-4.5MB]|mission[title+description]|buttons[text+links:internal-page-dropdown[INTERNAL_PAGES]|custom-URL]|location[hours+address+phone]|menu-visibility-toggle
FRONTEND:CoffeeShopHome.tsxâ†’loads-settings-on-mountâ†’sections:Hero[bg-image+heading+subheading+CTA-btns]|Mission-statement-card|Hours-location-info-cards|Menu[conditionally-rendered-based-on-show_menu]
BUTTON-BEHAVIOR:internal-links[window.location.href]|anchor-links[#-smooth-scroll-to-element]|external-links[open-new-tab]
MENU:CoffeeShopMenu.tsx[coffee+specialty-drinks+crepes+ice-cream-hard-coded-from-original-menu.html]
ADMIN-PREVIEW:Preview-btnâ†’opens-/coffee-shop-new-tab|Live-Site-btnâ†’opens-bestdayevercoffeeandcrepes.com
CONTENT-STRUCTURE:{hero_heading+hero_subheading+hero_image_url+menu_button_text+menu_button_link+menu_button_link_type[internal-custom]+about_button_text+about_button_link+about_button_link_type+mission_title+mission_description+hours_title+hours_content+address+phone+show_menu[boolean]}

## COMMUNITY_PREVIEWS
PROFILE-LOADING:CRITICAL-fetch-profiles_public[includes-role-from-user_roles]â†’sets-effectiveRoleâ†’triggers-loadLatestContent()|profiles-table-has-no-roleâ†’effectiveRole-undefinedâ†’early-returnâ†’no-content-loads
DISCUSSION-PREVIEW:query:discussion_posts-select-*+author:profiles_public(id+display_name+role)-eq-is_moderated-true[NO-approval_status-filter]-order-created_at-desc-limit-1|visibility:no-role-check-if-is_moderated=true-shows-to-all
EVENTS-PREVIEW:query:events-select-*+event_dates(id+event_date)-eq-is_public-true-eq-is_active-true|visibility:client-side-filter-event.visible_to_roles.includes(effectiveRole)|date-logic:collect-all-dates[primary+event_dates]â†’filter[dateâ‰¥now+(!expires_after_date-OR-isUpcoming)]â†’sort-chron-limit-3â†’height-limit[MAX_HEIGHT-1200px-CARD_PADDING-24px-SPACING-16px-TEXT_HEIGHT-120pxâ†’calc-imageHeight-from-aspect+TEXT_HEIGHT+CARD_PADDING+SPACING]
GRID-LAYOUT:grid-cols-1-lg:grid-cols-2-gap-6
CARD-COMPS:Discussion[border-2-hover:border-primary/50+MessageSquare-icon-text-primary+img-full-w-h-48-object-cover+TTS-right-of-title-e.stopPropagation()]|Event[border-b-between-last:border-0+Calendar-icon-text-secondary+img-dynamic-aspect-from-event.aspect_ratio[def:9:16]+location-clickable-linkâ†’Google-Maps[noopener-noreferrer-hover-primary-underline]+audio-AudioPlayer-if-audio_url[propagation-stopped]+TTS-right-title-reads[title+desc+Scheduled-for-[date]+At-[location]]]
NAVIGATION:click-discussion-cardâ†’/discussions|click-event-cardâ†’/events|click-View-All-btnsâ†’respective-pages|TTS-location-links-e.stopPropagagation()-prevents-card-nav
TTS-TEXT:Discussion[${title}.${content}]|Event[[title+desc+Scheduled-for-[date]+location].filter(Boolean).join('. ')]
CRITICAL-RULES:1-Profile-fetch-profiles_public[includes-role]|2-Discussion-filter-only-is_moderated=true[no-approval_status]|3-Events-client-filter-by-role-after-DB-fetch|4-Height-events-limited-1200px-cumulative[aspect-ratio-aware]|5-Propagation-stop-TTS-location-audio-clicks|6-Visibility-check-community_sections-table|7-Empty-States-show-when-no-content
LOAD-SEQUENCE:checkUser()â†’fetch-sessionâ†’check-vendorâ†’redirect-if-vendorâ†’fetchProfile(userId)â†’from-profiles_publicâ†’getEffectiveRole(profile.role)â†’set-effectiveRoleâ†’useEffect-triggers-when-effectiveRoleâ‰ nullâ†’loadLatestContent()â†’fetch-discussions+eventsâ†’client-filter-events-by-roleâ†’render-visible-sections

## CONTACT_FORM_SYSTEM
OVERVIEW:contact-form-at-page-bottom-with-DB-storage+admin-email-notifications+reply-functionality+input-validation
DB:contact_form_settings(is_enabled[def:true]+title+description+recipient_email+success_message)|contact_form_submissions(name+email+subject[nullable]+message+message_type+image_url[nullable]+status[new-read]+replied_at[nullable]+replied_by[nullable]+reply_message[nullable]+admin_notes[nullable])
FRONTEND:ContactForm.tsx[auto-loads-settings-on-mount+autofills-email-logged-users+validates-Zod+saves-DB-always-succeeds+sends-email-optional-graceful-failure+shows-custom-success-msg+hides-if-is_enabled=false]|ContactFormManager.tsx[admin-interface:Settings-card+Submissions-table[columns:Name+Email-copy-icon+Subject+Status-badge+Date+Actions[View+Mark-Read-New+Delete]]+badge-count-new-submissions+realtime-updates]
VALIDATION:client[Zod:name-2-100+email-valid-max-255+subject-max-200-optional+message-10-2000]|server[edge-func:name-1-100-letters-spaces-hyphens-apostrophes+email-valid-lowercase-max-255+subject-max-200-optional+message-1-5000]
SECURITY:HTML-escaping-all-user-input+email-validation-client-server+rate-limiting-via-Supabase+CORS-headers+no-raw-SQL
EDGE-FUNCS:notify-admin-new-contact[sends-email-to-admin-on-new-submission+template-includes-details+color-coded-type-badges+View-in-Admin-btn+reply-to-header-submitter-email]|send-contact-reply[auth-required+server-Zod-validation+XSS-prevention-HTML-escape+CORS-headers+template-from-Best-Day-Ministries+reply-to-sender-email]
REPLY-METHODS:1-Email-Reply[admin-receives-notificationâ†’reply-in-email-clientâ†’response-to-submitter]|2-Manual-Email[admin-views-submissionâ†’click-email-or-copyâ†’compose-manually]|3-Admin-Reply-Interface[admin-views-submissionâ†’Reply-btnâ†’compose-reply-dialog+optional-admin-notes+Send-Replyâ†’email-to-submitter+tracked-in-DB+timestamp+admin-ID+auto-mark-read]
SETUP:1-Configure-Resend[signup-resend.com+CRITICAL-verify-domain-resend.com/domains-add-DNS-SPF-DKIM+create-API-key+add-RESEND_API_KEY-secret+update-from-address-verified-domain]|2-Configure-Settings[Adminâ†’Contactâ†’toggle-Enable-ON+set-title-desc+enter-recipient-email+customize-success-msg+Save]|3-Test[navigate-any-pageâ†’fill-formâ†’submitâ†’check-toast+submission-in-admin+email-received]
ISSUES:form-not-appear[is_enabled=falseâ†’enable-admin]|emails-not-sending[DOMAIN-NOT-VERIFIEDâ†’verify-resend.com/domains]|form-submits-no-email[Resend-not-configuredâ†’add-RESEND_API_KEY]|email-spam[domain-not-verifiedâ†’add-SPF-DKIM-DNS]|cant-reply[email-notifications-not-workingâ†’verify-domain-then-use-reply-to-in-email]

## DISCUSSION_SYSTEM
OVERVIEW:community-discussion-board[/discussions]-guardians-create-posts-users-comment-guardian-approval-workflow-bestie-content
DB:discussion_posts(title+content+author_id+image_url+video_id+youtube_url+album_id+event_id+approval_status[approved-pending_approval-rejected]+is_moderated[AI-flag]+visible_to_roles[]+allow_owner_claim)|discussion_comments(content+author_id+post_id+audio_url+approval_status+is_moderated)
PERMS:create-posts[guardians-admins-owners]|comment[all-auth]|edit-del-posts[author-guardian-of-bestie-author-admin-owner]|edit-del-comments[author-guardian-of-bestie-author-admin-owner]|view[based-on-visible_to_roles[]]|change-author[owners-only]
APPROVAL-FLOW:Bestie-Posts[bestie-createsâ†’check-caregiver_bestie_links.require_post_approvalâ†’if-any-guardian-requiresâ†’approval_status:pending_approvalâ†’guardian-approves-rejects-/guardian-approvalsâ†’on-approve:approved+is_moderated:true]|Guardian-Posts[auto-approved:approval_status-approved+still-AI-moderated]|Comments[same-pattern-check-require_comment_approval]
MODERATION-AI:text[moderate-content-edge-func-checks-title+content-before-save-flags-inappropriateâ†’is_moderated:false]|image[moderate-image-edge-func+policy-moderation_settings.discussion_post_image_policy[all-manual-review|flagged-AI-scan|none-auto-approve]â†’stores-moderation_status+moderation_severity+moderation_reason]
MEDIA:images[upload-discussion-images-bucket+compressed-4.5MB+crop-dialog-aspect-ratio+max-20MB-before-compression]|videos[option1-select-from-videos-table-admin-uploaded|option2-embed-YT-URL-direct-pasteâ†’displays-VideoPlayer-uploads-or-YouTubeEmbed-YT]|albums[link-via-album_idâ†’shows-cover+View-Album-btnâ†’opens-lightbox]|events[link-via-event_idâ†’shows-title-date-location+View-Event-btnâ†’/events?eventId=xxx]|audio-comments-only[record-or-uploadâ†’stored-featured-bestie-audio-bucketâ†’inline-player-in-comment-card]
UI-COMPS:Post-Card[Card-image-video-album-preview+CardHeader-AvatarDisplay-authorName-roleBadge-TextToSpeech-title+content+CardContent-title-content-linkedEvent-linkedAlbum-CommentSection]|Create-Post-Form[title-required-max-200+content-required-max-2000+image-upload-optional-with-crop+video-selection[none-select-youtube]+event-link-optional-dropdown+visibility-roles-checkboxes[caregiver-bestie-supporter]+Allow-Owner-Claim-checkbox-admins-owners]|Comment-Input[text-OR-audio-mutually-exclusive+audio-recorder-play-record-delete+submitâ†’guardian-approval-if-required]
SEARCH-SORT:search[filter-posts-title-content-case-insensitive]|sort[newest-first-default-or-oldest-first]|client-side-filtering-no-query-reload
EDIT-DELETE:posts[author-guardian-bestie-author-admin-edit-delete+edit-inline-form-title-content-media-allow_owner_claim-admins-owners-both-create-edit+delete-confirmation-cascade-deletes-comments+Change-Author-Owner-Only:admin-creates-post-checks-Allow-owner-claimâ†’owner-sees-Claim-Post-btnâ†’selects-new-author-from-admin-owner-listâ†’post-authorship-transfers]
REALTIME:subscribe-discussion_posts-new-posts+subscribe-discussion_comments-new-commentsâ†’auto-refresh
RLS:Posts-SELECT[approved-visible-to-roles-in-visible_to_roles[]+pending-rejected-only-author-guardian-admin]|Posts-UPDATE[author-can-update-own+guardians-can-update-linked-besties+admins-owners-can-update-any]|Posts-INSERT[guardians-admins-owners-only]|Comments-SELECT[approved-all-auth+pending-rejected-author-guardian-admin]|Comments-UPDATE[author-can-update-own+guardians-can-update-linked-besties+admins-owners-can-update-any]|Comments-INSERT[all-auth]
VALIDATION:title[1-200-chars]|content[1-2000-chars]|image[max-20MB-image-types-only]|youtube[valid-URL-format]

## DONATION_SYSTEM
OVERVIEW:general-donation-system-/support-page-one-time-monthly-recurring-via-Stripe-automated-webhook-status-updates
DB:donations(donor_id[nullable-links-profiles-auth]|donor_email[nullable-guest]|amount[numeric-dollars]|frequency[one-time-monthly]|status[pending-completed-one-time-active-monthly-cancelled]|stripe_customer_id+stripe_subscription_id[nullable-monthly]|stripe_mode[test-live]|started_at+ended_at+created_at+updated_at)
RLS:admins-view-all|donors-view-own[by-donor_id-OR-matching-email-from-auth.users]|public-INSERT[handled-by-edge-func-not-direct-client]
USER-WORKFLOW:/support-pageâ†’select-frequency[Monthly-One-Time]â†’select-preset-amount[$10-$25-$50-$100-$250]-or-custom[min-$5-max-$100k]â†’enter-email[auto-filled-logged-always-editable]â†’optional-check-Cover-processing-fees[adds-~3%]â†’accept-Terms-checkboxâ†’Donate-Nowâ†’redirects-Stripe-Checkoutâ†’after-payment-redirects-/support?donation=success
GUEST-CHECKOUT:no-account-requiredâ†’stored-donor_email-instead-donor_idâ†’when-user-creates-account-matching-email-donations-could-link-future
EDGE-FUNCS:create-donation-checkout[no-JWT-public-access+request:{amount+frequency+email+coverStripeFee}+validation-Zod-$5-$100k+flow:get-Stripe-mode-app_settings[test-live]â†’calc-final-amount-with-optional-fee-coverageâ†’create-retrieve-Stripe-customer-by-emailâ†’create-Stripe-Checkout-session[mode:payment-one-time-subscription-monthly+metadata:{type:donation+frequency+amount+coverStripeFee+donation_type:general}]â†’insert-pending-donation-DBâ†’return-url-redirect]|stripe-webhook[auth-Stripe-signature+dual-mode-test-live+events:checkout.session.completed-with-metadata.type=donation[one-time-mode:paymentâ†’UPDATE-status=completed|monthly-mode:subscriptionâ†’UPDATE-status=active+stripe_subscription_id+started_at]|customer.subscription.updated-with-metadata.type=donation[updates-status-based-on-state:activeâ†’status=active+ended_at=NULL|scheduled-cancelâ†’status=active+ended_at=cancel_at|cancelledâ†’status=cancelled+ended_at=NOW()]|customer.subscription.deleted-with-metadata.type=donationâ†’UPDATE-status=cancelled+ended_at=NOW()]
FRONTEND:DonationForm.tsx[frequency-toggle-Monthly-One-Time+preset-amount-btns-$10-$250+custom-amount-input-validation+email-input-auto-filled-profile+Cover-fees-checkbox+Terms-acceptance-checkbox+amount-summary-display]|validation[amount-min-$5-max-$100k+email-valid-required+terms-must-accept]|state[frequency+amount+email+acceptedTerms+coverStripeFee+loading]
STATUS-FLOW:One-Time[pendingâ†’checkout.session.completedâ†’completed]|Monthly[pendingâ†’checkout.session.completedâ†’activeâ†’customer.subscription.updated-with-cancel_at_period_endâ†’active-with-ended_at-setâ†’customer.subscription.deletedâ†’cancelled]
STRIPE-FEE-COVERAGE:formula-finalAmount=(amount+0.30)/0.971|example[$25-donation+~$0.75-fee=$25.75-chargedâ†’net-to-org-$25]|implementation-checkbox-UI+calculated-create-donation-checkout+passed-Stripe-unit_amount-cents
DIFFERENCES-FROM-SPONSORSHIPS:purpose[donations-general-support-vs-sponsorships-specific-bestie]|recipient[org-vs-bestie-via-org]|metadata[type:donation-vs-bestie_id]|table[donations-vs-sponsorships]|UI[/support-vs-/sponsor-bestie]|guest-checkout[both-supported]|monthly[both-available]|receipts[not-implemented-vs-automated]|year-end-summaries[not-implemented-vs-automated]
IMPLEMENTED:âœ…one-time-Stripe-Checkout+monthly-recurring-subscriptions+guest-checkout-no-account+Stripe-fee-coverage-option+dual-mode-test-live+automatic-status-webhooks+email-validation-sanitization+Terms-acceptance-required
NOT-IMPLEMENTED:âŒautomated-receipt-generation-like-sponsorships+donation-history-page-for-donors+update-monthly-amount-ability+Stripe-Customer-Portal-link-subscription-mgmt+year-end-tax-summaries+admin-view-all-donations+donation-analytics-dashboard+email-notifications-successful-donations+linking-guest-donations-to-accounts-on-signup+multiple-payment-methods-beyond-cards+recurring-donation-reminders+honor-memorial-dedications+matching-gift-programs

## HELP_CENTER_SYSTEM
OVERVIEW:comprehensive-help-center-interactive-product-tours-searchable-guides-FAQs-fully-DB-driven-admin-management
DB:help_tours(id+title+description+target_audience+category+steps[JSONB-array-Joyride-step-objects]+display_order+is_active+duration_minutes+icon+created_at+updated_at+created_by)|help_guides(id+title+description+content[TEXT-markdown-like]+category+target_audience+reading_time_minutes+display_order+is_active+icon+created_at+updated_at+created_by)|help_faqs(id+question+answer+category+target_audience+display_order+is_active+created_at+updated_at+created_by)
STEP-FORMAT:[{target:.css-selector+content:step-content+title:optional+placement:bottom+disableBeacon:true}]|content-formatting[headers:#-H1-##-H2-###-H3+lists:--Item-or-1.-Item+paragraphs-separated-by-double-newlines]
USER-WORKFLOWS:Browse[/helpâ†’tabs:Tours-Guides-FAQs+search-real-time-filtering-titles-desc-questions-answers+filtering-auto-by-user-role-target_audience+category-badges-color-coded]|Take-Tour[click-Start-Tourâ†’navigates-required-route-preserves-?tour=xxx-paramâ†’interactive-overlay-highlights-UIâ†’follow-prompts-Next-Back-navâ†’skip-close-anytime+features:auto-scroll-150px-offset-accounts-header-nav+progress-indicator+keyboard-nav+mobile-responsive+route-specific-auto-nav+query-param-preservation]|Read-Guide[click-Read-Guideâ†’opens-full-screen-dialogâ†’scroll-formatted-contentâ†’close+display:clean-typography-proper-spacing+formatted-headers-lists-paragraphs+reading-time-shown+scrollable]|View-FAQs[accordion-grouped-by-categoryâ†’click-question-expand-answerâ†’only-one-open-at-time+color-coded-category-badges]
ADMIN-WORKFLOWS:Manage-Tours[Adminâ†’Help-Centerâ†’Toursâ†’create-edit-del+set-category-audience-duration+write-Joyride-steps-JSON+toggle-visibility+reorder-display_order]|Manage-Guides[Adminâ†’Help-Centerâ†’Guidesâ†’create-edit-del+write-markdown-content+set-reading-time-estimate+toggle-visibility+organize-by-category]|Manage-FAQs[Adminâ†’Help-Centerâ†’FAQsâ†’create-edit-del+set-category-grouping+reorder-within-categories+toggle-visibility]
CATEGORIES:tours[general-feature-role-specific-getting-started]|guides[general-getting-started-features-advanced]|faqs[general-account-sponsorship-technical-billing]
TARGET-AUDIENCES:all-bestie-caregiver-supporter-vendor-admin
COMPS-PUBLIC:HelpCenter.tsx[search-bar-real-time+tabbed-interface-Tours-Guides-FAQs+card-grid-layouts+empty-states]|ProductTourRunner.tsx[Joyride-wrapper-custom-styling+callback-completion-handling+manual-close-btn-overlay+themed-app-design]|GuideViewer.tsx[full-screen-dialog+markdown-rendering+scrollable-metadata+reading-time]|FAQSection.tsx[accordion-display+category-grouping+badge-color-coding+collapsible-answers]
COMPS-ADMIN:HelpCenterManager.tsx[tab-switcher-Tours-Guides-FAQs+delegates-specialized-managers]|TourManager.tsx[CRUD-tours+JSON-editor-steps+form-validation+visibility-toggles]|GuideManager.tsx[CRUD-guides+large-textarea-content+reading-time-input+preview-capability]|FAQManager.tsx[CRUD-faqs+question-answer-fields+category-assignment+quick-visibility-toggle]
RLS:all-tables[SELECT-active-items-visible-everyone+ALL-admins-create-update-delete]|security:content-filtered-is_active+no-user-auth-required-view+only-admins-manage
DEPENDENCIES:react-joyride[product-tours]+@radix-ui/react-dialog[guide-viewer-modal]+@radix-ui/react-accordion[FAQ-display]
TOUR-SYSTEM:navigation-preserves-?tour=xxx-query-param+auto-element-detection-5s-timeout-fallback+150px-scroll-offset-prevents-header-nav-overlap|beacon-all-tours-disableBeacon:true-applied-auto-ProductTourRunnerâ†’tooltips-appear-immediately-no-glowing-orange-dot-no-user-click-required-applied-all-tours-system-wide|reliability-query-param-preservation-route-changes+element-availability-checking-before-start+graceful-fallback-elements-not-found+proper-cleanup-unmount

## ORDER_TRACKING_CONCISE
OVERVIEW:vendors-manually-enter-tracking-via-AfterShip-integration-customers-view-tracking-details-click-through-AfterShip-live-updates
DB:order_items-tracking-fields[tracking_number+carrier+tracking_url+fulfillment_status-pending-shipped-delivered+shipped_at+delivered_at+vendor_id+platform_fee+vendor_payout+stripe_transfer_id]|orders[id+customer_id+total_amount+status-pending-completed-cancelled+shipping_address-JSONB+billing_address-JSONB+stripe_payment_intent_id+notes]
EDGE-FUNCS:submit-tracking[auth-yes-vendor-must-own-order-item+request:{orderItemId+trackingNumber+carrier}+flow:verify-vendor-ownershipâ†’call-AfterShip-API-create-trackingâ†’update-order_items-tracking-dataâ†’set-fulfillment_status:shipped+shipped_at:now()â†’response:{success+tracking:{trackingNumber+carrier+trackingUrl}}]|aftership-webhook[âš ï¸NOT-FUNCTIONAL-status-blocked-requires-upgraded-AfterShip-account+future-flow-receive-status-updatesâ†’update-fulfillment_statusâ†’set-delivered_at]
FRONTEND:VendorOrderDetails[Vendor-Dashboardâ†’Ordersâ†’View-Details+pending-items-input-tracking-number+carrier-dropdownâ†’Mark-as-Shipped+shipped-items-display-tracking-read-only+carrier-badge+Mark-as-Delivered-fallback]|OrderHistory[route:/orders+display-order-cards-ID-date-status-shipping-address-items-fulfillment-badges+tracking-shows-tracking-number+carrier+Track-Package-btn-opens-tracking_url]
CONFIG:AfterShip-API[secret-AFTERSHIP_API_KEY+base-URL-https://api.aftership.com/v4+endpoint-POST-/trackings+supported-carriers-UPS-USPS-FedEx-DHL-1000-available]|edge-func-config[submit-tracking-verify_jwt-true+aftership-webhook-verify_jwt-false-uses-AfterShip-signature]
STATUS-BADGE-COLORS:order[pending-yellow+completed-green+cancelled-red]|fulfillment[pending-yellow+shipped-blue+delivered-green]
IMPLEMENTED:âœ…manual-tracking-submission-vendorâ†’DBâ†’AfterShip+customer-tracking-view-/orders-page-with-AfterShip-links+vendor-fulfillment-workflow-mark-shipped-delivered+full-DB-structure-with-timestamps
NOT-IMPLEMENTED:âŒAfterShip-webhooks-automatic-status-updates+email-notifications-shipping-delivery-confirmations+in-app-tracking-timeline-multi-tracking-per-item-returns+analytics-delivery-times-success-rates
SECURITY-RLS:order_items[vendors-UPDATE-SELECT-their-items+customers-SELECT-their-orders]|orders[customers-SELECT-their-orders+vendors-SELECT-orders-with-their-products+admins-ALL]|no-DELETE-allowed-audit-trail

## TERMS_PRIVACY_SYSTEM
OVERVIEW:enforces-acceptance-Terms-of-Service-Privacy-Policy-with-version-tracking-automatic-enforcement-audit-trail
DB:terms_acceptance(user_id+terms_version+privacy_version+accepted_at+ip_address+user_agent+UNIQUE-constraint-user_id-terms_version-privacy_version)|RLS:users-view-insert-own+admins-view-all
VERSION-MGMT:current-versions-src/hooks/useTermsCheck.ts[CURRENT_TERMS_VERSION-1.0+CURRENT_PRIVACY_VERSION-1.0]|update-process:increment-version-constantsâ†’update-Last-Updated-date-in-pagesâ†’deployâ†’users-prompted-next-login
COMPS:TermsAcceptanceDialog[non-dismissible-modal-requiring-checkbox+btn-click+links-Terms-Privacy-pages-new-tabs+calls-record-terms-acceptance-edge-func+triggers-onAccepted()-callback-on-success]|TermsAcceptanceGuard[wraps-app-App.tsx-enforces-terms-site-wide+hides-dialog-public-pages:/+/auth+/terms+/privacy+reloads-page-after-acceptance-refresh-data+shows-dialog-when-needsAcceptance=true-from-useTermsCheck]|useTermsCheck-hook[returns:{needsAcceptance+loading+recordAcceptance}+queries-terms_acceptance-for-user+current-versions+updates-on-auth-state-changes]
EDGE-FUNC:record-terms-acceptance[auth-required-JWT-token+request:{termsVersion+privacyVersion}+process-authenticates-userâ†’extracts-IP-user-agentâ†’inserts-into-terms_acceptance+audit-logs-IP-user-agent-timestamp+errors-ignores-duplicates+returns-400-on-auth-DB-failure]
PAGES:Terms-of-Service[/terms-16-sections-service-desc-community-features-sponsorships-refund-policy-user-conduct-marketplace-liability-etc+version-1.0-Last-Updated-Jan-6-2025]|Privacy-Policy[/privacy-16-sections-data-collection-payment-processing-privacy-rights-donor-privacy-CCPA-GDPR-compliance-etc+version-1.0-Last-Updated-Jan-6-2025+emphasizes-donor-privacy-7-year-IRS-retention]
USER-WORKFLOWS:First-Time[signupâ†’redirected-protected-pageâ†’dialog-appears-no-acceptance-recordâ†’check-I-agreeâ†’click-Accept-Continueâ†’edge-func-recordsâ†’page-reloads]|Existing-After-Version-Update[version-incremented-codeâ†’loginâ†’useTermsCheck-finds-no-record-new-versionâ†’dialog-appearsâ†’user-re-acceptsâ†’new-record-created-old-records-preserved]|Guest-Sponsor[guest-sponsors-without-account-no-terms-requiredâ†’later-creates-accountâ†’dialog-appears-first-loginâ†’accepts-termsâ†’full-access-granted]
ADMIN-FEATURES:User-Management-view-acceptance-status-per-user-version-date|Compliance-Reporting-full-audit-trail-user-ID-timestamp-IP-user-agent-versions|Export-query-terms_acceptance-table-filter-by-date-export-to-CSV
SECURITY-COMPLIANCE:legal-requirements[audit-trail-IP-user-agent-timestamp+version-tracking-separate-Terms-Privacy+explicit-consent-checkbox+btn+non-repudiation-unique-DB-constraint+RLS-policies-prevent-tampering]|data-protection[HTTPS+encrypted-at-rest+RLS-enforcement+no-deletion]|GDPR[user-access-to-records+consent-before-processing+clear-mechanism]|CCPA[disclosure-in-Privacy-Policy+no-personal-data-sales]
KEY-DESIGN-DECISIONS:non-dismissible-dialog-legal-requirement-proves-user-awareness|page-reload-ensures-fresh-data-avoids-state-sync-issues|IP-logging-legal-proof-fraud-detection-compliance|unique-constraint-prevents-duplicates-maintains-audit-clarity|edge-function-adds-audit-metadata-IP-user-agent-to-DB-records

## SPONSOR_PAGE_SYSTEM
ROUTE:/sponsor-bestie?bestieId={optional}-one-time-monthly-sponsorships-via-Stripe
PAGE-FEATURES:dynamic-section-ordering-from-sponsor_page_sections-table+URL-param-handling[?bestieId=xxxâ†’pre-select+move-to-top|no-paramâ†’randomize]+blocks-besties-from-sponsoring-role-check+Stripe-checkout-integration
KEY-STATE:besties+selectedBestie+frequency[one-time-monthly]+amount+email[auto-filled-logged]+fundingProgress+sections+pageContent+featuredVideo
SECTIONS:header+featured_video+sponsor_carousel+selection_form+impact_info[renders-only-is_visible:true+ordered-by-display_order]
DISPLAY-COMP:SponsorBestieDisplay[single-card-or-carousel-7s-auto-advance-pauses-manual-nav-TTS+card-elements:image-aspect-ratio-preserved+Available-for-Sponsorship-badge+Youre-Sponsoring-badge-if-active+text-sections-TTS-on-first+voice-note-player+funding-progress-bar-if-monthly_goal>0+Sponsor-This-Bestieâ†’/sponsor-bestie?bestieId={id}+Fully-Funded-message-if-is_fully_funded-or-â‰¥100%+carousel-controls-Prev-Next-arrows-Play-Pause-dot-indicators-inside-card-bottom]
DATA:fetches-sponsor_besties-active+randomizes+checks-user-sponsorships+loads-sponsor_bestie_funding_progress-view
CONTROLS-POSITION:all-carousel-navigation-controls-rendered-inside-each-card-matches-FeaturedItem-pattern
DB:sponsor_besties(id+bestie_id[nullable]+bestie_name+image_url+voice_note_url+text_sections[jsonb:[{header+text}]]+aspect_ratio[def:9:16]+monthly_goal+is_active+is_fully_funded)|sponsor_page_sections(id+section_key[unique]+section_name+is_visible+display_order+content[jsonb])|sponsor_bestie_funding_progress-VIEW[returns-sponsor_bestie_id+bestie_id+bestie_name+current_monthly_pledges-SUM-active-monthly+monthly_goal+funding_percentage+remaining_needed]
ADMIN-CONTROLS:SponsorBestieManager[Adminâ†’Sponsorshipsâ†’Sponsor-Besties-CRUD-create-edit-del+upload-image+voice-note-app-assets+add-text-sections-min-1+set-aspect-ratio-monthly-goal+toggle-active-fully-funded]|SponsorPageOrderManager[Adminâ†’Sponsorshipsâ†’Sponsor-Page-Order-drag-drop-sections-dnd-kit+toggle-visibility-green-eye-visible-red-eye-off-hidden+auto-saves]|SponsorBestiePageManager[Adminâ†’Sponsorshipsâ†’Page-Content-edit-badge-text-heading-description-featured-video-dropdown+saves-to-app_settings.sponsor_page_content-as-JSON]
SPECIAL-RULES:URL-param[with-?bestieId=xxxâ†’move-to-top+pre-select+scroll-to-form|withoutâ†’randomize+select-first]|role-blocking[besties-cannot-sponsor-check-user_roles.role-redirect-to-/community-if-bestie]|funding-display[progress-bar-only-if-monthly_goal>0|fully-funded-hide-button-show-success-when-is_fully_funded-OR-â‰¥100%]|carousel-auto-pause[pauses-on-manual-nav-TTS-playing-pause-btn+resumes-on-play-btn-audio-ends]|form-validation[min-$10-valid-email-Zod+email-auto-filled+disabled-if-logged+defaults-$25-monthly]|TTS-rendering[only-first-section-gets-TTS-btn-combines-header+text]
STRIPE-INTEGRATION:edge-func-create-sponsorship-checkout[request:{bestie_id+amount+frequency+email}+flow-authâ†’check-create-Stripe-customerâ†’create-priceâ†’create-session-payment-subscription-modeâ†’store-pendingâ†’return-URL+URLs-success:/sponsorship-success|cancel:/sponsor-bestie]
WORKFLOW:1-guardian-creates-approved-featured-bestie-postâ†’community-page|2-vendor-enters-3-emoji-codeâ†’creates-vendor_bestie_requests[pending]|3-guardian-approves-link-at-/guardian-approvalsâ†’vendor-can-request-assets|4-vendor-selects-assetâ†’creates-vendor_bestie_assets[pending]|5-guardian-approves-assetâ†’displays-vendor-store[/vendors/{id}]
DISPLAY:VendorBestieAssetDisplay.tsxâ†’layout:2-col-grid[md:grid-cols-2]+max-w-6xl-mx-auto|left:asset-AspectRatio-wrapper|right:bestie-name+description+TTS|badge:Bestie-of-Month[absolute-top-4-left-4]
DATA-FETCH:1-fetch-approved-assets-vendor_bestie_assets-by-vendor_id|2-enrich-profiles_public[display_name]+featured_besties[description+aspect_ratio]|3-cross-ref-asset_url-with-image_url-voice_note_url-for-metadata
RLS:SELECT[vendors-own|guardians-linked-besties|public-approved-on-store]|INSERT[approved-vendors-only]|UPDATE[guardians-approve-reject|admins-full]
ISSUES:images-enormousâ†’add-max-w-6xl-mx-auto|missing-name-descâ†’enrich-featured_besties|wrong-aspectâ†’parse-string-9:16-to-decimal-9/16
FILES:VendorBestieAssetDisplay.tsx|VendorBestieLinkRequest.tsx|VendorLinkedBesties.tsx|VendorProfile.tsx|VendorLinkRequests.tsx|VendorAssetRequests.tsx
