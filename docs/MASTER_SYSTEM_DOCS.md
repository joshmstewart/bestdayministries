MASTER_SYSTEM_DOCS

## GUARDIAN_APPROVALS|/guardian-approvals|caregiver-only
TABS:posts(discussion_posts.approval_status=pending_approval+linked_bestieâ†’approve[approved+is_moderated=true]|reject[rejected]|del)|comments(discussion_comments.approval_status=pending_approval+linkedâ†’approve|reject)|vendors(VendorLinkRequests:vendor_bestie_requests.status=pending+linkedâ†’approve[status=approved]|reject[rejected])|messages(BestieSponsorMessages:sponsor_messages.status=pending_approval+linkedâ†’approve-as-is[status=approved]|edit-approve[subject/text/img-crop-recrop/vid-upload+from_guardian=true+saveâ†’app-assets/sponsor-messages/]|reject[reason])
FLAGS:caregiver_bestie_links(require_post_approval|require_comment_approval|require_message_approval[def:true]|require_vendor_asset_approval)
BADGE:useGuardianApprovalsCountâ†’SUM(pending:posts+comments+vendor_links+messages)â†’realtime-subscriptionsÃ—4
RLS:is_guardian_of(guardian_id,bestie_id)â†’UPDATE(discussion_posts|discussion_comments|vendor_bestie_requests|sponsor_messages)
FILES:GuardianApprovals.tsx|VendorLinkRequests.tsx|BestieSponsorMessages.tsx|useGuardianApprovalsCount.ts
ISSUES:emptyâ†’check-links|count-no-updateâ†’verify-realtime-cleanup|cant-approveâ†’check-is_guardian_of-func

## VIDEO_SYSTEM
COMPS:VideoPlayer(HTML5+auto-hide-controls+dynamic-aspect-from-meta+max-w-md[vert]|max-w-2xl[land]+NO-object-fit[critical:bars/crop])|YouTubeEmbed(iframe+parse-all-YT-URL+def:16:9)|YouTubeChannel(promo-section+custom-YT-logo+config[badge+heading+desc+URL]+card-gradient-bg)
DB:videos(id|title|video_url[uploads]|youtube_url[embeds]|video_type|thumbnail_url|description|category|is_active|display_order)|about_sections.youtube_channel(content.badge_text|heading|description|channel_url|button_text)|storage:videos-bucket[100MB]+RLS[public-SELECT-active+admins-ALL]
ADMIN:VideoManagerâ†’Admin-Videosâ†’upload/embed+thumbnails+meta+toggle-vis+reorder[drag-drop]+del|YouTube-Channelâ†’Admin-Aboutâ†’Edit-youtube_channel-sectionâ†’config[URL+button-text+desc]
INTEGRATIONS:discussion_posts(video_id[link-table]|youtube_url[direct])|app_settings.sponsor_page_content.featured_video_id|videos-page[gallery+fullscreen-dialog]|about-page(youtube-channel-section[about_sections]+doc-watch-btns[YT/Vimeo/Dailymotionâ†’about_sections.content.doc_*_url])
RULES:VideoPlayer:YES[dynamic-aspectRatio-inline+w-full-h-full+grad-overlays]NO[object-fit+fixed-aspect]|YouTubeEmbed:YES[flex-URL-parse+AspectRatio-wrap+iframe-security]|YouTubeChannel:YES[red-YT-logo-SVG[rounded-rect+white-triangle]+btn-new-tab]NO[Lucide-YouTube-icon]
ISSUES:black-bars/cropâ†’rm-object-fit|wrong-sizeâ†’dynamic-style|YT-logo-wrongâ†’custom-SVG-red-bg-white-tri
FILES:VideoPlayer.tsx|YouTubeEmbed.tsx|VideoManager.tsx|YouTubeChannel.tsx|About.tsx[doc-section]

## VISIBILITY_TOGGLE_STANDARD
PURPOSE:btn-componentâ†’toggle-DB-UI-state[active/visible|inactive/hidden]
VISUAL:ACTIVE[bg-green-100+hover:bg-green-200+border-green-300+Eye-icon-text-green-700]|INACTIVE[bg-red-100+hover:bg-red-200+border-red-300+EyeOff-icon-text-red-700]
PATTERN:Button[variant=outline+size=icon+onClick=toggleFunction(id,state)+title=state?Deactivate:Activate+className=state?green-classes:red-classes]+icon=state?Eye[w-4-h-4-text-green-700]:EyeOff[w-4-h-4-text-red-700]
FILES:vendor/ProductList.tsx[product-vis]|admin/CommunityOrderManager.tsx[section-vis]|admin/FamilyOrganizationsManager.tsx[org-active]|admin/FeaturedItemManager.tsx[featured-active]|admin/FooterLinksManager.tsx[footer-sections-links]|admin/HomepageOrderManager.tsx[homepage-sections]|admin/NavigationBarManager.tsx[nav-links]|EventManagement.tsx[event-vis]
STANDARD:green=active/visible|red=inactive/hidden[consistent-across-all]

## BACK_BUTTON_PLACEMENT
SPACING:main[pt-4-with-navbar|pt-6-no-navbar]|btn[mb-6-standard|mb-4-dense]
STYLE:Button[variant=outline+size=sm]+ArrowLeft[mr-2-h-4-w-4]+"Back-to-[Destination]"[required-descriptive-text]
LAYOUT-STANDARD:main.flex-1.pt-4>container.mx-auto.px-4>Button.mb-6+Card
LAYOUT-BANNER:banner-div[h-32-bg-gradient]>container.mx-auto.px-4.h-full.flex.items-center>Button|container.mx-auto.px-4>relative-Card[-mt-8-mb-6-overlaps-banner]
MISTAKES:NO[mb-12+too-much|inconsistent-spacing|btn-inside-cards|different-variants|icon-only-missing-text]
A11Y:descriptive-text-required[not-just-icon]+min-44x44px-touch+color-contrast+semantic-button-with-onClick

## NAVIGATION_BAR
VISIBILITY:user+profile+roleâ‰ vendorâ†’shows|hidden-for[non-auth+vendors]|visible-for[bestie+caregiver+supporter+admin+owner]
SCROLL:shows[within-150px-top|scrolling-UP]|hides[past-150px+scrolling-DOWN]|CSS[translate-y-0-opacity-100-visible|-translate-y-full-opacity-0-hidden]
PAGE-SPACING:CRITICAL-all-pages-MUST-pt-24[96px-min-clearance-80px]|standard[pt-24]|with-banner[banner-overlap-content-below-pt-24]
LINKS:navigation_links(id|label|href|display_order|is_active=true)â†’internal[Link-to-href]|external[a-href-target-blank-rel-noopener]
STYLE:hover-burnt-orange+animated-underline+font-Roca
DIMENSIONS:height~112px[header-64px+nav-48px]|z-50|backdrop-blur
REALTIME:subscribes-navigation_linksâ†’auto-refresh
USER-BADGE:right-side+User-icon+capitalized-role
POSITION:absolute-top-full-overlays-content[not-push-down]|full-width-left-0-right-0|z-50|backdrop-blur
VENDOR-EXCLUSION:profile.roleâ‰ vendorâ†’prevents-display|vendors-use-/vendor-dashboard[separate-tabs:Products+Orders+Earnings+Settings]

## NOTIFICATION_BADGES
LOCATIONS:UnifiedHeader-Approvals-btn[caregivers-only:pending-posts+comments+vendor-linksâ†’useGuardianApprovalsCountâ†’red-top-right]|UnifiedHeader-Admin-btn[admins-only:moderationCount+pendingVendorsCountâ†’red-top-right]|Admin-Vendors-tab[pendingVendorsCountâ†’red-next-label]|Admin-Moderation-tab[useModerationCountâ†’red-next-label]|Guardian-Approvals-tabs[Posts:pendingPosts.length|Comments:pendingComments.length|Vendor-Links:pendingVendorLinksâ†’all-red/destructive]
INVENTORY-BADGES:Admin-Vendor-Mgmt[red-when-inventoryâ‰¤10]|Marketplace-Product-Cards[Out-of-Stock-when-inventory=0]|Vendor-Product-List[Out-of-Stock-when-inventory=0]
FEATURES:red-destructive-variant+realtime-subscriptions+auto-updates

## BESTIE_LINKING_SYSTEM
FRIEND-CODE:3-emojis[20-emoji-set=8000-combos]|storage:profiles.friend_code[TEXT-3-chars]|regen-doesnt-break-links[UUID-based]|emojis:ğŸŒŸğŸŒˆğŸ”¥ğŸŒŠğŸŒ¸ğŸ•ğŸ¸ğŸš€ğŸ†âš¡ğŸ¨ğŸ­ğŸªğŸ°ğŸŒµğŸ¦‹ğŸ‰ğŸ¯ğŸºğŸ–ï¸
GUARDIAN-BESTIE:table:caregiver_bestie_links(caregiver_id|bestie_id|relationship|approval-flags+timestamps)|flow:guardian-enters-3-emojiâ†’search-profiles_public[friend_code+role=bestie]â†’creates-link-with-approval-settings[posts+comments+featured-posts]|guardian-can:view-unlink-besties+toggle-approval-reqs+manage-featured-posts-sponsorships|RLS:caregivers-CRUD-own-links+besties-view-links
VENDOR-BESTIE:table:vendor_bestie_requests(vendor_id|bestie_id|status[pending/approved/rejected]|reviewed_by|message)|flow:vendor-submits-request[3-emoji+msg]â†’guardian-approves-rejects[/guardian-approvals]â†’approved-vendors-feature-ONE-bestie[vendors.featured_bestie_id]|vendor-can:view-pending-approved-links+feature-unfeature-bestie[shows-profile+marketplace]|guardian-can:approve-reject-requests|RLS:vendors-see-requests+guardians-approve-linked-besties
SPONSOR-BESTIE:table:sponsorships(sponsor_id|bestie_id|amount|frequency|status|stripe_subscription_id)|table:sponsorship_shares[share-view-access-other-besties]|flow:supporter-sponsors[/sponsor-bestie-via-Stripe]â†’webhook-creates-sponsorships[status:active]â†’supporter-shares-access[sponsorship_shares]|supporter-can:view-manage-subs[/guardian-links]+cancel-modify[Stripe-portal]+share-view-access|RLS:sponsors-besties-view-own+shared-users-via-can_view_sponsorship()
BEHAVIORS:friend-code-change:existing-links-preserved[UUID-based]+only-affects-NEW-links[like-changing-phone-old-contacts-still-have-you]|frontend-pattern:3-Select-components-map-FRIEND_CODE_EMOJIS[emoji+name]|components:GuardianLinks.tsx|VendorBestieLinkRequest.tsx|VendorLinkRequests.tsx|VendorLinkedBesties.tsx
USE-CASES:guardian-links-child[enter-codeâ†’set-relationshipâ†’toggle-approvals]|vendor-features-bestie[requestâ†’guardian-approvesâ†’vendor-features]|supporter-sponsors[browse-/sponsor-bestieâ†’payâ†’share-access]|bestie-regenerates-code[old-links-stay+new-code-future-connections]
SECURITY:is_guardian_of(_guardian_id,_bestie_id)
NOT-IMPLEMENTED:bestie-initiated-linking|link-expiration|email-notifications|rate-limiting|multi-guardian-support|vendor-unlink|friend-code-history|approval-notifications

## EVENTS_SYSTEM
TYPES:single[is_recurring:false+only-event_date]|recurring-multi[is_recurring:true+event_dates-entriesâ†’separate-card-per-date]|recurring-template[is_recurring:true+no-event_datesâ†’shows-primary-date-only]
DISPLAY:upcoming[dateâ‰¥now+chronological+each-date=card]|past[date<now+expires_after_date=false+reverse-chron+grayscale+Past-Event-badge]|expiration[expires_after_date=trueâ†’past-dates-hidden]|role-filter:client-side-filter-visible_to_roles
CARD-COMPS:image[AspectRatio-wrapper+parse-string-9:16â†’decimal-9/16]|dates[primary-large-box+all-dates-list-if-multi+current-highlighted]|TTS[reads-title+desc+date+location]|location[clickable-LocationLinkâ†’Google-Maps]|audio[inline-AudioPlayer-if-audio_url]
DETAIL-DIALOG:click-cardâ†’EventDetailDialog[full-details+all-dates+recurrence-info+audio+location]
LINKED-EVENTS:URL:/events?eventId=xxx[from-discussion-posts-via-event_id]â†’auto-opens-dialog+bypasses-expiration-for-linked
MODERATION:image:moderate-image-edge-func-on-uploadâ†’stores-moderation_status+moderation_severity+moderation_reason
ADMIN:/event-managementâ†’create-edit[title+desc+date-time+recurrence+image-crop-aspect+audio+visibility-roles+expiration-toggle]|add-multi-dates[edit-eventâ†’Add-Dateâ†’creates-event_dates-entry]
DB:events(title|description|image_url|audio_url|location|event_date|aspect_ratio[def:9:16]|is_recurring|recurrence_type|expires_after_date|visible_to_roles[]|is_active)|event_dates(event_id|event_date)|event_attendees(event_id|user_id|status[future])
RLS:SELECT[all-auth-client-filter]|INSERT[auth-users]|UPDATE-DELETE[author-or-admin]|event_dates[creator-only]
ISSUES:not-showingâ†’check-is_active+visible_to_roles+user-role|wrong-aspectâ†’parse-string-to-decimal|past-visibleâ†’check-expires_after_date|recurring-shows-onceâ†’add-event_dates
FILES:EventsPage.tsx|EventManagement.tsx|EventDetailDialog.tsx|moderate-image/index.ts

## SPONSORSHIP_SYSTEM
GUEST-CHECKOUT:no-account-requiredâ†’stored-with-sponsor_email[no-sponsor_id]|trigger:link_guest_sponsorships()-on-signupâ†’auto-links-when-email-matches|RLS:logged-users-view-by-email-match|msg:"sponsorship-auto-link-when-create-account-with-email"
FUNDING-PROGRESS:only-if-monthly_goal>0|calc:SUM-active-monthly-sponsorships|fully-funded:is_fully_funded-OR-funding_percentageâ‰¥100
MESSAGE-APPROVAL:controlled-per-link:require_message_approval|guardian-edit-before-approve[add-images+modify-text]|status:pending_approvalâ†’approvedâ†’sent[auto-on-sponsor-view]|besties-see:Approved-Delivered-after-guardian-approval
SPONSOR-BESTIE-VS-ACTUAL:sponsor_besties.idâ†’listing-ID[used-in-sponsorships]|sponsor_besties.bestie_idâ†’optional-link-to-user|allows:generic-sponsorships-without-user-accounts
IMAGE-HANDLING:upload-to-app-assets|guardian-crop-with-aspect-ratio|display-supports-audio+image-together
DB:sponsor_besties(id|bestie_id[nullable-link-user]|bestie_name|image_url|voice_note_url|video_url|text_sections[jsonb:[{header,text}]]|aspect_ratio[def:9:16]|monthly_goal|is_active|is_fully_funded|available_for_sponsorship|start_date|end_date)|sponsorships(id|sponsor_id|bestie_id|sponsor_bestie_id|amount|frequency[one-time/monthly]|status[active/cancelled/paused]|stripe_subscription_id|stripe_customer_id|stripe_mode[test/live]|sponsor_email[nullable-guest]|receipt_sent|receipt_sent_at|receipt_number|started_at|ended_at)|sponsor_messages(id|bestie_id|sent_by|subject|message|audio_url|image_url|video_url|status[pending_approval/approved/sent/rejected]|from_guardian|is_read|rejection_reason|approved_by|approved_at|sent_at|moderation_status|moderation_reason)|caregiver_bestie_links(allow_sponsor_messages|require_message_approval[both-def:true]|show_sponsor_link_on_guardian|show_sponsor_link_on_bestie)|sponsor_page_sections(section_key[unique:header/featured_video/sponsor_carousel/selection_form/impact_info]|section_name|is_visible|display_order|content[jsonb])|receipt_settings(organization_name|organization_address|tax_id[EIN]|from_email|reply_to_email|website_url|receipt_footer_text)|year_end_summary_settings(email_subject|email_intro_text|tax_notice_text|is_enabled)|year_end_summary_sent(user_id|user_email|user_name|tax_year|total_amount|sent_at|resend_email_id|status)
VIEWS:sponsor_bestie_funding_progress[sponsor_bestie_id|bestie_name|current_monthly_pledges|monthly_goal|funding_percentage|remaining_needed]|sponsorship_year_end_summary[sponsor_email|sponsor_name|tax_year|total_amount|total_donations|donations[jsonb-array]]
EDGE-FUNCS:create-sponsorship-checkout[no-authâ†’supports-guest|get-create-stripe-customer-by-email|create-price|checkout-session[subscription-monthly|payment-one-time]|store-bestie_id-metadataâ†’return-url]|verify-sponsorship-payment[session_idâ†’verify-stripe|get-email-from-session|find-user-by-email|check-existing-by-stripe_subscription_id|insert-sponsorships[if-user:sponsor_id=user.id+sponsor_email=NULL|if-guest:sponsor_id=NULL+sponsor_email=email]â†’return-msg[guest:"auto-link-when-create-account"]]|manage-sponsorship[auth-tokenâ†’get-stripe-customer-by-email|create-billing-portalâ†’return-url-redirect-stripe-portalâ†’webhooks-handle-status-updates]|update-sponsorship[sponsorship_id+new_amountâ†’auth+verify-owns-sponsorship[active-monthly-only]|validate-amount[$10-$500]|find-stripe-sub-by-email+bestie_id|update-stripe-price|update-DB-amountâ†’return-success]|send-sponsorship-receipt[sponsorship_idâ†’fetch-details+settings|get-org-logo-app-settings|gen-receipt-HTML[number:RCPT-YYYYMMDD-XXXXX+sponsor+org+amount+date+bestie+EIN+disclaimer]|send-Resend-API|update-sponsorships[receipt_sent=true+receipt_sent_at+receipt_number]â†’return]|generate-missing-receipts[admin-onlyâ†’query-receipt_sent=false|loop-call-send-sponsorship-receipt|log-eachâ†’return-summary[total+successes+failures]]|generate-year-end-summary[taxYear?+sendEmail?â†’auth|query-view-email+year|if-no-data+!sendEmail:gen-mock|fetch-settings+logo|build-HTML[header-logo-year+total-box+itemized-table[date+bestie+amount+receipt#]+tax-box[EIN+notice]+footer]|if-sendEmail:send-Resend+log-year_end_summary_sentâ†’return-HTML+metadata[isMockData-flag]]
WEBHOOKS:stripe-webhook[ACTIVE-dual-test+live]|events:customer.subscription.deleted[activeâ†’cancelled+set-ended_at]|customer.subscription.updated[3-states:cancel_at_period_end=trueâ†’stay-active-set-ended_at-to-cancel_at|status=activeâ†’active-clear-ended_at|otherâ†’cancelled-set-ended_at-now]â†’checks-metadata-bestie_id|checkout.session.completed[create-update-sponsorship|extract-amount-centsâ†’dollars|set-frequency-by-interval|status:active+started_at:now|store-stripe_mode]
STATUS-FLOW-PROGRESS:statuses[active-counts-funding|cancelled-excluded|paused-future]|view-recalc:SUM(amount)-WHERE-status=active+frequency=monthly|progress:(current/goal)*100|fully-funded:percentageâ‰¥100-OR-is_fully_funded=true|ending-amount-scheduled-cancels:sponsorships-with-ended_at-set-still-in-periodâ†’progress-bar-2-segments[stable-green+ending-yellow]|UI-update:user-cancels-portalâ†’webhook-updates-statusâ†’view-recalcs-excludes-cancelledâ†’frontend-queriesâ†’bar-updates-auto
REALTIME:useGuardianApprovalsCount[subscribes:discussion_posts+discussion_comments+sponsor_messages+caregiver_bestie_linksâ†’updates-badge-immediately]|useSponsorUnreadCount[subscribes:sponsor_messages+sponsorshipsâ†’updates-when-read-sent]|SponsorMessageInbox[subscribes:sponsor_messages-filtered-bestie_idâ†’updates-new-status-changes]
COMPS-DISPLAY:SponsorBestieDisplay.tsx[carousel+TTS+audio+funding-progress]|FundingProgressBar.tsx[visual-indicator]
COMPS-FORM:BestieSponsorMessenger.tsx[bestie-composition]|GuardianSponsorMessenger.tsx[guardian-future]
COMPS-GUARDIAN:BestieSponsorMessages.tsx[approval-interface+edit-dialog]|VendorAssetRequests.tsx[asset-approval-pattern]
COMPS-SPONSOR:SponsorMessageInbox.tsx[accordion-list+read-status]|DonationHistory.tsx[table+receipt-downloads]
COMPS-ADMIN:SponsorBestieManager.tsx[CRUD-listings]|SponsorPageOrderManager.tsx[section-ordering]|SponsorBestiePageManager.tsx[header-editor]|SponsorshipTransactionsManager.tsx[transaction-view-mgmt]|ReceiptSettingsManager.tsx[org-receipt-config]|YearEndSummarySettings.tsx[year-end-email-config]|YearEndSummarySentHistory.tsx[sent-history]|StripeModeSwitcher.tsx[test-live-toggle]
PAGES:/sponsor-bestie[public-page]|/sponsorship-success[post-payment]|/guardian-links[my-besties-sponsors+guardians]|/bestie-messages[bestie-center]|/guardian-approvals[guardian-hub]
TRIGGERS:link_guest_sponsorships()[ON-INSERT-auth.users-after-signupâ†’get-emailâ†’find-sponsorships[sponsor_email-match+sponsor_id-NULL]â†’update[set-sponsor_id=new-user+clear-sponsor_email]]|SECURITY-DEFINER-search_path=public
SECURITY-FUNCS:has_admin_access(_user_id)|is_guardian_of(_guardian_id,_bestie_id)|get_user_role(_user_id)|can_view_sponsorship(_sponsorship_id,_user_id)
STORAGE:app-assets-public[sponsor-besties/{id}/|sponsor-messages/{id}/+images-videos|logos/]|featured-bestie-audio-public[voice-notes|audio-recordings]
ISSUES:badge-no-updateâ†’check-realtime-cleanup|msg-no-imgâ†’display-logic-prioritizes-audio[FIXED:show-both]|aspect-btns-dont-workâ†’missing-onAspectRatioKeyChange|bestie-cant-sendâ†’allow_sponsor_messages=false|funding-not-calcâ†’no-monthly_goal|stripe-checkout-failsâ†’check-STRIPE_SECRET_KEY_TEST-LIVE|progress-no-update-after-cancelâ†’webhook-not-processing|cancelled-still-countsâ†’status-not-updated|portal-btn-no-workâ†’no-stripe-customer|receipt-not-sendingâ†’from-email-not-verified-Resend|receipt-sends-not-receivedâ†’SPF-DKIM-DNS|receipt-#-dupesâ†’system-clock-issue[uses-timestamp+random]|year-end-no-dataâ†’no-completed-donations-for-year|preview-failsâ†’receipt-settings-not-configured|mock-in-previewâ†’no-real-donations[expected]|email-logo-missingâ†’logo-URL-not-in-app-settings|EIN-validation-failsâ†’wrong-format[use-XX-XXXXXXX]|transactions-wrong-modeâ†’mode-not-stored-creation[check-stripe_mode]|test-payments-not-visibleâ†’viewing-live-only[toggle-switcher]|guest-not-linkingâ†’email-mismatch-or-trigger-failure|cant-view-after-signupâ†’email-mismatch|cant-update-amountâ†’not-monthly-or-not-active|update-amount-failsâ†’out-of-range[$10-$500]|shared-not-visibleâ†’friend-code-mismatch
NOT-IMPLEMENTED:guardian-initiated-msgs|sponsor-replies-2-way|analytics-dashboard[donation-trends-retention]|bulk-msg-all-sponsors|scheduled-msgs|msg-templates|sponsor-tiers-benefits|impact-reporting-monthly|auto-thank-emails|donor-recognition-levels[Bronze-Silver-Gold]|monthly-leaderboard-opt-in|sponsor-portal-self-service|multi-bestie-packages|recurring-reminders|gift-sponsorships

## VENDOR_BESTIE_SYSTEM
OVERVIEW:vendors-display-guardian-approved-featured-bestie-content[images+videos+voice-notes]-on-vendor-profile-with-guardian-approval-workflow|NOTE:vendor=status[vendors-table]+not-role[users-can-be-caregivers-besties-supporters-AND-vendors-simultaneously]
DB:featured_besties|vendor_bestie_requests|vendor_bestie_assets|caregiver_bestie_links

## ABOUT_PAGE_SYSTEM
ROUTE:/about|SECTIONS:Our-Story[badge+heading-gradient+story-para1+para2+decorative-orbs]|Documentary[title+desc+YT-Vimeo-Dailymotion-links+image+Film-icon-hover-scale+Button-outline-asChild-anchor-no-gradient]|BDE[logo-256px+desc1-2+address-city+status+btn-solid-brown-NO-GRADIENT+image]
ADMIN:Adminâ†’Aboutâ†’Edit-Best-Day-Story|EDITABLE:all-text-URLs-images-button-link-types[internal-page-vs-custom-URL]
DB:homepage_sections[section_key:about+content-JSONB]|SHARED:homepage-About-section+full-About-page
DESIGN:Documentary-btns[outline-white-bg-border-hover-accent]|BDE-btn[solid-brown-custom-HSL-NO-gradient-matches-section-palette]|images[object-cover+gradient-overlays]|BDE-colors[bg-hsl(27-41%-88%)+text-hsl(13-33%-36%)]
ISSUES:YT-link-blockedâ†’use-anchor-asChild|BDE-logo-too-largeâ†’w-64-max|btn-has-gradientâ†’use-variant-ghost-custom-bg|colors-not-themingâ†’use-HSL-check-index.css

## ADMIN_DASHBOARD
ROUTE:/admin|ACCESS:admin-owner-only[from-user_roles]|REDIRECT:non-adminsâ†’/community
STATS:Total-Users[profiles]+Events[events]+Posts[discussion_posts]+Featured-Besties[featured_besties]
TABS:Analytics[AnalyticsDashboard]|Users[UserManagement-view-edit-roles-perms-create-test-del-pwd-reset]|Events[redirect:/admin/events]|Albums[redirect:/admin/albums]|Videos[VideoManager]|Besties[sub-tabs:Featured+Sponsors+Page-Order+Content+Receipts+Transactions+Year-End-Settings+History]|Partners[PartnersManager]|Donations[SupportPageManager-webhook-complete-UI-pending]|Featured-Item[FeaturedItemManager-parallel-loading-optimized]|Vendors[VendorManagement-badge-pendingVendorsCount-sub-tabs:Vendors+Products+Orders]|Format-Pages[sub-tabs:Homepage+Community+About+Footer+Quick-Links+Navigation+Locations]|Moderation[badge:moderationCount+messageModerationCount-sub-tabs:Content+Messages+Policies]|Contact[badge:contactFormCount-ContactFormManager]|Help-Center[HelpCenterManager-sub-tabs:Tours+Guides+FAQs]|Product-Updates[ProductUpdateBroadcaster]|Notifications[EmailTemplatePreview]|Settings[sub-tabs:App-Settings+Avatars+Impersonation]
IMPERSONATION:useRoleImpersonation-hookâ†’localStorageâ†’affects-badges-visibility-perms
BADGES:useModerationCount+usePendingVendorsCount+useMessageModerationCount+useContactFormCount

## AUTH_SYSTEM
ROUTE:/auth|SIGNUP:email-pwd-display_name-role[supporter-bestie-caregiver]+avatar-optional+terms-checkboxâ†’supabase.auth.signUp-with-metadataâ†’TRIGGER:on_auth_user_createdâ†’handle_new_user()[inserts-profiles+user_roles]â†’call-record-terms-acceptance-edge-func[stores-IP-user-agent]â†’redirect-by-role-vendor-status
LOGIN:email-pwdâ†’supabase.auth.signInWithPassword()â†’check-vendorâ†’redirect:/vendor-dashboard-or-/communityâ†’TermsAcceptanceGuard-enforces-acceptance
PWD-RESET:Forgot-Passwordâ†’enter-emailâ†’supabase.auth.resetPasswordForEmail()â†’email-sentâ†’click-linkâ†’/auth-with-reset-tokenâ†’enter-new-pwd
ROLES:supporter[default-vendors-are-supporters-with-vendor-status]|bestie[can-be-sponsored]|caregiver[guardian-can-also-be-vendor]|moderator[can-moderate]|admin[full-admin]|owner[super-admin]
ASSIGNMENT:signup-user-selects[supporter-bestie-caregiver]|post-signup-admin-assigns-via-User-Management|vendor-status-applied-via-/vendor-auth[checked-via-vendors-table]|stored-in-user_roles-table[NEVER-in-profiles]
AVATAR:AvatarPicker-during-signupâ†’avatar_number-in-profiles[1-12]â†’AvatarDisplay-loads-from-src/assets/avatars/composite-{number}.png
TERMS:TermsAcceptanceGuard-wraps-App.tsxâ†’queries-terms_acceptance-for-user+versionâ†’TermsAcceptanceDialog-non-dismissible-modalâ†’trigger-on-version-change-or-first-loginâ†’versions:CURRENT_TERMS_VERSION-1.0+CURRENT_PRIVACY_VERSION-1.0[in-useTermsCheck.ts]
VENDOR-CHECK:after-loginâ†’query-vendors-table-by-user_idâ†’has-vendor-recordâ†’/vendor-dashboard|othersâ†’/community
SECURITY:handle_new_user()[SECURITY-DEFINER-SET-search_path-publicâ†’inserts-profile+role-with-elevated-privs-bypasses-RLS]|has_role(_user_id,_role)[SECURITY-DEFINER-checks-user_roles-prevents-privilege-escalation]
AUTO-CONFIRM:enabled-via-Adminâ†’Auth-Configâ†’skips-email-verification[non-production-testing]
RLS:profiles[users-see-own+guardians-see-linked-besties+admins-see-all]|user_roles[uses-has_admin_access()-admins-only-modify]

## BUTTON_STYLING_STANDARDS
VARIANTS:default[complex-gradient-bg-gradient-warm-primary-CTAs-hero]|outline[border-bg-on-hover-secondary-actions]|secondary[solid-bg-no-gradient-supporting-actions]|ghost[transparent-hover-bg-only-tertiary-actions]
GRADIENT-USE:âœ…primary-brand-actions[Join-Donate-Sponsor-Hero-CTAs]|brand-color-scheme[orange-mustard-matches-palette]|high-priority-conversions[payment-checkout-signup]|âœ—custom-color-schemes[non-brand-colors-eg-brown-BDE]|secondary-tertiary-actions[cancel-back-view-more]|outline-ghost-variants[never-by-design]
CUSTOM-COLOR-PATTERN:variant-ghost+className-bg-[hsl(13,33%,36%)]+hover:bg-[hsl(13,33%,36%)]/90+text-whiteâ†’solid-bg-removes-gradient-allows-custom-bg-via-className
GRADIENT-DEF:--gradient-warm[5-radial-gradients-over-burnt-orange-hsl(24-85%-56%)-liquid-appearance]|location:src/index.css
DECISION-TREE:primary-CTA?â†’brand-colors?[YESâ†’variant-default-gradient|NOâ†’variant-ghost-custom-bg]|NOâ†’secondary?[variant-secondary-solid]|tertiary?[variant-outline-or-ghost]
SIZES:sm[h-9-px-3]|default[h-10-px-4]|lg[h-11-px-8-Hero-CTAs]|icon[h-10-w-10-square]
A11Y:gradients[WCAG-AA-white-text]|custom-colors[contrastâ‰¥4.5:1]|focus-states[ring-offset-2+keyboard-nav+screen-reader-labels]

## COFFEE_SHOP_SYSTEM
ROUTE:/coffee-shop|DB:app_settings-key-coffee_shop_content[JSONB]
ADMIN:Adminâ†’Coffee-Shop-Website-tabâ†’EDITABLE:hero[heading+subheading+image-upload-crop-16:9â†’app-assets/coffee-shop/+compressed-4.5MB]|mission[title+description]|buttons[text+links:internal-page-dropdown[INTERNAL_PAGES]|custom-URL]|location[hours+address+phone]|menu-visibility-toggle
FRONTEND:CoffeeShopHome.tsxâ†’loads-settings-on-mountâ†’sections:Hero[bg-image+heading+subheading+CTA-btns]|Mission-statement-card|Hours-location-info-cards|Menu[conditionally-rendered-based-on-show_menu]
BUTTON-BEHAVIOR:internal-links[window.location.href]|anchor-links[#-smooth-scroll-to-element]|external-links[open-new-tab]
MENU:CoffeeShopMenu.tsx[coffee+specialty-drinks+crepes+ice-cream-hard-coded-from-original-menu.html]
ADMIN-PREVIEW:Preview-btnâ†’opens-/coffee-shop-new-tab|Live-Site-btnâ†’opens-bestdayevercoffeeandcrepes.com
CONTENT-STRUCTURE:{hero_heading+hero_subheading+hero_image_url+menu_button_text+menu_button_link+menu_button_link_type[internal-custom]+about_button_text+about_button_link+about_button_link_type+mission_title+mission_description+hours_title+hours_content+address+phone+show_menu[boolean]}

## COMMUNITY_PREVIEWS
PROFILE-LOADING:CRITICAL-fetch-profiles_public[includes-role-from-user_roles]â†’sets-effectiveRoleâ†’triggers-loadLatestContent()|profiles-table-has-no-roleâ†’effectiveRole-undefinedâ†’early-returnâ†’no-content-loads
DISCUSSION-PREVIEW:query:discussion_posts-select-*+author:profiles_public(id+display_name+role)-eq-is_moderated-true[NO-approval_status-filter]-order-created_at-desc-limit-1|visibility:no-role-check-if-is_moderated=true-shows-to-all
EVENTS-PREVIEW:query:events-select-*+event_dates(id+event_date)-eq-is_public-true-eq-is_active-true|visibility:client-side-filter-event.visible_to_roles.includes(effectiveRole)|date-logic:collect-all-dates[primary+event_dates]â†’filter[dateâ‰¥now+(!expires_after_date-OR-isUpcoming)]â†’sort-chron-limit-3â†’height-limit[MAX_HEIGHT-1200px-CARD_PADDING-24px-SPACING-16px-TEXT_HEIGHT-120pxâ†’calc-imageHeight-from-aspect+TEXT_HEIGHT+CARD_PADDING+SPACING]
GRID-LAYOUT:grid-cols-1-lg:grid-cols-2-gap-6
CARD-COMPS:Discussion[border-2-hover:border-primary/50+MessageSquare-icon-text-primary+img-full-w-h-48-object-cover+TTS-right-of-title-e.stopPropagation()]|Event[border-b-between-last:border-0+Calendar-icon-text-secondary+img-dynamic-aspect-from-event.aspect_ratio[def:9:16]+location-clickable-linkâ†’Google-Maps[noopener-noreferrer-hover-primary-underline]+audio-AudioPlayer-if-audio_url[propagation-stopped]+TTS-right-title-reads[title+desc+Scheduled-for-[date]+At-[location]]]
NAVIGATION:click-discussion-cardâ†’/discussions|click-event-cardâ†’/events|click-View-All-btnsâ†’respective-pages|TTS-location-links-e.stopPropagagation()-prevents-card-nav
TTS-TEXT:Discussion[${title}.${content}]|Event[[title+desc+Scheduled-for-[date]+location].filter(Boolean).join('. ')]
CRITICAL-RULES:1-Profile-fetch-profiles_public[includes-role]|2-Discussion-filter-only-is_moderated=true[no-approval_status]|3-Events-client-filter-by-role-after-DB-fetch|4-Height-events-limited-1200px-cumulative[aspect-ratio-aware]|5-Propagation-stop-TTS-location-audio-clicks|6-Visibility-check-community_sections-table|7-Empty-States-show-when-no-content
LOAD-SEQUENCE:checkUser()â†’fetch-sessionâ†’check-vendorâ†’redirect-if-vendorâ†’fetchProfile(userId)â†’from-profiles_publicâ†’getEffectiveRole(profile.role)â†’set-effectiveRoleâ†’useEffect-triggers-when-effectiveRoleâ‰ nullâ†’loadLatestContent()â†’fetch-discussions+eventsâ†’client-filter-events-by-roleâ†’render-visible-sections

## CONTACT_FORM_SYSTEM
OVERVIEW:contact-form-at-page-bottom-with-DB-storage+admin-email-notifications+reply-functionality+input-validation
DB:contact_form_settings(is_enabled[def:true]+title+description+recipient_email+success_message)|contact_form_submissions(name+email+subject[nullable]+message+message_type+image_url[nullable]+status[new-read]+replied_at[nullable]+replied_by[nullable]+reply_message[nullable]+admin_notes[nullable])
FRONTEND:ContactForm.tsx[auto-loads-settings-on-mount+autofills-email-logged-users+validates-Zod+saves-DB-always-succeeds+sends-email-optional-graceful-failure+shows-custom-success-msg+hides-if-is_enabled=false]|ContactFormManager.tsx[admin-interface:Settings-card+Submissions-table[columns:Name+Email-copy-icon+Subject+Status-badge+Date+Actions[View+Mark-Read-New+Delete]]+badge-count-new-submissions+realtime-updates]
VALIDATION:client[Zod:name-2-100+email-valid-max-255+subject-max-200-optional+message-10-2000]|server[edge-func:name-1-100-letters-spaces-hyphens-apostrophes+email-valid-lowercase-max-255+subject-max-200-optional+message-1-5000]
SECURITY:HTML-escaping-all-user-input+email-validation-client-server+rate-limiting-via-Supabase+CORS-headers+no-raw-SQL
EDGE-FUNCS:notify-admin-new-contact[sends-email-to-admin-on-new-submission+template-includes-details+color-coded-type-badges+View-in-Admin-btn+reply-to-header-submitter-email]|send-contact-reply[auth-required+server-Zod-validation+XSS-prevention-HTML-escape+CORS-headers+template-from-Best-Day-Ministries+reply-to-sender-email]
REPLY-METHODS:1-Email-Reply[admin-receives-notificationâ†’reply-in-email-clientâ†’response-to-submitter]|2-Manual-Email[admin-views-submissionâ†’click-email-or-copyâ†’compose-manually]|3-Admin-Reply-Interface[admin-views-submissionâ†’Reply-btnâ†’compose-reply-dialog+optional-admin-notes+Send-Replyâ†’email-to-submitter+tracked-in-DB+timestamp+admin-ID+auto-mark-read]
SETUP:1-Configure-Resend[signup-resend.com+CRITICAL-verify-domain-resend.com/domains-add-DNS-SPF-DKIM+create-API-key+add-RESEND_API_KEY-secret+update-from-address-verified-domain]|2-Configure-Settings[Adminâ†’Contactâ†’toggle-Enable-ON+set-title-desc+enter-recipient-email+customize-success-msg+Save]|3-Test[navigate-any-pageâ†’fill-formâ†’submitâ†’check-toast+submission-in-admin+email-received]
ISSUES:form-not-appear[is_enabled=falseâ†’enable-admin]|emails-not-sending[DOMAIN-NOT-VERIFIEDâ†’verify-resend.com/domains]|form-submits-no-email[Resend-not-configuredâ†’add-RESEND_API_KEY]|email-spam[domain-not-verifiedâ†’add-SPF-DKIM-DNS]|cant-reply[email-notifications-not-workingâ†’verify-domain-then-use-reply-to-in-email]

## DISCUSSION_SYSTEM
OVERVIEW:community-discussion-board[/discussions]-guardians-create-posts-users-comment-guardian-approval-workflow-bestie-content
DB:discussion_posts(title+content+author_id+image_url+video_id+youtube_url+album_id+event_id+approval_status[approved-pending_approval-rejected]+is_moderated[AI-flag]+visible_to_roles[]+allow_owner_claim)|discussion_comments(content+author_id+post_id+audio_url+approval_status+is_moderated)
PERMS:create-posts[guardians-admins-owners]|comment[all-auth]|edit-del-posts[author-guardian-of-bestie-author-admin-owner]|edit-del-comments[author-guardian-of-bestie-author-admin-owner]|view[based-on-visible_to_roles[]]|change-author[owners-only]
APPROVAL-FLOW:Bestie-Posts[bestie-createsâ†’check-caregiver_bestie_links.require_post_approvalâ†’if-any-guardian-requiresâ†’approval_status:pending_approvalâ†’guardian-approves-rejects-/guardian-approvalsâ†’on-approve:approved+is_moderated:true]|Guardian-Posts[auto-approved:approval_status-approved+still-AI-moderated]|Comments[same-pattern-check-require_comment_approval]
MODERATION-AI:text[moderate-content-edge-func-checks-title+content-before-save-flags-inappropriateâ†’is_moderated:false]|image[moderate-image-edge-func+policy-moderation_settings.discussion_post_image_policy[all-manual-review|flagged-AI-scan|none-auto-approve]â†’stores-moderation_status+moderation_severity+moderation_reason]
MEDIA:images[upload-discussion-images-bucket+compressed-4.5MB+crop-dialog-aspect-ratio+max-20MB-before-compression]|videos[option1-select-from-videos-table-admin-uploaded|option2-embed-YT-URL-direct-pasteâ†’displays-VideoPlayer-uploads-or-YouTubeEmbed-YT]|albums[link-via-album_idâ†’shows-cover+View-Album-btnâ†’opens-lightbox]|events[link-via-event_idâ†’shows-title-date-location+View-Event-btnâ†’/events?eventId=xxx]|audio-comments-only[record-or-uploadâ†’stored-featured-bestie-audio-bucketâ†’inline-player-in-comment-card]
UI-COMPS:Post-Card[Card-image-video-album-preview+CardHeader-AvatarDisplay-authorName-roleBadge-TextToSpeech-title+content+CardContent-title-content-linkedEvent-linkedAlbum-CommentSection]|Create-Post-Form[title-required-max-200+content-required-max-2000+image-upload-optional-with-crop+video-selection[none-select-youtube]+event-link-optional-dropdown+visibility-roles-checkboxes[caregiver-bestie-supporter]+Allow-Owner-Claim-checkbox-admins-owners]|Comment-Input[text-OR-audio-mutually-exclusive+audio-recorder-play-record-delete+submitâ†’guardian-approval-if-required]
SEARCH-SORT:search[filter-posts-title-content-case-insensitive]|sort[newest-first-default-or-oldest-first]|client-side-filtering-no-query-reload
EDIT-DELETE:posts[author-guardian-bestie-author-admin-edit-delete+edit-inline-form-title-content-media-allow_owner_claim-admins-owners-both-create-edit+delete-confirmation-cascade-deletes-comments+Change-Author-Owner-Only:admin-creates-post-checks-Allow-owner-claimâ†’owner-sees-Claim-Post-btnâ†’selects-new-author-from-admin-owner-listâ†’post-authorship-transfers]
REALTIME:subscribe-discussion_posts-new-posts+subscribe-discussion_comments-new-commentsâ†’auto-refresh
RLS:Posts-SELECT[approved-visible-to-roles-in-visible_to_roles[]+pending-rejected-only-author-guardian-admin]|Posts-UPDATE[author-can-update-own+guardians-can-update-linked-besties+admins-owners-can-update-any]|Posts-INSERT[guardians-admins-owners-only]|Comments-SELECT[approved-all-auth+pending-rejected-author-guardian-admin]|Comments-UPDATE[author-can-update-own+guardians-can-update-linked-besties+admins-owners-can-update-any]|Comments-INSERT[all-auth]
VALIDATION:title[1-200-chars]|content[1-2000-chars]|image[max-20MB-image-types-only]|youtube[valid-URL-format]

## DONATION_SYSTEM
OVERVIEW:general-donation-system-/support-page-one-time-monthly-recurring-via-Stripe-automated-webhook-status-updates
DB:donations(donor_id[nullable-links-profiles-auth]|donor_email[nullable-guest]|amount[numeric-dollars]|frequency[one-time-monthly]|status[pending-completed-one-time-active-monthly-cancelled]|stripe_customer_id+stripe_subscription_id[nullable-monthly]|stripe_mode[test-live]|started_at+ended_at+created_at+updated_at)
RLS:admins-view-all|donors-view-own[by-donor_id-OR-matching-email-from-auth.users]|public-INSERT[handled-by-edge-func-not-direct-client]
USER-WORKFLOW:/support-pageâ†’select-frequency[Monthly-One-Time]â†’select-preset-amount[$10-$25-$50-$100-$250]-or-custom[min-$5-max-$100k]â†’enter-email[auto-filled-logged-always-editable]â†’optional-check-Cover-processing-fees[adds-~3%]â†’accept-Terms-checkboxâ†’Donate-Nowâ†’redirects-Stripe-Checkoutâ†’after-payment-redirects-/support?donation=success
GUEST-CHECKOUT:no-account-requiredâ†’stored-donor_email-instead-donor_idâ†’when-user-creates-account-matching-email-donations-could-link-future
EDGE-FUNCS:create-donation-checkout[no-JWT-public-access+request:{amount+frequency+email+coverStripeFee}+validation-Zod-$5-$100k+flow:get-Stripe-mode-app_settings[test-live]â†’calc-final-amount-with-optional-fee-coverageâ†’create-retrieve-Stripe-customer-by-emailâ†’create-Stripe-Checkout-session[mode:payment-one-time-subscription-monthly+metadata:{type:donation+frequency+amount+coverStripeFee+donation_type:general}]â†’insert-pending-donation-DBâ†’return-url-redirect]|stripe-webhook[auth-Stripe-signature+dual-mode-test-live+events:checkout.session.completed-with-metadata.type=donation[one-time-mode:paymentâ†’UPDATE-status=completed|monthly-mode:subscriptionâ†’UPDATE-status=active+stripe_subscription_id+started_at]|customer.subscription.updated-with-metadata.type=donation[updates-status-based-on-state:activeâ†’status=active+ended_at=NULL|scheduled-cancelâ†’status=active+ended_at=cancel_at|cancelledâ†’status=cancelled+ended_at=NOW()]|customer.subscription.deleted-with-metadata.type=donationâ†’UPDATE-status=cancelled+ended_at=NOW()]
FRONTEND:DonationForm.tsx[frequency-toggle-Monthly-One-Time+preset-amount-btns-$10-$250+custom-amount-input-validation+email-input-auto-filled-profile+Cover-fees-checkbox+Terms-acceptance-checkbox+amount-summary-display]|validation[amount-min-$5-max-$100k+email-valid-required+terms-must-accept]|state[frequency+amount+email+acceptedTerms+coverStripeFee+loading]
STATUS-FLOW:One-Time[pendingâ†’checkout.session.completedâ†’completed]|Monthly[pendingâ†’checkout.session.completedâ†’activeâ†’customer.subscription.updated-with-cancel_at_period_endâ†’active-with-ended_at-setâ†’customer.subscription.deletedâ†’cancelled]
STRIPE-FEE-COVERAGE:formula-finalAmount=(amount+0.30)/0.971|example[$25-donation+~$0.75-fee=$25.75-chargedâ†’net-to-org-$25]|implementation-checkbox-UI+calculated-create-donation-checkout+passed-Stripe-unit_amount-cents
DIFFERENCES-FROM-SPONSORSHIPS:purpose[donations-general-support-vs-sponsorships-specific-bestie]|recipient[org-vs-bestie-via-org]|metadata[type:donation-vs-bestie_id]|table[donations-vs-sponsorships]|UI[/support-vs-/sponsor-bestie]|guest-checkout[both-supported]|monthly[both-available]|receipts[not-implemented-vs-automated]|year-end-summaries[not-implemented-vs-automated]
IMPLEMENTED:âœ…one-time-Stripe-Checkout+monthly-recurring-subscriptions+guest-checkout-no-account+Stripe-fee-coverage-option+dual-mode-test-live+automatic-status-webhooks+email-validation-sanitization+Terms-acceptance-required
NOT-IMPLEMENTED:âŒautomated-receipt-generation-like-sponsorships+donation-history-page-for-donors+update-monthly-amount-ability+Stripe-Customer-Portal-link-subscription-mgmt+year-end-tax-summaries+admin-view-all-donations+donation-analytics-dashboard+email-notifications-successful-donations+linking-guest-donations-to-accounts-on-signup+multiple-payment-methods-beyond-cards+recurring-donation-reminders+honor-memorial-dedications+matching-gift-programs

## HELP_CENTER_SYSTEM
OVERVIEW:comprehensive-help-center-interactive-product-tours-searchable-guides-FAQs-fully-DB-driven-admin-management
DB:help_tours(id+title+description+target_audience+category+steps[JSONB-array-Joyride-step-objects]+display_order+is_active+duration_minutes+icon+created_at+updated_at+created_by)|help_guides(id+title+description+content[TEXT-markdown-like]+category+target_audience+reading_time_minutes+display_order+is_active+icon+created_at+updated_at+created_by)|help_faqs(id+question+answer+category+target_audience+display_order+is_active+created_at+updated_at+created_by)
STEP-FORMAT:[{target:.css-selector+content:step-content+title:optional+placement:bottom+disableBeacon:true}]|content-formatting[headers:#-H1-##-H2-###-H3+lists:--Item-or-1.-Item+paragraphs-separated-by-double-newlines]
USER-WORKFLOWS:Browse[/helpâ†’tabs:Tours-Guides-FAQs+search-real-time-filtering-titles-desc-questions-answers+filtering-auto-by-user-role-target_audience+category-badges-color-coded]|Take-Tour[click-Start-Tourâ†’navigates-required-route-preserves-?tour=xxx-paramâ†’interactive-overlay-highlights-UIâ†’follow-prompts-Next-Back-navâ†’skip-close-anytime+features:auto-scroll-150px-offset-accounts-header-nav+progress-indicator+keyboard-nav+mobile-responsive+route-specific-auto-nav+query-param-preservation]|Read-Guide[click-Read-Guideâ†’opens-full-screen-dialogâ†’scroll-formatted-contentâ†’close+display:clean-typography-proper-spacing+formatted-headers-lists-paragraphs+reading-time-shown+scrollable]|View-FAQs[accordion-grouped-by-categoryâ†’click-question-expand-answerâ†’only-one-open-at-time+color-coded-category-badges]
ADMIN-WORKFLOWS:Manage-Tours[Adminâ†’Help-Centerâ†’Toursâ†’create-edit-del+set-category-audience-duration+write-Joyride-steps-JSON+toggle-visibility+reorder-display_order]|Manage-Guides[Adminâ†’Help-Centerâ†’Guidesâ†’create-edit-del+write-markdown-content+set-reading-time-estimate+toggle-visibility+organize-by-category]|Manage-FAQs[Adminâ†’Help-Centerâ†’FAQsâ†’create-edit-del+set-category-grouping+reorder-within-categories+toggle-visibility]
CATEGORIES:tours[general-feature-role-specific-getting-started]|guides[general-getting-started-features-advanced]|faqs[general-account-sponsorship-technical-billing]
TARGET-AUDIENCES:all-bestie-caregiver-supporter-vendor-admin
COMPS-PUBLIC:HelpCenter.tsx[search-bar-real-time+tabbed-interface-Tours-Guides-FAQs+card-grid-layouts+empty-states]|ProductTourRunner.tsx[Joyride-wrapper-custom-styling+callback-completion-handling+manual-close-btn-overlay+themed-app-design]|GuideViewer.tsx[full-screen-dialog+markdown-rendering+scrollable-metadata+reading-time]|FAQSection.tsx[accordion-display+category-grouping+badge-color-coding+collapsible-answers]
COMPS-ADMIN:HelpCenterManager.tsx[tab-switcher-Tours-Guides-FAQs+delegates-specialized-managers]|TourManager.tsx[CRUD-tours+JSON-editor-steps+form-validation+visibility-toggles]|GuideManager.tsx[CRUD-guides+large-textarea-content+reading-time-input+preview-capability]|FAQManager.tsx[CRUD-faqs+question-answer-fields+category-assignment+quick-visibility-toggle]
RLS:all-tables[SELECT-active-items-visible-everyone+ALL-admins-create-update-delete]|security:content-filtered-is_active+no-user-auth-required-view+only-admins-manage
DEPENDENCIES:react-joyride[product-tours]+@radix-ui/react-dialog[guide-viewer-modal]+@radix-ui/react-accordion[FAQ-display]
TOUR-SYSTEM:navigation-preserves-?tour=xxx-query-param+auto-element-detection-5s-timeout-fallback+150px-scroll-offset-prevents-header-nav-overlap|beacon-all-tours-disableBeacon:true-applied-auto-ProductTourRunnerâ†’tooltips-appear-immediately-no-glowing-orange-dot-no-user-click-required-applied-all-tours-system-wide|reliability-query-param-preservation-route-changes+element-availability-checking-before-start+graceful-fallback-elements-not-found+proper-cleanup-unmount

## ORDER_TRACKING_CONCISE
OVERVIEW:vendors-manually-enter-tracking-via-AfterShip-integration-customers-view-tracking-details-click-through-AfterShip-live-updates
DB:order_items-tracking-fields[tracking_number+carrier+tracking_url+fulfillment_status-pending-shipped-delivered+shipped_at+delivered_at+vendor_id+platform_fee+vendor_payout+stripe_transfer_id]|orders[id+customer_id+total_amount+status-pending-completed-cancelled+shipping_address-JSONB+billing_address-JSONB+stripe_payment_intent_id+notes]
EDGE-FUNCS:submit-tracking[auth-yes-vendor-must-own-order-item+request:{orderItemId+trackingNumber+carrier}+flow:verify-vendor-ownershipâ†’call-AfterShip-API-create-trackingâ†’update-order_items-tracking-dataâ†’set-fulfillment_status:shipped+shipped_at:now()â†’response:{success+tracking:{trackingNumber+carrier+trackingUrl}}]|aftership-webhook[âš ï¸NOT-FUNCTIONAL-status-blocked-requires-upgraded-AfterShip-account+future-flow-receive-status-updatesâ†’update-fulfillment_statusâ†’set-delivered_at]
FRONTEND:VendorOrderDetails[Vendor-Dashboardâ†’Ordersâ†’View-Details+pending-items-input-tracking-number+carrier-dropdownâ†’Mark-as-Shipped+shipped-items-display-tracking-read-only+carrier-badge+Mark-as-Delivered-fallback]|OrderHistory[route:/orders+display-order-cards-ID-date-status-shipping-address-items-fulfillment-badges+tracking-shows-tracking-number+carrier+Track-Package-btn-opens-tracking_url]
CONFIG:AfterShip-API[secret-AFTERSHIP_API_KEY+base-URL-https://api.aftership.com/v4+endpoint-POST-/trackings+supported-carriers-UPS-USPS-FedEx-DHL-1000-available]|edge-func-config[submit-tracking-verify_jwt-true+aftership-webhook-verify_jwt-false-uses-AfterShip-signature]
STATUS-BADGE-COLORS:order[pending-yellow+completed-green+cancelled-red]|fulfillment[pending-yellow+shipped-blue+delivered-green]
IMPLEMENTED:âœ…manual-tracking-submission-vendorâ†’DBâ†’AfterShip+customer-tracking-view-/orders-page-with-AfterShip-links+vendor-fulfillment-workflow-mark-shipped-delivered+full-DB-structure-with-timestamps
NOT-IMPLEMENTED:âŒAfterShip-webhooks-automatic-status-updates+email-notifications-shipping-delivery-confirmations+in-app-tracking-timeline-multi-tracking-per-item-returns+analytics-delivery-times-success-rates
SECURITY-RLS:order_items[vendors-UPDATE-SELECT-their-items+customers-SELECT-their-orders]|orders[customers-SELECT-their-orders+vendors-SELECT-orders-with-their-products+admins-ALL]|no-DELETE-allowed-audit-trail

## TERMS_PRIVACY_SYSTEM
OVERVIEW:enforces-acceptance-Terms-of-Service-Privacy-Policy-with-version-tracking-automatic-enforcement-audit-trail
DB:terms_acceptance(user_id+terms_version+privacy_version+accepted_at+ip_address+user_agent+UNIQUE-constraint-user_id-terms_version-privacy_version)|RLS:users-view-insert-own+admins-view-all
VERSION-MGMT:current-versions-src/hooks/useTermsCheck.ts[CURRENT_TERMS_VERSION-1.0+CURRENT_PRIVACY_VERSION-1.0]|update-process:increment-version-constantsâ†’update-Last-Updated-date-in-pagesâ†’deployâ†’users-prompted-next-login
COMPS:TermsAcceptanceDialog[non-dismissible-modal-requiring-checkbox+btn-click+links-Terms-Privacy-pages-new-tabs+calls-record-terms-acceptance-edge-func+triggers-onAccepted()-callback-on-success]|TermsAcceptanceGuard[wraps-app-App.tsx-enforces-terms-site-wide+hides-dialog-public-pages:/+/auth+/terms+/privacy+reloads-page-after-acceptance-refresh-data+shows-dialog-when-needsAcceptance=true-from-useTermsCheck]|useTermsCheck-hook[returns:{needsAcceptance+loading+recordAcceptance}+queries-terms_acceptance-for-user+current-versions+updates-on-auth-state-changes]
EDGE-FUNC:record-terms-acceptance[auth-required-JWT-token+request:{termsVersion+privacyVersion}+process-authenticates-userâ†’extracts-IP-user-agentâ†’inserts-into-terms_acceptance+audit-logs-IP-user-agent-timestamp+errors-ignores-duplicates+returns-400-on-auth-DB-failure]
PAGES:Terms-of-Service[/terms-16-sections-service-desc-community-features-sponsorships-refund-policy-user-conduct-marketplace-liability-etc+version-1.0-Last-Updated-Jan-6-2025]|Privacy-Policy[/privacy-16-sections-data-collection-payment-processing-privacy-rights-donor-privacy-CCPA-GDPR-compliance-etc+version-1.0-Last-Updated-Jan-6-2025+emphasizes-donor-privacy-7-year-IRS-retention]
USER-WORKFLOWS:First-Time[signupâ†’redirected-protected-pageâ†’dialog-appears-no-acceptance-recordâ†’check-I-agreeâ†’click-Accept-Continueâ†’edge-func-recordsâ†’page-reloads]|Existing-After-Version-Update[version-incremented-codeâ†’loginâ†’useTermsCheck-finds-no-record-new-versionâ†’dialog-appearsâ†’user-re-acceptsâ†’new-record-created-old-records-preserved]|Guest-Sponsor[guest-sponsors-without-account-no-terms-requiredâ†’later-creates-accountâ†’dialog-appears-first-loginâ†’accepts-termsâ†’full-access-granted]
ADMIN-FEATURES:User-Management-view-acceptance-status-per-user-version-date|Compliance-Reporting-full-audit-trail-user-ID-timestamp-IP-user-agent-versions|Export-query-terms_acceptance-table-filter-by-date-export-to-CSV
SECURITY-COMPLIANCE:legal-requirements[audit-trail-IP-user-agent-timestamp+version-tracking-separate-Terms-Privacy+explicit-consent-checkbox+btn+non-repudiation-unique-DB-constraint+RLS-policies-prevent-tampering]|data-protection[HTTPS+encrypted-at-rest+RLS-enforcement+no-deletion]|GDPR[user-access-to-records+consent-before-processing+clear-mechanism]|CCPA[disclosure-in-Privacy-Policy+no-personal-data-sales]
KEY-DESIGN-DECISIONS:non-dismissible-dialog-legal-requirement-proves-user-awareness|page-reload-ensures-fresh-data-avoids-state-sync-issues|IP-logging-legal-proof-fraud-detection-compliance|unique-constraint-prevents-duplicates-maintains-audit-clarity|edge-function-adds-audit-metadata-IP-user-agent-to-DB-records

## SPONSOR_PAGE_SYSTEM
ROUTE:/sponsor-bestie?bestieId={optional}-one-time-monthly-sponsorships-via-Stripe
PAGE-FEATURES:dynamic-section-ordering-from-sponsor_page_sections-table+URL-param-handling[?bestieId=xxxâ†’pre-select+move-to-top|no-paramâ†’randomize]+blocks-besties-from-sponsoring-role-check+Stripe-checkout-integration
KEY-STATE:besties+selectedBestie+frequency[one-time-monthly]+amount+email[auto-filled-logged]+fundingProgress+sections+pageContent+featuredVideo
SECTIONS:header+featured_video+sponsor_carousel+selection_form+impact_info[renders-only-is_visible:true+ordered-by-display_order]
DISPLAY-COMP:SponsorBestieDisplay[single-card-or-carousel-7s-auto-advance-pauses-manual-nav-TTS+card-elements:image-aspect-ratio-preserved+Available-for-Sponsorship-badge+Youre-Sponsoring-badge-if-active+text-sections-TTS-on-first+voice-note-player+funding-progress-bar-if-monthly_goal>0+Sponsor-This-Bestieâ†’/sponsor-bestie?bestieId={id}+Fully-Funded-message-if-is_fully_funded-or-â‰¥100%+carousel-controls-Prev-Next-arrows-Play-Pause-dot-indicators-inside-card-bottom]
DATA:fetches-sponsor_besties-active+randomizes+checks-user-sponsorships+loads-sponsor_bestie_funding_progress-view
CONTROLS-POSITION:all-carousel-navigation-controls-rendered-inside-each-card-matches-FeaturedItem-pattern
DB:sponsor_besties(id+bestie_id[nullable]+bestie_name+image_url+voice_note_url+text_sections[jsonb:[{header+text}]]+aspect_ratio[def:9:16]+monthly_goal+is_active+is_fully_funded)|sponsor_page_sections(id+section_key[unique]+section_name+is_visible+display_order+content[jsonb])|sponsor_bestie_funding_progress-VIEW[returns-sponsor_bestie_id+bestie_id+bestie_name+current_monthly_pledges-SUM-active-monthly+monthly_goal+funding_percentage+remaining_needed]
ADMIN-CONTROLS:SponsorBestieManager[Adminâ†’Sponsorshipsâ†’Sponsor-Besties-CRUD-create-edit-del+upload-image+voice-note-app-assets+add-text-sections-min-1+set-aspect-ratio-monthly-goal+toggle-active-fully-funded]|SponsorPageOrderManager[Adminâ†’Sponsorshipsâ†’Sponsor-Page-Order-drag-drop-sections-dnd-kit+toggle-visibility-green-eye-visible-red-eye-off-hidden+auto-saves]|SponsorBestiePageManager[Adminâ†’Sponsorshipsâ†’Page-Content-edit-badge-text-heading-description-featured-video-dropdown+saves-to-app_settings.sponsor_page_content-as-JSON]
SPECIAL-RULES:URL-param[with-?bestieId=xxxâ†’move-to-top+pre-select+scroll-to-form|withoutâ†’randomize+select-first]|role-blocking[besties-cannot-sponsor-check-user_roles.role-redirect-to-/community-if-bestie]|funding-display[progress-bar-only-if-monthly_goal>0|fully-funded-hide-button-show-success-when-is_fully_funded-OR-â‰¥100%]|carousel-auto-pause[pauses-on-manual-nav-TTS-playing-pause-btn+resumes-on-play-btn-audio-ends]|form-validation[min-$10-valid-email-Zod+email-auto-filled+disabled-if-logged+defaults-$25-monthly]|TTS-rendering[only-first-section-gets-TTS-btn-combines-header+text]
STRIPE-INTEGRATION:edge-func-create-sponsorship-checkout[request:{bestie_id+amount+frequency+email}+flow-authâ†’check-create-Stripe-customerâ†’create-priceâ†’create-session-payment-subscription-modeâ†’store-pendingâ†’return-URL+URLs-success:/sponsorship-success|cancel:/sponsor-bestie]
WORKFLOW:1-guardian-creates-approved-featured-bestie-postâ†’community-page|2-vendor-enters-3-emoji-codeâ†’creates-vendor_bestie_requests[pending]|3-guardian-approves-link-at-/guardian-approvalsâ†’vendor-can-request-assets|4-vendor-selects-assetâ†’creates-vendor_bestie_assets[pending]|5-guardian-approves-assetâ†’displays-vendor-store[/vendors/{id}]
DISPLAY:VendorBestieAssetDisplay.tsxâ†’layout:2-col-grid[md:grid-cols-2]+max-w-6xl-mx-auto|left:asset-AspectRatio-wrapper|right:bestie-name+description+TTS|badge:Bestie-of-Month[absolute-top-4-left-4]
DATA-FETCH:1-fetch-approved-assets-vendor_bestie_assets-by-vendor_id|2-enrich-profiles_public[display_name]+featured_besties[description+aspect_ratio]|3-cross-ref-asset_url-with-image_url-voice_note_url-for-metadata
RLS:SELECT[vendors-own|guardians-linked-besties|public-approved-on-store]|INSERT[approved-vendors-only]|UPDATE[guardians-approve-reject|admins-full]
ISSUES:images-enormousâ†’add-max-w-6xl-mx-auto|missing-name-descâ†’enrich-featured_besties|wrong-aspectâ†’parse-string-9:16-to-decimal-9/16
FILES:VendorBestieAssetDisplay.tsx|VendorBestieLinkRequest.tsx|VendorLinkedBesties.tsx|VendorProfile.tsx|VendorLinkRequests.tsx|VendorAssetRequests.tsx

## COMMUNITY_PREVIEW_SECTIONS
GRID:grid-cols-1-lg:grid-cols-2-gap-6[2-col-desktop+1-col-mobile+24px-spacing]|cards:Card-border-2-hover:border-primary/50-transition-colors
LATEST-DISCUSSION:icon-MessageSquare[text-primary]+title-Latest-Discussion+View-All-btn[ghost-sm-ArrowRight]|content-card:space-y-3-cursor-pointer-hover:bg-muted/50-p-3-rounded-lg|image-or-video-thumb[if-exists]:w-full-h-48-object-cover-rounded-lg[priority:image_url-OR-video.thumbnail_url]|title:font-semibold-text-lg-flex-gap-2[TTS-btn-right]|desc:text-sm-muted-foreground-line-clamp-2[displays-content]|meta:flex-gap-2-text-xs-muted[format:by-author-â€¢-date]|empty:No-discussions-yet-center-py-4
DATA-LOAD-DISCUSSION:DB-query[discussion_posts+join-profiles_public[author-id-display_name-role]+join-videos[thumbnail_url]â†’filter-is_moderated=trueâ†’NO-approval_status-filterâ†’order-created_at-DESCâ†’limit-3]|TTS-format:title+.+content
UPCOMING-EVENTS:icon-Calendar[text-secondary]+title-Upcoming-Events+View-All-btn|event-cards:space-y-4-individual[space-y-3-hover:bg-muted/50-p-3-rounded-lg-border-b-last:border-0]|image[if-exists]:dynamic-aspect-ratio-from-event.aspect_ratio[def:9:16]â†’calc[split-ratio-9:16â†’apply-CSS-aspectRatio]â†’w-full-h-full-object-cover|title-TTS:flex-gap-2-items-start[title-semibold-base-flex-1+TTS-btn-right-e.stopPropagation]|desc:text-sm-muted-line-clamp-2|meta:flex-gap-2-text-xs-muted[Calendar-icon-w-3-h-3+date-toLocaleDateString+bullet-if-location]|location-link:clickableâ†’opens-Google-Maps[window.open-API=1-query=encodeURIComponent-_blank-noopener-noreferrer]â†’hover:text-primary-underline|audio:AudioPlayer-if-audio_url[e.stopPropagation]|empty:No-upcoming-events-center-py-4
DATA-LOAD-EVENTS:DB-query[events+join-event_datesâ†’filter-is_public=true+is_active=trueâ†’order-event_date-ASC]|role-filter-CLIENT-SIDE[after-fetch:filter-visible_to_roles.includes-effectiveRole]|date-processing[1-collect:primary-event_date+all-event_datesâ†’2-sort-chronologicalâ†’3-filter-upcoming:dateâ‰¥now+shouldShow[expires_after_date?isUpcoming:true]â†’4-create-cards-per-dateâ†’5-sort-limit-3]|height-limit-calc[MAX_HEIGHT:1200px+CARD_PADDING:24px+SPACING:16px+TEXT_HEIGHT:120pxâ†’calc-per-event:imageHeight-from-aspect-ratio+TEXT_HEIGHT+CARD_PADDING+SPACINGâ†’stop-adding-if-exceeds-MAX_HEIGHT]
TTS-INTEGRATION:btn-position-right-of-title-e.stopPropagation|discussion-format:title+.+content|event-format:[title+description+Scheduled-for-date+At-location].filter-Boolean.join-.-|component-props:{text+voice?+size?-icon+onPlayingChange?}|user-prefs:profiles.tts_voice[def:Aria]+tts_enabled[def:true]â†’if-!enabled-return-null|btn-states:loading[gradient-pulse-disabled]+playing[Pause-icon-stops-playback]+stopped[Play-icon-ml-0.5-starts-playback]|edge-func:text-to-speech[request:{text+voice}â†’response:{audioContent-base64-MP3}]|audio-process:requestâ†’receive-base64â†’create-Blobâ†’Audio-elementâ†’playâ†’cleanup[revokeObjectURL-onended-onerror]
NAVIGATION:discussion-card-clickâ†’/discussions[exceptions:TTS-btn-propagation-stopped]|event-card-clickâ†’/events[exceptions:TTS-btn+location-link+audio-player-propagation-stopped]|View-All-btns:Latestâ†’/discussions|Upcomingâ†’/events[ghost-sm-ArrowRight]
COLORS:discussion-icon-text-primary|event-icon-text-secondary|TTS-btn-bg-primary-hover:bg-primary/90|card-titles-default|descriptions-text-muted-foreground|metadata-text-muted-foreground|card-border-border-2-hover:border-primary/50|card-hover-bg-muted/50|TTS-loading-gradient-from-primary-via-accent-to-secondary
RESPONSIVE:desktop-lg+[2-col-side-by-side-equal-width]|mobile-<lg[1-col-stacked-Latest-first-Upcoming-below]|images:discussion[fixed-h-48-192px]+events[dynamic-aspect-ratio]|all-images-full-width-object-cover
FILES:Community.tsx|TextToSpeech.tsx|AudioPlayer.tsx|LocationLink.tsx
CRITICAL-RULES:1-profile-fetch-profiles_public-NOT-profiles[includes-role-from-user_roles]|2-discussion-filter-is_moderated=true-ONLY[NO-approval_status-filter]|3-events-client-side-role-filter-AFTER-DB-fetch|4-height-events-limited-1200px-cumulative[aspect-ratio-aware]|5-propagation-stop-TTS-location-audio-clicks|6-visibility-check-community_sections-table-section-visibility|7-empty-states-show-when-no-content

## INTERNAL_PAGES_REGISTRY
FILE:src/lib/internalPages.ts|PURPOSE:centralized-list-all-internal-routes-used-admin-interfaces[nav-bar+footer-links+quick-links+featured-items]
STRUCTURE:interface-InternalPage{value-string[route-path-/community]+label-string[display-name-Community]}
PAGES:public[/â†’Home+/aboutâ†’About/Resources+/supportâ†’Support-Us+/joy-rocksâ†’Joy-Rocks-Coffee+/partnersâ†’Partners]|community[/communityâ†’Community+/discussionsâ†’Discussions+/eventsâ†’Events+/galleryâ†’Albums+/videosâ†’Videos]|sponsorship[/sponsor-bestieâ†’Sponsor-a-Bestie]|marketplace[/marketplaceâ†’Marketplace+/ordersâ†’Order-History]|user[/authâ†’Login/Signup+/profileâ†’Profile]|guardian-bestie[/guardian-linksâ†’My-Besties+/guardian-approvalsâ†’Guardian-Approvals+/bestie-messagesâ†’Bestie-Messages]|help[/helpâ†’Help-Center]|admin[/adminâ†’Admin-Panel]
ADDING-NEW-PAGES:CRITICAL-when-add-route-App.tsx-MUST-also-add-internalPages.ts[1-add-route-App.tsx:Route-path=/new-pageâ†’2-add-internalPages.ts:{value:/new-page+label:New-Page}â†’3-entry-immediately-available-all-admin-dropdowns]
WHY-MATTERS:without-entry[admins-cant-link-nav-bar+wont-appear-footer-options+cant-create-quick-links+featured-items-cant-link]|with-entry[auto-appears-all-admin-interfaces+consistent-labeling+easy-maintain-update]
ISSUES:new-page-not-in-dropdownsâ†’missing-from-registry-add-internalPages.ts|wrong-labelâ†’incorrect-label-value-update-registry|dead-linkâ†’route-deleted-registry-remains-remove-registry
MAINTENANCE-RULES:1-keep-in-sync-with-routes[registry-match-App.tsx]|2-use-descriptive-labels[users-see-admin-interfaces]|3-alphabetize-by-category[maintain-logical-grouping]|4-no-external-URLs[only-internal-routes-start-/]
FILES-USING:internalPages.ts[registry]+App.tsx[routes]+NavigationBarManager.tsx+FooterLinksManager.tsx+QuickLinksManager.tsx+FeaturedItemManager.tsx

## NOTIFICATION_SYSTEM_COMPLETE
OVERVIEW:dual-channel-delivery[in-app+email]+user-preferences+realtime-updates+grouped-notifications-UI+rate-limiting+automatic-expiry+comprehensive-triggers
DB:notifications[id+user_id+type+title+message+link+is_read+metadata+created_at+expires_at-30-days-def]|rate_limits[id+user_id+endpoint+window_start+request_count+created_at]|notification_preferences[all-email+inapp-flags-boolean-def:true+digest_frequency-never-daily-weekly+last_digest_sent_at]|digest_emails_log[id+user_id+recipient_email+frequency+notification_count+sent_at+status+error_message+metadata]|email_notifications_log[id+user_id+recipient_email+notification_type+subject+status+error_message+metadata+sent_at]
FUNCS:get_notification_preferences(_user_id)â†’returns-all-flags-defaults-true-if-none|get_users_needing_digest(_frequency)â†’returns-users-unread-due-digest[daily:23+hrs+weekly:6-days-23+hrs]â†’user_id+user_email+unread_count|check_notification_rate_limit(_user_id-_endpoint-_max_requests-_window_minutes)â†’prevents-spam[def:1-per-endpoint-per-hour]â†’returns-true-allowed-false-exceeded|cleanup_rate_limits()â†’deletes->1-hour-old|cleanup_expired_notifications()â†’deletes-past-expires_at
TRIGGERS:notify_on_new_comment[AFTER-INSERT-discussion_commentsâ†’recipients:post-author-if-not-commenter+other-commentersâ†’types:comment_on_post-comment_on_threadâ†’rate-limited-1/hrâ†’creates-in-app+link-discussion]|notify_on_pending_post_approval[AFTER-INSERT-discussion_posts-approval_status=pending_approvalâ†’recipients:guardians-linked-authorâ†’type:pending_approvalâ†’checks-require_post_approvalâ†’rate-limitedâ†’creates-in-app+optional-email]|notify_on_post_approval_decision[AFTER-UPDATE-discussion_posts-approval_status-changesâ†’recipient:post-authorâ†’types:approval_decision-approved-rejectedâ†’rate-limitedâ†’creates-in-app+link-post]|notify_on_new_sponsor_message[AFTER-INSERT-sponsor_messages-status=approvedâ†’recipients:sponsors-of-bestieâ†’type:new_sponsor_messageâ†’rate-limitedâ†’creates-in-app+link-inbox]|notify_on_message_status_change[AFTER-UPDATE-sponsor_messages-status-changesâ†’recipient:message-author-bestieâ†’types:message_approved-message_rejectedâ†’rate-limitedâ†’creates-in-app+rejection-reason]|notify_on_new_sponsorship[AFTER-INSERT-sponsorships-status=activeâ†’recipient:sponsored-bestieâ†’type:new_sponsorshipâ†’rate-limitedâ†’creates-in-app+link-guardian-links]
EDGE-FUNCS:send-notification-email[public-authâ†’request:{userId+notificationType+subject+title+message+link?+metadata?}â†’flow:fetch-profile-emailâ†’check-prefs-get_notification_preferencesâ†’skip-if-disabledâ†’build-HTML-email[logo+title+message+action-btn]â†’send-Resend-APIâ†’log-email_notifications_log-success-failureâ†’response:{success+emailId}-OR-{success+skipped+reason}]|send-digest-email[public-cronâ†’request:{frequency:daily-weekly}â†’flow:call-get_users_needing_digestâ†’for-each-user[fetch-unread-up-to-50â†’group-by-typeâ†’build-HTML-digestâ†’send-Resendâ†’update-last_digest_sent_atâ†’log-digest_emails_log]â†’response:{success+processed+successful+failed}]|broadcast-product-update[admin-owner-onlyâ†’request:{title+message+link?+targetRoles?}â†’flow:verify-authâ†’fetch-users-filtered-rolesâ†’create-product_update-notificationsâ†’invoke-send-notification-email-each-asyncâ†’response:{notificationsSent+emailsSent+emailsFailed}]
FRONTEND:NotificationBell[UnifiedHeader-before-profileâ†’badge:red-count-9+shows-9+â†’popover:NotificationList-on-click]|NotificationList[NotificationBell-popoverâ†’layout:scrollable-400px-heightâ†’grouping:similar-notifications-collapsed-count-badgeâ†’display:single[icon+title+message+timestamp]+grouped-2+[title-count-expandable-all]â†’unread:primary-bg+blue-dotâ†’actions:clickâ†’navigate-link+mark-read|click-groupâ†’expand|hover-individualâ†’delete-X|header:Mark-all-read-btnâ†’empty:Bell-icon+No-notifications-yetâ†’features:collapsible-groups+individual-delete-within-groupsâ†’grouping-logic:by-type+target-same-post_id-event_id]
HOOKS:useNotifications[state:notifications[]+groupedNotifications[]+unreadCount+loadingâ†’grouping-logic:comment_on_post+same-post_idâ†’3-people-commented+pending_approval+same-itemâ†’5-items-need-approval+single-remain-ungroupedâ†’methods:markAsRead-id+markAllAsRead+deleteNotification-id-toast+deleteAllRead-toast+handleNotificationClick-notification-mark-read+navigate+refreshNotifications-manual-reloadâ†’realtime:subscribes-notifications-table-INSERT-UPDATE-DELETEâ†’auth:auto-refresh-sign-in-out+clears-state-sign-outâ†’cleanup:unsubscribes-channels-unmount]
GROUPED-NOTIFICATIONS:rules[comment_on_post+same-post_idâ†’group|comment_on_thread+same-post_idâ†’group|pending_approval+same-itemâ†’group|new_sponsor_message+same-bestie_idâ†’group|moderation_needed+same-item_idâ†’group|others-ungrouped]|UI:single[shows-normally-title+message+timestamp]+group-2+[count-badge+condensed-title-3-people-commented]+expand[click-chevron-see-all-notifications]+actions[delete-individual-within-groups]+read-status[group-marked-read-all-notifications-read]+realtime[groups-update-auto-new-notifications-arrive]|benefits[reduces-clutter-3â†’1-group+easier-scan-distinct-events+better-mobile-less-scrolling+modern-UX-pattern-users-expect]
RATE-LIMITING:how[1-check-before-create-check_notification_rate_limit-user_id-endpoint-max_requests-window_minutesâ†’2-track-creates-updates-rate_limits-window-start-rounded-intervalâ†’3-enforce-returns-false-if-exceeded-prevents-creationâ†’4-cleanup-old-records->1-hour-cleanup_rate_limits]|def-limits[frequency:1-per-endpoint-per-user-per-hour+window:60-min-sliding-rounded-timestamps+endpoints:trigger-name-post_approval-new_message]|implementation-pattern:IF-NOT-check_notification_rate_limit(_recipient_id-endpoint_name-1-60)-THEN-RETURN-NEW-skip-notification|PROCEED-INSERT-notifications
EXPIRY:config[def-TTL:30-days-expires_at=now+interval-30-days+cleanup:run-cleanup_expired_notifications-daily-cron-maintenance]|strategy[old-notifications-soft-deleted-remain-until-cleanup+users-can-delete-manually-before-expiry+expired-excluded-queries-auto]
DIGEST-EMAIL:overview[users-opt-periodic-digest-daily-weekly-instead-individual-emails+summarizes-all-unread-grouped-by-type]|config[user-setting:digest_frequency-never-daily-weekly+tracking:last_digest_sent_at-timestamp+schedule:cron-job-see-scheduling]|content[grouping:by-type-Pending-Approvals-Comments-Messages+limit:50-most-recent-unread-per-user+format:HTML-branded-header-grouped-sections-View-All-btn+subject:Your-Daily-Weekly-Notification-Digest-X-unread]|scheduling-cron[daily:0-8-*-*-*-8AM-daily+weekly:0-8-*-*-1-8AM-every-Mondayâ†’SELECT-cron.schedule-send-daily-digest-0-8-*-*-*-net.http_post-URL-functions-v1-send-digest-email-headers-Authorization-Bearer-ANON_KEY-body-frequency-daily]|digest-vs-individual[when-digest-enabled:NO-individual-emails+in-app-still-appear-immediately+digest-includes-ALL-unread-since-last+individual-prefs-ignored-when-digest-enabled]|user-experience[settings:select-frequency-Never-Daily-Weeklyâ†’first-digest:sent-next-scheduled-if-has-unreadâ†’subsequent:only-if-new-unread-since-lastâ†’opt-out:switch-back-individual-or-disable-all]|monitoring[logs:digest_emails_log-delivery-status+user-activity:query-last_digest_sent_at-see-when-users-last-received+audit:all-digest-sends-logged-notification-count-status]
NOTIFICATION-TYPES:pending_approval[trigger:post-comment-needs-approvalâ†’recipients:guardian-sâ†’link:/guardian-approvalsâ†’email:email_on_pending_approval+inapp:inapp_on_pending_approvalâ†’rate:1-hr]|approval_decision[trigger:post-comment-approved-rejectedâ†’recipient:post-authorâ†’link:/discussions?postId=xxxâ†’email:email_on_approval_decision+inapp:inapp_on_approval_decisionâ†’rate:1-hr]|new_sponsor_message[trigger:bestie-sends-messageâ†’recipients:sponsor-sâ†’link:/guardian-linksâ†’email:email_on_new_sponsor_message+inapp:inapp_on_new_sponsor_messageâ†’rate:1-hr]|message_approved-message_rejected[trigger:message-approved-rejected-by-guardianâ†’recipient:bestieâ†’link:/bestie-messagesâ†’email:email_on_message_approved-rejected+inapp:inapp_on_message_approved-rejectedâ†’rate:1-hr]|new_sponsorship[trigger:new-sponsorship-createdâ†’recipient:bestieâ†’link:/guardian-linksâ†’email:email_on_new_sponsorship+inapp:inapp_on_new_sponsorshipâ†’rate:1-hr]|sponsorship_update[trigger:sponsorship-modified-cancelledâ†’recipients:sponsor+bestieâ†’link:/guardian-linksâ†’email:email_on_sponsorship_update+inapp:inapp_on_sponsorship_updateâ†’rate:1-hr]|new_event[trigger:event-createdâ†’recipients:all-usersâ†’link:/events?eventId=xxxâ†’email:email_on_new_event+inapp:inapp_on_new_eventâ†’rate:1-hr]|event_update[trigger:event-modifiedâ†’recipients:attendeesâ†’link:/events?eventId=xxxâ†’email:email_on_event_update+inapp:inapp_on_event_updateâ†’rate:1-hr]|comment_on_post[trigger:new-comment-on-discussionâ†’recipient:post-authorâ†’link:/discussions?postId=xxxâ†’email:email_on_comment_on_post+inapp:inapp_on_comment_on_postâ†’rate:1-hr]|comment_on_thread[trigger:new-comment-on-followed-discussionâ†’recipient:other-commentersâ†’link:/discussions?postId=xxxâ†’email:email_on_comment_on_thread+inapp:inapp_on_comment_on_threadâ†’rate:1-hr]|product_update[trigger:admin-broadcasts-platform-updateâ†’recipients:all-or-specific-rolesâ†’link:customâ†’email:email_on_product_update+inapp:inapp_on_product_updateâ†’rate:1-hr]
FILES:NotificationBell.tsx|NotificationList.tsx|useNotifications.ts|send-notification-email/index.ts|send-digest-email/index.ts|broadcast-product-update/index.ts|Notifications.tsx-full-page-center

## VENDOR_SYSTEM_CONCISE
ARCHITECTURE-CHANGE-2025-10-08:vendor-now-STATUS-not-role[users-maintain-primary-role-supporter-bestie-caregiver+have-vendor-capabilities-added-via-vendors-table]
KEY-BENEFIT:guardians-manage-bestie-vendor-account-without-separate-login+besties-be-artisans-with-guardian-admin-support+one-account-multiple-capabilities
DB:vendors[id+user_id+business_name+description+status-pending-approved-rejected-suspended+user-primary-role-stays-user_roles-table-supporter-bestie-caregiver]|products[id+vendor_id+standard-fields+RLS:vendors-CRUD-own-products-if-approved]
VENDOR-FLOWS:become-vendor[/vendor-auth-or-Marketplaceâ†’1-user-signs-up-OR-existing-appliesâ†’2-creates-vendors-record-pendingâ†’3-admin-approvesâ†’status:approvedâ†’4-user-accesses-/vendor-dashboard]|check-status:const-{data:vendor}=await-supabase.from-vendors.select-*.eq-user_id-userId.maybeSingle|dashboard[/vendor-dashboardâ†’checks-vendors.status-pending-approved-rejectedâ†’tabs:Products+Orders+Earnings+Payments+Settings]
ROLE+VENDOR-EXAMPLES:caregiver+vendor[manages-bestie-art-products]|bestie+vendor[sells-own-creations]|supporter+vendor[community-member-selling-items]
MIGRATION-NOTES:all-existing-vendor-role-usersâ†’supporter-role+vendor-status-preserved-vendors-table+no-functionality-lost-flexibility-gained
FILES:VendorAuth.tsx|VendorDashboard.tsx|VendorManagement.tsx-admin|vendors-table

## FEATURED_ITEM_SYSTEM
OVERVIEW:rotating-carousel-homepage-community-page-featured-content-role-based-visibility
COMPS:FeaturedItem[auto-rotating-10s+pause-play-controls+manual-nav-prev-next-dot-indicators+dynamic-aspect-ratio-metadata+TTS-title+desc+event-detail-integration-date-time-location]|FeaturedItemManager[admin-CRUD-interface+image-upload-crop-aspect-ratio-selection+link-resolution-internal-external-event-album-post+display-order-management+role-based-visibility-controls]
DB:featured_items[id+title+description+image_url+original_image_url-for-re-crop+link_url+link_text+aspect_ratio-def:16:9+is_active+is_public+visible_to_roles[]+display_order+created_by+created_at+updated_at]
DATA-LOAD-OPTIMIZED:parallel-loading[const-[authResult-itemsResult]=await-Promise.all-supabase.auth.getUser+supabase.from-featured_items.select]â†’flow:1-fetch-auth+items-parallel-2-queries-not-3-4â†’2-if-authenticated-fetch-user-role-1-additionalâ†’3-filter-items-client-side-by-role-public-statusâ†’4-resolve-URL-for-current-item-may-trigger-event-details-fetch|performance-reduces-sequential-DB-calls-loads-faster-than-previous
LINK-TYPES:internal[/routeâ†’React-Router-Link+event:uuidâ†’/events-loads-event-details+album:uuidâ†’/gallery+post:uuidâ†’/discussions]|external[https:...â†’opens-new-tab]
VISIBILITY-RULES:non-authenticated[only-is_public:true-items]|authenticated[items-where-visible_to_roles-includes-user-role-OR-is_public:true]|admin-owner[all-items-visible]
CAROUSEL-CONTROLS:auto-advance-every-10-seconds|pause-triggers:manual-navigation+user-clicks-pause|resume:user-clicks-play-button|indicators:dot-navigation-current-slide-highlighted
EVENT-DETAILS-DISPLAY:when-link_url-starts-event:â†’fetches-event-date-time-location-from-events-tableâ†’loads-saved-locations-from-saved_locations-tableâ†’displays-with-icons-Calendar-Clock-MapPinâ†’format:EEEE-MMMM-d-yyyy-and-h:mm-aâ†’location-display[if-event.location-matches-saved-location-case-insensitive:shows-location-name-bold+address-below|otherwise:shows-address-string-only+location-clickable-opens-Google-Maps]â†’link-text-becomes-event-CTA|integration:uses-saved_locations-table-provide-context-event-addresses-see-SAVED_LOCATIONS_SYSTEM.md
ADMIN-FEATURES:create-edit[upload-imageâ†’crop-aspect-ratio-selectorâ†’set-title-description-link-type-detectionâ†’configure-visibility-public+rolesâ†’set-display-order-drag-drop]|re-crop:loads-original_image_url-unlimited-re-cropping-no-quality-loss|link-resolution:admin-selects-dropdowns-events-albums-posts-or-enters-custom-URL
RLS:SELECT[public-sees-active-items-matching-visibility-rules]|INSERT-UPDATE-DELETE[admins-only]
ISSUES:slow-loadingâ†’optimized-parallel-auth+items-fetch|wrong-aspect-ratioâ†’parse-string-16:9-to-decimal-16/9|items-not-showingâ†’check-is_active-is_public-role-visibility|carousel-doesnt-auto-advanceâ†’check-items.length>1|event-details-not-showingâ†’verify-link_url-format:event:uuid
FILES:FeaturedItem.tsx[display]+FeaturedItemManager.tsx[admin-CRUD]+ImageCropDialog.tsx[crop-interface]+LocationLink.tsx[clickable-Google-Maps-links]|RELATED:SAVED_LOCATIONS_SYSTEM.md[location-name-address-mgmt]+EVENTS_SYSTEM_CONCISE.md[event-data-structure]

## SEO_PERFORMANCE_SYSTEM
SEO:SEOHead-component[src/components/SEOHead.tsxâ†’props:{title?+description?+image?+type?+noindex?+canonicalUrl?+structuredData?}â†’features:updates-title-tag+manages-Open-Graph-tags-og:title-og:description-og:image+Twitter-Card-meta-tags+canonical-URLs+robots-meta-tag+JSON-LD-structured-data-injection]|structured-data[getOrganizationStructuredData-homepage-name-logo-contact-social-profiles-Schema.org-compliant+getArticleStructuredData-title-description-image-datePublished-author-blog-posts-discussion-posts-headline-author-publisher-info+getEventStructuredData-name-description-startDate-location-image?-events-pages-location-date-description]
SITEMAP:edge-func-generate-sitemap[supabase/functions/generate-sitemap/index.tsâ†’generates-dynamic-XML-sitemap-includes:static-pages-homepage-about-marketplace-etc+discussion-posts-is_moderated=true+events-is_active=true+albums-is_active+is_public=true+vendor-stores-status=approvedâ†’features:automatic-lastmod-dates-from-updated_at-columns+change-frequency-hints-for-search-engines+priority-weighting+1000-item-limit-per-content-typeâ†’accessing:call-edge-function-https://your-domain.com/functions/v1/generate-sitemap+static-fallback-/public/sitemap.xmlâ†’submit-to-search-engines:Google-Search-Console+Bing-Webmaster-Tools-submit-sitemap-URL]
IMAGE-OPT:OptimizedImage-component[src/components/OptimizedImage.tsxâ†’features:lazy-loading-except-priority-images+Intersection-Observer-loads-50px-before-viewport+blur-placeholder-during-load+fade-in-animation-on-load+proper-loading-and-decoding-attributesâ†’props:{src+alt+className?+width?+height?+priority?-skip-lazy-loading-above-fold+objectFit?-cover-contain-fill-none-scale-down+onLoad?}â†’when-use-priority:hero-images-above-fold+logo+critical-UI-elements-visible-page-loadâ†’automatic:lazy-loading-non-priority-images+placeholder-animation+smooth-fade-in-transition]
PERFORMANCE:HTML-head-optimizations-index.html[preconnect:link-rel=preconnect-href=https://fonts.googleapis.com+link-rel=preconnect-href=https://fonts.gstatic.com-crossorigin-reduces-DNS-lookup-time-external-resources+preload:link-rel=preload-as=image-href=/favicon.png-prioritizes-critical-resources+theme-color:meta-name=theme-color-content=#FF6B35-sets-browser-theme-color-mobile]|image-compression[all-images-compressed-via-imageUtils.ts-max-5MB-1920px+automatic-quality-reduction-oversized-images+maintains-aspect-ratio]|code-splitting[React-lazy-loading-routes-already-implemented-App.tsx+dynamic-imports-heavy-components]
SEO-BEST-PRACTICES:meta-tag-guidelines-DO[keep-titles-under-60-chars+descriptions-under-160-chars+include-primary-keywords-naturally+use-unique-titles-descriptions-per-page+include-relevant-keywords-alt-text]+DONT[keyword-stuff+duplicate-meta-tags-across-pages+use-generic-descriptions+forget-alt-attributes-images]|structured-data-guidelines-DO[use-schema.org-types+include-all-required-properties+test-Google-Rich-Results-Test+keep-data-accurate-up-to-date]+DONT[add-irrelevant-schema+include-false-information+nest-improperly]|image-SEO-DO[use-descriptive-filenames+always-include-alt-text+specify-width-height-when-possible+use-lazy-loading-below-fold-images]+DONT[use-generic-filenames-image1.jpg+leave-alt-text-empty+load-all-images-eagerly]
PAGE-SPECIFIC-SEO:homepage[SEOHead-title:Joy-House-Community-Spreading-Joy-Through-Special-Needs-Community+description:Building-supportive-community+structuredData:getOrganizationStructuredData]|other-pages[import-SEOHead+getArticleStructuredData-customize:SEOHead-title:Page-Title-Joy-House-Community+description:Page-specific-description+type:article+structuredData:getArticleStructuredData]
MONITORING-TESTING:tools[Google-Search-Console:index-coverage-search-performance+Google-PageSpeed-Insights:performance-scores+Lighthouse:audit-tool-built-into-Chrome-DevTools+Schema.org-Validator:test-structured-data+Google-Rich-Results-Test:test-schema-markup]|key-metrics[LCP-Largest-Contentful-Paint:<2.5s+FID-First-Input-Delay:<100ms+CLS-Cumulative-Layout-Shift:<0.1+Time-to-Interactive:<3.5s]
ISSUES:images-load-slowlyâ†’check-priority=true-above-fold|duplicate-meta-tagsâ†’use-SEOHead-consistently|sitemap-not-updatingâ†’regenerate-edge-function|poor-mobile-performanceâ†’enable-lazy-loading-compress-images|missing-structured-dataâ†’add-JSON-LD-via-SEOHead
FILES:SEOHead.tsx|OptimizedImage.tsx|generate-sitemap/index.ts|index.html

## SAVED_LOCATIONS_SYSTEM
OVERVIEW:centralized-location-management-admins-create-reusable-location-presets-selected-across-app-events-vendor-profiles
DB:saved_locations[id+name+address+is_active-boolean-def:true+created_by+created_at+updated_at]|RLS:SELECT[all-authenticated-users-view-active-locations]+INSERT-UPDATE-DELETE[admins-only]
COMPS:SavedLocationsManager[location:Adminâ†’Format-Pagesâ†’Locations+file:src/components/admin/SavedLocationsManager.tsxâ†’features:create-edit-delete-saved-locations+toggle-active-inactive-status-visibility-toggle-standard+display-name+full-address-card-format+requires-name-and-address-both-trimmed-before-saveâ†’visual-standard:active[green-bg-Eye-icon]+inactive[red-bg-EyeOff-icon]+card-layout[MapPin-icon+name-bold+address-muted]]|LocationAutocomplete[file:src/components/LocationAutocomplete.tsxâ†’features:saved-location-dropdown-shows-all-active-saved-locations[displays:location-name-bold+address-small-muted+icon:MapPin-proper-alignment+selection-updates-both-dropdown-display-AND-input-field]+Google-Places-Autocomplete-manual-search-with-autocomplete+manual-input-can-type-directly-if-Google-API-unavailableâ†’display-format:[MapPin-Icon]-Location-Name-Full-Address-smaller-muted-textâ†’state-mgmt:selectedLocationId-tracks-which-saved-location-selected+auto-matches-on-edit-if-editing-event-with-location-matching-saved-location-dropdown-shows-selection+clear-on-manual-input-typing-input-field-clears-saved-location-selection+maintains-selection-dropdown-shows-selected-location-name+addressâ†’props:{value-string[current-location-value]+onChange-value-string-void[called-when-location-changes]+label?-string[field-label-def:Location]+placeholder?-string+required?-boolean}]
USER-WORKFLOWS:admin-create-saved-location[Adminâ†’Format-Pagesâ†’Locationsâ†’Add-Locationâ†’enter-name-Best-Day-Ever-Coffee-and-CrÃªpesâ†’enter-full-address-516-Coffman-St-Longmont-CO-80504â†’Createâ†’location-available-immediately-all-location-fields]|admin-deactivate-location[find-location-listâ†’click-Eye-icon-greenâ†’changes-EyeOff-redâ†’location-hidden-dropdown-not-deletedâ†’existing-events-keep-address-value]|user-select-saved-location-event-creation[create-edit-eventâ†’Location-fieldâ†’see-dropdown:Select-saved-locationâ†’click-dropdownâ†’see-all-active-locations-with-name+addressâ†’select-locationâ†’dropdown-shows-selection-input-field-updates-addressâ†’can-override-type-input-fieldâ†’clears-dropdown-selection]|user-use-Google-Places-autocomplete[skip-dropdown-type-directly-input-fieldâ†’Google-Places-suggestions-appear-as-typeâ†’select-from-suggestionsâ†’address-auto-fillsâ†’saved-location-dropdown-clears-manual-input-mode]
INTEGRATION-POINTS:current-usage[Event-Management-EventManagement.tsx+future:vendor-profiles-organization-profiles]|data-flow[1-SavedLocationsManager-creates-locationsâ†’saved_locations-tableâ†’2-LocationAutocomplete-fetches-active-locationsâ†’displays-dropdownâ†’3-user-selectsâ†’onChange-called-address-valueâ†’4-parent-component-EventManagement-stores-location-stateâ†’5-on-saveâ†’address-stored-events.location-field]|event-management-display[when-viewing-events-admin-management-/event-management:1-system-loads-both-events-and-saved-locations-parallelâ†’2-for-each-event-card-checks-if-event.location-matches-any-saved_locations.address-case-insensitiveâ†’3-if-match:display-saved-location-name-bold+display-address-below-as-clickable-Google-Maps-link-muted-textâ†’4-if-no-match:display-address-with-standard-LocationLink-component-icon+clickable-link]
GOOGLE-PLACES-API:API-key-storage[stored-Supabase-secrets-as-GOOGLE_PLACES_API_KEY]|edge-function[get-google-places-key:fetches-key-securelyâ†’returns-frontend-Google-Maps-SDK-initialization]|fallback[if-Google-API-unavailable-or-key-missing:saved-locations-still-work+manual-input-still-works+only-autocomplete-suggestions-unavailable]|loading-states[Fetching-API-key-while-fetching-key-from-edge-function+Loading-location-search-while-loading-Google-Maps-SDK+Location-autocomplete-unavailable-if-error-loading]
VISUAL-DESIGN:saved-location-dropdown-display[[MapPin]-Select-saved-location-â–¼â†’when-opened:[MapPin]-Best-Day-Ever-Coffee-516-Coffman-St-Longmont-full-address-muted-text|[MapPin]-Community-Center-123-Main-St-Boulder-COâ†’when-selected:[MapPin]-Best-Day-Ever-Coffee-516-Coffman-St-Longmont-shows-in-trigger-too-â–¼]|input-field-below-dropdown[[MapPin]-516-Coffman-St-Longmont-CO-actual-value-saved]|SavedLocationsManager-card[[MapPin]-Best-Day-Ever-Coffee-516-Coffman-St-Longmont-CO-[Eye]-[Edit]-[Del]-active-green]
ISSUES:saved-location-not-appearing-dropdownâ†’is_active=false-toggle-active-admin|selection-doesnt-saveâ†’not-clicking-submit-after-selecting-verify-form-submission-logic|address-doesnt-show-inputâ†’onChange-not-called-check-SelectValue-implementation|Google-autocomplete-not-workingâ†’API-key-missing-invalid-check-GOOGLE_PLACES_API_KEY-secret|dropdown-shows-old-selectionâ†’state-not-resetting-form-reset-clear-selectedLocationId-reset|manual-input-doesnt-clear-dropdownâ†’missing-state-update-add-setSelectedLocationId-on-input-change
SECURITY:RLS[only-admins-create-modify-saved-locations+all-authenticated-users-view-active-locations+locations-linked-creator-created_by-field]|input-validation[name-and-address-trimmed-before-save+both-fields-required+no-special-character-restrictions-addresses-may-contain-punctuation]
PERFORMANCE:optimization[saved-locations-fetched-once-component-mount+cached-component-state+only-active-locations-fetched-autocomplete+Google-Maps-SDK-loaded-asynchronously]
FILES:SavedLocationsManager.tsx|LocationAutocomplete.tsx|EventManagement.tsx

## SOCIAL_SHARING_SYSTEM
OVERVIEW:social-media-sharing-public-community-events-platform-specific-integrations-native-mobile-share-support
COMPS:ShareButtons[purpose:reusable-social-sharing-platform-specific-integrationsâ†’props:{title-string+description?-string+url?-string-defaults-current-page+hashtags?-string[]-array-without-#+#+via?-string-Twitter-via-username-def:JoyHouseCommunity+image?-string-URL-for-sharing+compact?-boolean-use-dropdown-menu-def:false}â†’features:mobile-first-Native-Web-Share-API-on-mobile-devices+desktop-platform-specific-buttons-Twitter-Facebook-LinkedIn-Copy+compact-mode-dropdown-menu-tight-spaces+copy-to-clipboard-always-available-fallback+WhatsApp-Email-additional-sharing-options-compact-mode]|ShareIconButton[compact-version-icon-button-with-dropdown]
PLATFORM-INTEGRATIONS:Twitter-X[intent-URL-title-URL-hashtags-via-parameter+opens-new-window+URL:https://twitter.com/intent/tweet?text={title}&url={url}&via={via}&hashtags={hashtags}]|Facebook[sharer-dialog+opens-new-window+URL:https://www.facebook.com/sharer/sharer.php?u={url}]|LinkedIn[share-offsite-dialog+opens-new-window+URL:https://www.linkedin.com/sharing/share-offsite/?url={url}]|WhatsApp[web-API-desktop-mobile+opens-new-tab+URL:https://wa.me/?text={title}-{url}]|Email[standard-mailto:-link+subject:title+body:description+URL+URL:mailto:?subject={title}&body={description}%0A%0A{url}]|Copy-Link[uses-Clipboard-API+toast-notification-on-success+2-second-Copied-feedback+fallback-from-native-share-if-unavailable]
IMPLEMENTATION:discussion-posts[location:post-header-after-author-info-badges+type:ShareIconButton-compact+usage:title={post.title}+description={post.content.substring-0-150}+url={window.location.origin}/discussions?postId={post.id}+hashtags=[JoyHouse-Community]]|events[location:event-card-after-description+type:ShareIconButton-compact+condition:only-shown-when-event.is_public===true+usage:title={event.title}+description={event.description}+url={window.location.origin}/events?eventId={event.id}+hashtags=[JoyHouse-CommunityEvent]]|event-detail-dialog[location:bottom-dialog-border-top-section+type:ShareButtons-expanded+condition:only-shown-when-event.is_public===true]
UI-PATTERNS:desktop-expanded[Share:-[Twitter]-[Facebook]-[LinkedIn]-[Copy]]|mobile-expanded[Share:-[Share-Button]-triggers-native-share]|compact-all-devices[[Share-â–¼]â†’Dropdown-Menu:Share-native+Twitter+Facebook+LinkedIn+WhatsApp+Email+Copy-Link]
NATIVE-WEB-SHARE-API:detection[if-navigator.share-native-share-available-mobile-else-fallback-platform-buttons-or-copy-link]|usage[await-navigator.share-{title:title+text:description+url:shareUrl}]|browser-support[âœ…Mobile-Safari-iOS+Chrome-Mobile-Android+Samsung-Internet|âŒDesktop-browsers-most-dont-support]
SEO-INTEGRATION:Open-Graph-tags[social-sharing-works-with-SEO-meta-tags-from-SEOHead-component:og:titleâ†’share-title+og:descriptionâ†’share-description+og:imageâ†’share-image-preview+og:urlâ†’canonical-URL]|Twitter-Cards[twitter:cardâ†’summary-card-large-image+twitter:titleâ†’tweet-title+twitter:descriptionâ†’tweet-description+twitter:imageâ†’preview-image]|rich-previews[when-users-share-platforms-fetch-these-meta-tags-for-rich-previews-with-images-descriptions]
BEST-PRACTICES:URL-construction[always-use-absolute-URLs:const-shareUrl=url||window.location.href+for-specific-content:const-shareUrl=${window.location.origin}/events?eventId=${event.id}]|description-length[keep-descriptions-under-150-characters-better-display:description={event.description}]|hashtag-guidelines[use-relevant-searchable-hashtags+2-3-hashtags-maximum+no-#-symbol-array-added-automatically+example:[JoyHouse-CommunityEvent]]|copy-feedback[always-show-toast-notification-copy-success+use-visual-feedback-Check-icon-2-seconds+provide-error-handling-copy-failures]
VISIBILITY-RULES:public-events-only[share-buttons-only-appear-when-event.is_public===true+controlled-by-database-events.is_public-column+admin-can-toggle-Event-Management+private-events-visible-specific-roles-cannot-be-shared]|role-based-access[event-visibility-controlled-by-visible_to_roles-array+sharing-respects-event-privacy-settings+users-can-only-share-what-they-can-see]
FILES:ShareButtons.tsx|EventsPage.tsx|EventDetailDialog.tsx|Discussions.tsx

## VENDOR_AUTH_SYSTEM
OVERVIEW:vendor-application-ANY-authenticated-user-can-apply-become-vendor-creating-record-vendors-table
APPLICATION-FLOW:route:/vendor-auth|new-users-sign-up[1-enter:Display-Name-Business-Name-Email-Passwordâ†’2-system-creates-auth-account-supporter-roleâ†’3-inserts-vendors-record-pending-statusâ†’4-redirects-/vendor-dashboard-shows-pending-message]|existing-users-sign-in[1-enter:Email-Passwordâ†’2-system-verifies-vendor-record-existsâ†’3-if-no-vendor-recordâ†’suggests-applying-as-vendorâ†’4-redirects-/vendor-dashboard]
ALTERNATIVE-ENTRY:Marketplace-Become-Vendor-buttonâ†’can-redirect:/vendor-auth-if-not-logged+/vendor-dashboard-if-loggedâ†’Apply-button-if-no-vendor-record
VENDOR-CHECK-PATTERN:const-{data:vendor}=await-supabase.from-vendors.select-status.eq-user_id-userId.maybeSingle|if-vendor?.status===approved-user-can-access-vendor-features
KEY-DIFFERENCE:OLD[vendor-separate-role+users-needed-vendor-specific-login]|NEW[vendor-status+any-user-apply-keeping-primary-role]|BENEFIT[guardians-manage-bestie-vendor-accounts+one-login-all-features]
FILES:VendorAuth.tsx|VendorDashboard.tsx|Auth.tsx

## NOTIFICATION_CENTER_PAGE
OVERVIEW:full-page-notification-center-at-/notifications-advanced-filtering-search-bulk-actions-better-organization-than-dropdown-bell
LOCATION:route:/notifications+access:authenticated-users-only-all-roles+link-from:NotificationBell-dropdownâ†’View-All-Notifications-button
KEY-FEATURES:advanced-filtering[search-bar:searches-title+message-text-real-time-filtering-type-user-types-icon:Search-left-side+type-filter:dropdown-notification-types-options:All-Approvals-Moderation-Comments-Messages-Vendors-Updates-icon:Filter+date-filter:dropdown-time-ranges-options:All-Time-Today-Last-7-Days-Last-30-Days-icon:Calendar]|bulk-actions[mark-all-read:shows-unread-count-button-triggers-markAllAsRead-only-visible-unread-exist+clear-read:shows-read-count-button-triggers-deleteAllRead-only-visible-read-exist]|tab-organization[3-tabs:Unread-shows-only-unread+Read-shows-only-read+All-shows-all-filtered+tab-badges-display-count-notifications-each-tab]|enhanced-notification-cards[display:Bell-icon-primary-bg-unread-muted-read+title-bold+message-text+timestamp-relative-2-hours-ago+type-badge-Approvals-Messages+resolved-badge-green-auto-resolved+unread-indicator-blue-dotâ†’styling:unread[bg-primary/5-border-primary/20]+auto-resolved[opacity-75-bg-muted/20]+hover[shadow-effect+delete-button-appears]â†’actions:click-cardâ†’navigate-link+mark-read+hoverâ†’delete-button-X-appears-top-right+deleteâ†’removes-notification]|empty-states[no-unread:Bell-icon+No-unread-notifications+no-read:Bell-icon+No-read-notifications+no-results:Bell-icon+No-notifications-match-filters-if-filters-active-or-No-notifications-yet]
COMP-STRUCTURE:main.flex-1.pt-24>Container.max-w-4xl>BackButton+Header+Filters[SearchBar+TypeFilter+DateFilter]+BulkActions[MarkAllAsRead+ClearRead]+Tabs-defaultValue-unread>TabsList[Unread-Read-All]+TabsContent[notifications.map-NotificationCard]
DATA-FLOW:hook-useNotifications-returns:{notifications-Array+loading-state+markAllAsRead-method+deleteNotification-id-method+deleteAllRead-method+handleNotificationClick-notification-method-navigate+mark-read}|filtering-logic[1-search:title.includes-query-OR-message.includes-queryâ†’2-type:type===selectedType-or-allâ†’3-date:calc-daysDiff-from-created_at:today[daysDiff===0]+week[daysDiffâ‰¤7]+month[daysDiffâ‰¤30]]
NOTIFICATION-TYPES-MAP:{all:All+pending_approval:Approvals+moderation_needed:Moderation+comment_on_post:Comments+new_sponsor_message:Messages+vendor_application:Vendors+product_update:Updates}
MOBILE-RESPONSIVE:filters-stack-vertically-small-screens-flex-col-sm:flex-row+tabs-grid-layout-adjusts-auto+search-bar-full-width-mobile+max-width-max-w-[90vw]-mobile
INTEGRATION:NotificationBell-component-changes[added-View-All-Notifications-button-bottom-dropdown+button-navigates-/notifications-route+border-top-separator-above-button+icon:ArrowRight-right-side]|App.tsx-route[Route-path=/notifications-element=Notifications]|internal-pages-registry[added:{value:/notifications+label:Notifications}]
USER-WORKFLOWS:view-all[1-click-bell-headerâ†’2-click-View-All-Notifications-bottomâ†’3-lands-full-page-notification-center]|filter[1-use-search-bar-text-searchâ†’2-select-type-from-dropdown-Approvals-Messages-etcâ†’3-select-date-range-dropdownâ†’4-results-update-immediately]|bulk-mgmt[1-view-unread-notifications-Unread-tabâ†’2-click-Mark-all-as-readâ†’all-become-readâ†’3-switch-Read-tabâ†’4-click-Clear-readâ†’all-read-notifications-deleted]|individual[1-click-notification-cardâ†’navigate-linked-page+mark-readâ†’2-hover-cardâ†’delete-button-appearsâ†’3-click-deleteâ†’notification-removed]
ISSUES:filters-not-workingâ†’state-not-updating-check-filter-logic-filteredNotifications|empty-state-shows-with-notificationsâ†’filter-too-restrictive-reset-filters-All|back-button-doesnt-workâ†’missing-navigation-setup-verify-useNavigate-hook|tabs-show-wrong-countsâ†’filtering-happens-before-split-check-order:filterâ†’splitâ†’count|search-case-sensitiveâ†’missing-toLowerCase-apply-both-query-text
FILES:Notifications.tsx[main-page]+NotificationBell.tsx[bell-with-View-All-link]+useNotifications.ts[data-hook]+App.tsx[route-definition]+internalPages.ts[registry-entry]

## DOCUMENTATION_MAINTENANCE
PURPOSE:AI-instructions-for-maintaining-accurate-concise-system-docs
PRE-CODING-CHECKLIST:MUST[1-search-existing-docs-for-system-being-modifiedâ†’2-identify-docs/*_CONCISE.md+*_SYSTEM*.md-filesâ†’3-read-docs-completely-understand-patternsâ†’4-review-naming-conventions-DB-schemas-RLS-badge-counts-TTS-image-handling]
WHEN-UPDATE-DOCS:DB-changes[new-tables-columns+RLS-policies+triggers-functionsâ†’update-Database-sections]|component-changes[new-components+behavior-modified+props-changedâ†’update-Components-Key-Files]|workflow-changes[user-flows+approval-processes+status-transitionsâ†’update-Workflow-User-Flows]|integration-changes[new-integrations+data-fetching+display-logicâ†’update-Integration-Points]|issues-fixed[recurring-bugs+known-gotchasâ†’update-Common-Issues-Troubleshooting]
UPDATE-PROCESS:1-make-code-changes-firstâ†’2-identify-affected-docs-list-sectionsâ†’3-update-docs-lov-line-replace-keep-concise<100-lines-follow-patterns-update-changed-sections-onlyâ†’4-notify-user-docs/SYSTEM.md-added-X-updated-Y
DOC-STANDARDS:file-naming[SYSTEM_NAME_CONCISE.md|FEATURE_NAME_SYSTEM.md|ALL_CAPS-underscores]|section-order[1-Overview-1-2-linesâ†’2-Database-tables-key-fieldsâ†’3-Core-Functionality-workflows-componentsâ†’4-Integration-Pointsâ†’5-RLS-Policiesâ†’6-Common-Issuesâ†’7-Key-Files]|formatting[**bold**-section-headers|`code`-table-field-file-names|tables-structured-data|code-blocks-ONLY-critical-patterns|bullet-points-lists|line-lengthâ‰¤120-chars]
CROSS-REFERENCE:when-systems-interact-document-BOTH-places[Example:DISCUSSION-Events:Link-via-event_id-see-EVENTS|EVENTS-Linked-Events:Discussion-posts-link-events-see-DISCUSSION]
CREATE-NEW-DOCS-WHEN:new-major-system-feature-â‰¥3-components|system-has-DB-tables+UI+workflows|feature-spans-multiple-pages-components|system-requires-specific-RLS-policiesâ†’file-should-be:<100-lines-initially+follow-CONCISE-format+include-all-standard-sections+added-to-custom-knowledge
RED-FLAGS:âŒmaking-changes-without-checking-docs-first|âŒcreating-duplicate-documentation|âŒignoring-established-patterns-in-docs|âŒwriting-verbose-documentation-keep-CONCISE|âŒdocumenting-every-single-function|âŒskipping-doc-updates-after-code-changes|âŒnot-cross-referencing-related-systems
DOC-AS-SOURCE-TRUTH:Docs=System-Contract-define-how-things-SHOULD-work|Code=Implementation-may-have-bugs-deviations|When-code-contradicts-docsâ†’Fix-code-OR-update-docs-with-reasoning|When-adding-featuresâ†’Check-docs-for-similar-patterns-first|When-fixing-bugsâ†’Add-to-Common-Issues-section
MAINTENANCE-FREQUENCY:update-immediately[DB-schema-changes+new-components-pages+modified-workflows+RLS-policy-changes]|update-when-convenient[typo-fixes+formatting-improvements+minor-clarifications]|never-update[trivial-changes+no-functionality-changed+internal-implementation-details]
KEY-PRINCIPLE:Good-documentation-prevents-future-bugs+speeds-up-development+maintains-consistencyâ†’ALWAYS-check-docs-first+ALWAYS-update-docs-after

## ALBUMS_GALLERY_SYSTEM
ROUTE:/gallery[public-view]|/admin/albums[admin-CRUD]
DB:albums(id|title|description|event_id[nullable-link-events]|cover_image_url|audio_url|is_post[boolean]|is_public[boolean]|is_active|created_at)|album_images(id|album_id|image_url|original_image_url[for-recrop]|caption|display_order)|storage:album-images-bucket[public]
ADMIN-FEATURES:AlbumManagementâ†’create-edit-albums[title+desc+event-link+visibility+audio-recorder-upload]|upload-multi-images[compress-4.5MB+captions+drag-drop-reorder+crop-recrop-ImageCropDialog]|set-cover-image[first-image-default-can-change]|link-event[optional-dropdown-all-events]|link-discussion[auto-when-album_id-set-in-discussion_posts]
DISPLAY-FEATURES:GalleryPageâ†’grid-layout[1-col-mobile-4-col-desktop]|album-cards[cover-image+title+desc+photo-count+event-date-if-linked+View-Discussion-btn-if-linkedPost]|ImageLightbox[fullscreen-overlayâ†’click-cardâ†’opens-lightbox-with-nav+captions+counter+gradient-overlay]
LIGHTBOX:ImageLightbox.tsxâ†’Dialog-based[max-w-90vw-max-h-90vh]|controls[Close-top-right+Prev-Next-sides+Counter-top-center]|image[max-w-full-max-h-full-object-contain-NO-object-cover-prevents-crop]|caption[gradient-overlay-bottom]|navigation[wraps-around-circular]|keyboard[Escape-close-Arrow-keys-nav]
IMAGE-HANDLING:upload[multi-select-maintains-order+previews-generate]|compress[compressImage-util-4.5MB-max]|crop[ImageCropDialog-aspect-ratio-selection+stores-original_image_url]|recrop[loads-original-unlimited-re-crops-no-quality-loss+updates-cover-if-used]|drag-drop-reorder[@dnd-kit/sortable-saves-display_order]
INTEGRATION:events[optional-link-via-event_idâ†’shows-date-on-card]|discussions[auto-link-when-album_id-in-discussion_postsâ†’View-Discussion-btn-appears]|audio[AudioRecorder-component-or-uploadâ†’stores-event-audio-bucket]
RLS:SELECT[all-auth-view-is_active=true-is_public=true]|INSERT-UPDATE-DELETE[admins-only]|album_images[same-as-albums]
ISSUES:images-not-showingâ†’check-is_active+is_public|lightbox-crops-imagesâ†’verify-object-contain-not-object-cover|reorder-doesnt-saveâ†’check-display_order-update-logic|recrop-not-workingâ†’verify-original_image_url-exists
FILES:GalleryPage.tsx|AlbumManagement.tsx|ImageLightbox.tsx|ImageCarousel.tsx|LatestAlbum.tsx|ImageCropDialog.tsx

## MARKETPLACE_SHOPPING_CART
ROUTE:/marketplace[browse-products]|/orders[order-history]
DB:products(id|vendor_id|name|description|price|category[merch-handmade]|images[array]|inventory|is_active)|shopping_cart(id|user_id|product_id|quantity|created_at)|orders(id|customer_id|total_amount|status[pending-completed-cancelled]|stripe_payment_intent_id|shipping_address[JSONB]|billing_address[JSONB]|notes)|order_items(id|order_id|product_id|vendor_id|quantity|price|tracking_number|carrier|tracking_url|fulfillment_status[pending-shipped-delivered]|shipped_at|delivered_at|platform_fee|vendor_payout|stripe_transfer_id)
MARKETPLACE-PAGE:Marketplace.tsxâ†’hero[title+desc+action-btns:Cart-with-badge-count+Order-History+Become-Vendor]|tabs[All-Products-Official-Merch-Handmade]|ProductGrid[displays-filtered-products-by-category]|cart-sheet-overlay
SHOPPING-CART:ShoppingCartSheetâ†’Sheet-component[right-side-overlay-max-w-lg]|displays[product-image-name-price-quantity-controls+Plus-Minus-btns-Delete-icon]|quantity-update[inline-optimistic-updates+invalidates-queries]|total-calculation[SUM-priceÃ—quantity]|checkout-btn[Proceed-to-Checkout-placeholder-not-wired]|empty-state[Continue-Shopping-btn]
PRODUCT-FEATURES:ProductCardâ†’image-carousel[if-multiple-images]|price-display[bold-primary-color]|inventory-badge[Out-of-Stock-when-0-red-destructive]|Add-to-Cart-btn[updates-cart-invalidates-count-query]|vendor-link[View-Store-btnâ†’/vendors/{id}]
CART-OPERATIONS:add-to-cart[INSERT-shopping_cart-if-not-exists-UPDATE-quantity+1-if-exists]|update-quantity[direct-UPDATE-quantity-field+min-1]|remove-item[DELETE-from-shopping_cart+toast-confirmation]|cart-count[useQuery-SUM-quantities-realtime-badge]
VENDOR-INTEGRATION:vendors-manage-products[/vendor-dashboard-Products-tab]|vendors-see-orders[Orders-tab+fulfillment-tracking]|vendor-store-pages[/vendors/{id}â†’displays-vendor-products+bestie-asset-if-featured]
CATEGORIES:merch[official-BDE-merchandise]|handmade[community-vendor-creations]|filter[tab-selection-updates-ProductGrid-category-prop]
RLS:shopping_cart[users-CRUD-own-cart-by-user_id]|orders[customers-SELECT-own-orders+vendors-SELECT-orders-with-their-products+admins-ALL]|order_items[customers-SELECT-via-orders+vendors-SELECT-UPDATE-their-items-for-fulfillment]
CHECKOUT-FLOW:user-adds-itemsâ†’cart-sheetâ†’Proceed-to-Checkoutâ†’[NOT-YET-IMPLEMENTED:Stripe-checkout-session+order-creation+inventory-deduction+vendor-notifications]
ISSUES:cart-count-wrongâ†’check-realtime-query-invalidation|cant-add-to-cartâ†’check-auth+product-inventory|cart-not-updatingâ†’verify-query-invalidation-after-mutations
FILES:Marketplace.tsx|ShoppingCartSheet.tsx|ProductCard.tsx|ProductGrid.tsx|ProductList.tsx[vendor]|OrderHistory.tsx

## TEXT_TO_SPEECH_SYSTEM
OVERVIEW:app-wide-TTS-integration-OpenAI-voices-ElevenLabs-bestie-voices-user-preference-control
DB:profiles(tts_voice[def:Aria-OpenAI-voices:Alloy-Echo-Fable-Onyx-Nova-Shimmer-Aria-or-bestie-names]|tts_enabled[boolean-def:true])|BESTIE-VOICES[Austin-Batman-Cherry-Twinkle-Creature-Grandma-Muffin-Grandpa-Werthers-Jerry-B-Johnny-Dynamite-Marshal-Maverick+voice-patterns-in-assets]
EDGE-FUNCS:text-to-speech[public-no-authâ†’request:{text-voice}â†’OpenAI-TTS-API[model:tts-1-hd+response_format:mp3]â†’returns-base64-audioContent]|text-to-speech-bestie[bestie-specific-voicesâ†’ElevenLabs-API-integration+custom-voice-IDs-per-bestie]
COMPONENT:TextToSpeech.tsxâ†’props:{text-voice?-size?-onPlayingChange?}â†’button[Play-Pause-icon+gradient-pulse-loading]|loads-user-tts_voice-preference-from-profiles|returns-null-if-tts_enabled=false|e.stopPropagation-prevents-parent-click-events-critical
USAGE-PATTERN:import-TextToSpeechâ†’place-next-to-content[title+description]â†’<TextToSpeech-text={combinedText}-voice={voiceName?}/>â†’auto-uses-user-preference-if-no-voice-specified
INTEGRATION-POINTS:discussions[post-cards+commentsâ†’TTS-title+content]|events[event-cards+detail-dialogâ†’TTS-title+desc+date+location]|community-previews[Latest-Discussion+Upcoming-Eventsâ†’TTS-on-each-card]|albums[TTS-for-album-descriptions]|sponsor-besties[TTS-for-bestie-text-sections]
AUDIO-GENERATION-FLOW:1-user-clicks-Playâ†’2-shows-loading-gradient-pulseâ†’3-calls-edge-function-with-text+voiceâ†’4-receives-base64-MP3â†’5-creates-Blob+Audio-elementâ†’6-plays-audioâ†’7-on-ended-cleanup+set-isPlaying=falseâ†’8-Pause-btn-stops-playback-immediately
VOICE-SELECTION:user-profile[ProfileSettingsâ†’TTS-Voice-dropdown+Enable-TTS-toggle]|bestie-voices[special-ElevenLabs-voices-for-bestie-content-voice-patterns-show-waveforms-in-assets]|default[Aria-if-no-preference-set]
BESTIE-VOICE-FLOW:1-bestie-selects-voice-profileâ†’2-system-uses-text-to-speech-bestie-edge-funcâ†’3-ElevenLabs-API-with-bestie-voice-IDâ†’4-high-quality-voice-cloning-realistic-speech
ISSUES:audio-not-playingâ†’check-console-logs-TTS-prefix+base64-length|wrong-voiceâ†’verify-profiles.tts_voice-value|TTS-btn-hiddenâ†’check-tts_enabled=true|audio-ends-immediatelyâ†’base64-decode-issue-or-empty-text
FILES:TextToSpeech.tsx|text-to-speech/index.ts|text-to-speech-bestie/index.ts|ProfileSettings.tsx[TTS-config]|voice-patterns/[bestie-waveforms]

## AVATAR_SYSTEM
OVERVIEW:48-composite-avatars[12-compositesÃ—4-quadrants]+2-monster-avatars+unlimited-custom-uploads-admin-managed
DB:avatars(id|avatar_number[1-48-composites-49-50-monsters-51+-custom]|category[humans-animals-monsters-shapes]|is_active[boolean]|created_at)|profiles(avatar_number[references-avatars])|storage:avatars-bucket[custom-uploads-avatar-{number}.png]
COMPOSITE-SYSTEM:12-composite-images[composite-1.pngâ†’composite-12.png]|each-composite-4-quadrants[200%Ã—200%-background-size]|position-mapping[top-left-0-0-top-right-100-0-bottom-left-0-100-bottom-right-100-100]|example:avatar-1-4â†’composite-1[1:top-left-2:top-right-3:bottom-left-4:bottom-right]
AVATAR-CATEGORIES:humans[avatars-1-20-diverse-human-faces]|animals[avatars-21-36-cats-dogs-wildlife]|monsters[avatars-37-48-aliens-creatures-plus-49-pirate-starfish-50-purple-three-eyes]|shapes[future-geometric-avatars]
COMPONENTS:AvatarPickerâ†’signup-ProfileSettings[collapsible-shows-all-active-avatars-grouped-by-category-grid-4Ã—6-responsive+click-to-select-blue-ring-checkmark+shuffled-within-categories]|AvatarDisplayâ†’renders-avatar[uses-getAvatarConfig-function+handles-composites-with-backgroundPosition+handles-storage-avatars-49+â†’loads-from-avatars-bucket+fallback-to-default-avatar-1]
ADMIN-FEATURES:AvatarManagementâ†’/admin/avatars[view-all-avatars+upload-custom-avatars-assigns-next-number-51-52-etc+toggle-active-inactive-visibility+category-assignment+delete-custom-avatars-not-composites]|AvatarUploader[upload-to-avatars-bucket+compression+assigns-avatar-number+updates-avatars-table]
CUSTOM-AVATAR-FLOW:1-admin-uploads-imageâ†’2-system-assigns-next-available-number[51+]â†’3-creates-avatars-record[avatar_number-category-is_active:true]â†’4-uploads-to-storage[avatars/avatar-{number}.png]â†’5-available-immediately-in-AvatarPicker
AVATAR-SELECTION:Auth-signup[AvatarPicker-optional-collapsible+stores-avatar_number-in-profiles]|ProfileSettings[change-avatar-anytime+same-AvatarPicker-interface+updates-profiles.avatar_number]
AVATAR-RENDERING:getAvatarConfig-function[maps-avatar_number-to-composite-image+position-OR-storage-URL]|composite-avatars[use-CSS-backgroundImage+backgroundSize-200%-200%+backgroundPosition-calculated]|storage-avatars[use-img-src-direct-public-URL]|fallback[avatar-1-if-inactive-or-missing]
RLS:avatars[SELECT-all-auth-where-is_active=true+INSERT-UPDATE-DELETE-admins-only]|storage:avatars-bucket[public-read-admin-write]
ISSUES:avatar-not-showingâ†’check-is_active-in-avatars-table|wrong-quadrantâ†’verify-position-calculation-in-getAvatarConfig|custom-avatar-missingâ†’check-storage-upload-success+public-URL-generation|avatar-reverts-to-defaultâ†’inactive-avatar-triggers-fallback
FILES:AvatarPicker.tsx|AvatarDisplay.tsx|AvatarManagement.tsx|AvatarUploader.tsx|avatarUtils.ts|composite-*.png[12-files]|monster-*.png[2-files]

## MODERATION_QUEUE
ROUTE:/moderation[moderators-admins-only]
ACCESS:useUserPermissions-hook[canModerate-checks-admin-owner-roles-OR-moderate-permission-from-user_permissions-table]
DB:discussion_posts(is_moderated[boolean-AI-flag]|moderation_notes[severity-reason]|moderation_status-moderation_severity-moderation_reason)|discussion_comments(is_moderated|moderation_notes)|user_permissions(user_id|permission_type[moderate])|moderation_settings(discussion_post_image_policy[all-manual-review-flagged-AI-scan-none-auto-approve])
DISPLAY:ModerationQueueâ†’2-tabs[Posts-Comments]|cards[border-l-4-border-l-orange-500+AlertTriangle-icon]|shows[title-content-author-timestamp-image-if-present-flagging-reason-severity-badge]|severity-colors[high:red-medium:orange-low:yellow]
ACTIONS:approve-post[update-is_moderated:true+moderation_notes:Approved-by-moderator]|reject-post[DELETE-from-discussion_posts-cascade-deletes-comments]|approve-comment[update-is_moderated:true]|reject-comment[DELETE-from-discussion_comments]
AI-MODERATION:moderate-content-edge-func[scans-text-title+content-before-saveâ†’flags-inappropriateâ†’sets-is_moderated:false+severity]|moderate-image-edge-func[policy-based:all-manual-review[always-flagged]|flagged-AI-scan[AI-checks-flags-if-issues]|none-auto-approve[skips-moderation]]
NOTIFICATION-INTEGRATION:notify_on_moderation_needed-trigger[AFTER-INSERT-UPDATE-when-is_moderated=falseâ†’creates-notifications-for-moderators-admins+type:moderation_needed+link:/moderation]
EMPTY-STATE:CheckCircle-icon-green[All-clear-No-posts-comments-awaiting-moderation]
RLS:discussion_posts-discussion_comments[moderators-admins-can-UPDATE-is_moderated-field+can-DELETE-flagged-content]|uses-can_moderate-function[SECURITY-DEFINER-checks-has_admin_access-OR-has_permission-moderate]
ISSUES:cant-accessâ†’check-canModerate-permission|content-not-flaggedâ†’verify-moderate-content-edge-func-running|images-not-showingâ†’check-moderation_settings.discussion_post_image_policy
FILES:ModerationQueue.tsx|MessageModerationQueue.tsx[sponsor-messages]|ModerationPolicyManager.tsx[admin-config]|useUserPermissions.ts|moderate-content/index.ts|moderate-image/index.ts

## ROLE_IMPERSONATION
PURPOSE:admin-tool-test-UI-as-different-roles-without-logging-out-switching-accounts
HOOK:useRoleImpersonationâ†’{impersonatedRole-isImpersonating-startImpersonation-stopImpersonation}â†’stores-localStorage[impersonated_role-key]â†’returns-effective-role-for-UI-rendering
BANNER:ImpersonationBannerâ†’sticky-top-z-60[above-navbar]|bg-orange-#FF8C42[distinct-admin-mode-indicator]|shows[Eye-icon+Admin-Mode:Viewing-as-{role}+Exit-Impersonation-btn]|only-renders-when-isImpersonating=true
ADMIN-INTERFACE:RoleImpersonatorâ†’Adminâ†’Settingsâ†’Impersonation-tab|radio-buttons[Caregiver-Bestie-Supporter]|Start-Impersonation-btnâ†’sets-localStorage+reloads-page|shows-current-impersonated-role-if-active
AFFECTED-SYSTEMS:navigation-bar[role-based-visibility]|badges[guardian-approvals-sponsor-messages-etc]|page-access[role-restricted-pages]|content-visibility[role-based-discussions-events]|UI-elements[role-specific-buttons-sections]
USAGE-FLOW:1-admin-opens-Adminâ†’Settingsâ†’Impersonationâ†’2-selects-role-radio-btnâ†’3-clicks-Start-Impersonationâ†’4-page-reloads-with-banner-visibleâ†’5-admin-sees-UI-as-selected-roleâ†’6-clicks-Exit-Impersonation-bannerâ†’7-page-reloads-back-to-admin-view
IMPLEMENTATION-PATTERN:components-check[const-{impersonatedRole-isImpersonating}=useRoleImpersonation-if-isImpersonating-use-impersonatedRole-else-use-actual-role]|critical-banner-must-be-visible-to-remind-admin
SECURITY:impersonation-frontend-only[does-not-change-actual-DB-user-role]|localStorage-only[clears-on-logout-browser-close]|admin-only-feature[no-access-control-needed-admins-trust]
ISSUES:banner-not-showingâ†’check-isImpersonating-state|wrong-UIâ†’verify-components-using-impersonatedRole|impersonation-persistsâ†’localStorage-not-cleared-click-Exit
FILES:useRoleImpersonation.ts|ImpersonationBanner.tsx|RoleImpersonator.tsx|App.tsx[banner-placement]

## PARTNERS_SYSTEM
ROUTE:/partners[public-display]|Adminâ†’Partners[management]
DB:partners(id|name|description|logo_url|website_url|display_order|is_active|created_at)
ADMIN:PartnersManagerâ†’CRUD-interface[Add-Partner-dialog+edit-delete-btns]|form[name-description-logo-upload-website-URL-all-required-except-desc]|logo-upload[uploads-app-assets/partners/+shows-preview-w-16-h-16-object-contain]|drag-drop-reorder[@dnd-kit/sortable-updates-display_order]|visibility-toggle[Eye-EyeOff-btn-green-active-red-inactive-standard]
DISPLAY:Partners.tsxâ†’public-page[shows-active-partners-only-ordered-by-display_order]|partner-cards[logo-name-description-website-link-external-icon]|grid-layout[responsive-1-col-mobile-3-4-col-desktop]
PARTNER-CARD:logo[w-24-h-24-object-contain-rounded]|name[font-semibold]|description[text-sm-muted-line-clamp-2]|website[text-primary-hover:underline-ExternalLink-icon-opens-new-tab-noopener-noreferrer]
OPERATIONS:create[dialog-form-uploads-logo-to-storage-inserts-partners-table-display_order:partners.length]|update[same-dialog-pre-filled-can-change-logo-URL-kept-if-not-re-uploaded]|delete[confirmation-dialog-deletes-from-DB-logo-remains-in-storage]|reorder[drag-GripVertical-handle-updates-all-display_order-values]|toggle-active[Eye-EyeOff-btn-updates-is_active-field]
RLS:SELECT[all-users-view-is_active:true-partners]|INSERT-UPDATE-DELETE[admins-only]
INTEGRATION:homepage[can-add-partners-section-to-homepage_sections-if-needed]|about-page[partners-can-be-featured-in-about-sections]
ISSUES:partner-not-showingâ†’check-is_active:true|logo-not-loadingâ†’verify-public-URL-from-storage|cant-reorderâ†’check-drag-drop-sensors-setup|website-link-blockedâ†’use-anchor-with-target-blank-rel-noopener
FILES:PartnersManager.tsx|Partners.tsx|partners-table

## QUICK_LINKS_SYSTEM
LOCATION:Community-page-sidebar-prominent-action-buttons
DB:community_quick_links(id|label|href|icon[Lucide-icon-name]|color[Tailwind-gradient-classes]|display_order|is_active|created_by)
ADMIN:QuickLinksManagerâ†’Adminâ†’Format-Pagesâ†’Quick-Links|form[label-href-dropdown-or-custom-URL-icon-selector-50+-icons-color-gradient-picker-9-options]|href-types[internal:dropdown-from-INTERNAL_PAGES-array|custom:text-input-for-external-URLs-or-anchor-links]|drag-drop-reorder[@dnd-kit/sortable]|toggle-active[Switch-component-green-on-gray-off]
DISPLAY:Community.tsxâ†’quick-links-section[grid-2-col-sm:3-col-gap-3]|link-cards[gradient-bg-from-color-prop+icon-rendered-dynamically+label-text+hover:scale-105-shadow-transition]|click-behavior[internal:navigate-via-React-Router|external:window.open-new-tab]
ICON-SYSTEM:50+-Lucide-icons[Heart-Gift-Users-Coffee-Calendar-etc]|renderIconPreview-function[dynamically-loads-icon-component-from-Icons-object]|icon-picker[dropdown-shows-icon+name-preview]
GRADIENT-OPTIONS:9-predefined-gradients[Primary/Secondary-Primary-Variant-Secondary-Accent-Warm-Sunset-Cool-Ocean-Forest-Green-Purple-Dream-Gold-Shine]|stored-as-Tailwind-classes[from-primary/20-to-secondary/5]
OPERATIONS:create[form-submission-inserts-community_quick_links-display_order:links.length]|update[edit-btn-fills-form-updates-record-on-submit]|delete[trash-icon-confirmation-deletes-record]|reorder[drag-GripVertical-updates-display_order-for-all]|toggle[Switch-updates-is_active-immediately]
LINK-RESOLUTION:INTERNAL_PAGES-array[src/lib/internalPages.ts-centralized-route-registry]|internal-links[detected-by-matching-INTERNAL_PAGES.value]|custom-links[anything-not-in-registry-treated-as-custom]
RLS:SELECT[all-auth-view-is_active:true-quick-links]|INSERT-UPDATE-DELETE[admins-only]
ISSUES:link-not-showingâ†’check-is_active:true|icon-not-renderingâ†’verify-icon-name-matches-Lucide-exports|wrong-page-opensâ†’check-href-value-in-DB|gradient-not-applyingâ†’verify-color-class-string-format
FILES:QuickLinksManager.tsx|Community.tsx[display]|internalPages.ts[route-registry]

## DOMAIN_ROUTING
OVERVIEW:multi-domain-support-routes-users-based-on-hostname-separate-coffee-shop-vs-main-app
HOOK:useDomainRoutingâ†’{isCoffeeShopDomain}â†’checks-window.location.hostname[bestdayevercoffeeandcrepes.com-www.bestdayevercoffeeandcrepes.com]|returns-boolean-flag
USAGE:App.tsxâ†’useEffect[if-isCoffeeShopDomain-navigate-to-/coffee-shop]|automatic-redirect-on-coffee-shop-domain-prevents-access-to-main-app-routes
COFFEE-SHOP-DOMAIN:bestdayevercoffeeandcrepes.comâ†’dedicated-coffee-shop-website[/coffee-shop-route]|separate-branding-menu-content-no-auth-required-public-marketing-site
MAIN-DOMAIN:default-Joy-House-Community-app[all-other-routes-community-discussions-sponsorships-marketplace-admin]
IMPLEMENTATION:simple-hostname-check[no-subdomain-routing-just-domain-detection]|useEffect-cleanup[re-checks-on-mount-hostname-changes]
FUTURE-ENHANCEMENTS:could-add-more-domains[vendor-storefronts-partner-microsites-subdomain-routing-org.joyhouse.app]|could-add-custom-domain-mapping[users-bring-own-domains-map-to-specific-pages]
ISSUES:redirect-loopâ†’check-/coffee-shop-route-doesnt-trigger-redirect-again|domain-not-detectedâ†’verify-exact-match-in-coffeeShopDomains-array|wrong-redirectâ†’check-isCoffeeShopDomain-logic-in-App.tsx
FILES:useDomainRouting.ts|App.tsx[redirect-logic]|CoffeeShopHome.tsx[coffee-shop-page]
